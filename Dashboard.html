<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SynDataGen - Advanced Analytics Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a60d5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #0b78f5;
            --danger: #ef4444;
            --info: #06b6d4;
            --dark: #1f2937;
            --light: #f9fafb;
            --sidebar-width: 280px;
            --navbar-height: 64px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', 'Roboto', sans-serif;
            background: #f9fafb;
            color: #1f2937;
            transition: all 0.3s ease;
        }

        body.dark-mode {
            background: #0f172a;
            color: #f8fafc;
        }

        /* Top Navbar - FIXED */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--navbar-height);
            background: white;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            padding: 0 2rem;
            z-index: 1000;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        body.dark-mode .navbar {
            background: #1e293b;
            border-bottom-color: #334155;
        }
        .experiment-action-btn:hover {
            background: rgba(0, 0, 0, 0.1);
            transform: scale(1.1);
        }

        /* ADICIONE ESTE BLOCO AQUI üëá */
        .experiment-action-btn.cancel-btn {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .experiment-action-btn.cancel-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            transform: scale(1.1);
        }
        @keyframes spin {
             to { transform: rotate(360deg); }
         }

        /* ADICIONE ESTE BLOCO AQUI üëá */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-running {
            animation: pulse 2s ease-in-out infinite;
        }
        .nav-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .menu-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: inherit;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: background 0.2s;
        }

        .menu-toggle:hover {
            background: rgba(0,0,0,0.05);
        }

        body.dark-mode .menu-toggle:hover {
            background: rgba(255,255,255,0.1);
        }

        .logo {
            font-size: 1.25rem;
            font-weight: 900;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo i {
            font-size: 1.5rem;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .nav-btn {
            background: none;
            border: none;
            padding: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            color: inherit;
            font-size: 1.125rem;
            transition: all 0.2s;
            position: relative;
        }

        .nav-btn:hover {
            background: rgba(0,0,0,0.05);
        }

        body.dark-mode .nav-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .nav-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--danger);
            color: white;
            font-size: 0.65rem;
            padding: 0.125rem 0.375rem;
            border-radius: 9999px;
            font-weight: 600;
        }

        /* Sidebar - FIXED */
        .sidebar {
            position: fixed;
            left: 0;
            top: var(--navbar-height);
            width: var(--sidebar-width);
            height: calc(100vh - var(--navbar-height));
            background: white;
            border-right: 1px solid #e5e7eb;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 999;
        }

        body.dark-mode .sidebar {
            background: #1e293b;
            border-right-color: #334155;
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        .sidebar-section {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }

        body.dark-mode .sidebar-section {
            border-bottom-color: #334155;
        }

        .sidebar-title {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            color: #9ca3af;
            margin-bottom: 1rem;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .experiment-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .experiment-item {
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            display: flex;
            flex-direction: column;
        }

        body.dark-mode .experiment-item {
            background: #0f172a;
            border-color: #334155;
        }

        .experiment-item:hover {
            border-color: var(--primary);
            transform: translateX(4px);
        }

        .experiment-item.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-color: var(--primary);
            color: white;
        }

        .experiment-action-btn {
            background: rgba(0, 0, 0, 0.05);
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s;
            color: inherit;
        }

        .experiment-action-btn:hover {
            background: rgba(0, 0, 0, 0.1);
            transform: scale(1.1);
        }

        .experiment-item.active .experiment-action-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .experiment-item.active .experiment-action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        body.dark-mode .experiment-action-btn {
            background: rgba(255, 255, 255, 0.05);
        }

        body.dark-mode .experiment-action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .experiment-name {
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .experiment-meta {
            display: flex;
            gap: 0.75rem;
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .experiment-item.active .experiment-meta {
            opacity: 1;
        }

        .meta-badge {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            color: inherit;
            text-decoration: none;
        }

        body.dark-mode .action-btn {
            background: #0f172a;
            border-color: #334155;
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: var(--navbar-height);
            padding: 2rem;
            min-height: calc(100vh - var(--navbar-height));
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        /* Upload Section */
        .upload-section {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 70vh;
        }

        .upload-container {
            text-align: center;
            max-width: 600px;
            padding: 3rem;
        }

        .upload-icon {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
        }

        .upload-title {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 1rem;
        }

        .upload-subtitle {
            font-size: 1.125rem;
            color: #6b7280;
            margin-bottom: 2rem;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }

        .file-input {
            display: none;
        }

        .file-input-label {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 0.75rem;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.125rem;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .file-input-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        /* Dashboard Content */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-left h1 {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #6b7280;
            font-size: 0.875rem;
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 0.875rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: white;
            color: var(--dark);
            border: 1px solid #e5e7eb;
        }

        body.dark-mode .btn-secondary {
            background: #1e293b;
            color: white;
            border-color: #334155;
        }

        .btn-secondary:hover {
            background: #f3f4f6;
        }

        body.dark-mode .btn-secondary:hover {
            background: #334155;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            border: 1px solid #e5e7eb;
            transition: all 0.3s;
        }

        body.dark-mode .stat-card {
            background: #1e293b;
            border-color: #334155;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.1);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .trend-up {
            color: var(--success);
        }

        .trend-down {
            color: var(--danger);
        }

        /* Chart Section */
        .chart-section {
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-actions {
            display: flex;
            gap: 0.5rem;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        body.dark-mode .icon-btn {
            background: #1e293b;
            border-color: #334155;
        }

        .icon-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 1.5rem;
        }

        .chart-card {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            border: 1px solid #e5e7eb;
        }

        body.dark-mode .chart-card {
            background: #1e293b;
            border-color: #334155;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .chart-title {
            font-weight: 700;
            font-size: 1.125rem;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Metrics Table */
        .table-container {
            background: white;
            border-radius: 1rem;
            border: 1px solid #e5e7eb;
            overflow: hidden;
            margin-bottom: 2rem;
        }

        body.dark-mode .table-container {
            background: #1e293b;
            border-color: #334155;
        }

        .table-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        body.dark-mode .table-header {
            border-bottom-color: #334155;
        }

        .table-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            padding: 0.5rem 1rem 0.5rem 2.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            width: 250px;
            background: white;
            color: inherit;
        }

        body.dark-mode .search-input {
            background: #0f172a;
            border-color: #334155;
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }

        .filter-select {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            background: white;
            color: inherit;
            cursor: pointer;
        }

        body.dark-mode .filter-select {
            background: #0f172a;
            border-color: #334155;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f9fafb;
        }

        body.dark-mode thead {
            background: #0f172a;
        }

        th {
            padding: 1rem 1.5rem;
            text-align: left;
            font-weight: 700;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #6b7280;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: #f3f4f6;
        }

        body.dark-mode th:hover {
            background: #1e293b;
        }

        td {
            padding: 1rem 1.5rem;
            border-top: 1px solid #e5e7eb;
            font-size: 0.875rem;
        }

        body.dark-mode td {
            border-top-color: #334155;
        }

        tr:hover {
            background: #f9fafb;
        }

        body.dark-mode tr:hover {
            background: #0f172a;
        }

        .metric-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 0.75rem;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 2rem;
        }

        body.dark-mode .tabs {
            border-bottom-color: #334155;
        }

        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .main-content {
                margin-left: 0;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 0 1rem;
            }

            .main-content {
                padding: 1rem;
            }

            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .search-input {
                width: 100%;
            }

            .table-controls {
                flex-direction: column;
                width: 100%;
            }
        }

        /* Loading Animation */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e5e7eb;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #1f2937;
            color: white;
            text-align: center;
            border-radius: 0.5rem;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 5rem;
            right: 1rem;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toast {
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            min-width: 300px;
            animation: slideIn 0.3s ease-out;
        }

        body.dark-mode .toast {
            background: #1e293b;
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        .toast.warning {
            border-left: 4px solid var(--warning);
        }

        .toast.info {
            border-left: 4px solid var(--info);
        }

        .toast-icon {
            font-size: 1.25rem;
        }

        .toast.success .toast-icon {
            color: var(--success);
        }

        .toast.error .toast-icon {
            color: var(--danger);
        }

        .toast.warning .toast-icon {
            color: var(--warning);
        }

        .toast.info .toast-icon {
            color: var(--info);
        }

        .toast-message {
            flex: 1;
            font-size: 0.875rem;
        }

        .toast-close {
            background: none;
            border: none;
            cursor: pointer;
            color: inherit;
            opacity: 0.5;
            font-size: 1.25rem;
        }

        .toast-close:hover {
            opacity: 1;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Experiment Creator Modal */
        .experiment-creator-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        .experiment-creator-modal.show {
            display: flex;
        }

        .experiment-creator-content {
            background: white;
            border-radius: 1rem;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.4s ease;
        }

        body.dark-mode .experiment-creator-content {
            background: #1e293b;
            color: #f8fafc;
        }

        @keyframes modalSlideIn {
            from {
                transform: scale(0.9) translateY(-20px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .experiment-creator-header {
            padding: 2rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 1rem 1rem 0 0;
        }

        body.dark-mode .experiment-creator-header {
            border-bottom-color: #334155;
        }

        .experiment-creator-title {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .experiment-creator-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            color: white;
            font-size: 1.25rem;
            transition: all 0.2s;
        }

        .experiment-creator-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .experiment-creator-body {
            padding: 2rem;
        }

        .form-section {
            margin-bottom: 2.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }

        body.dark-mode .form-section {
            border-bottom-color: #334155;
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .form-section-title {
            font-size: 1.125rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--primary);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-weight: 600;
            font-size: 0.875rem;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 0.25rem;
        }

        body.dark-mode .form-label {
            color: #d1d5db;
        }

        .form-input, .form-select {
            padding: 0.75rem 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.2s;
            background: white;
            color: inherit;
        }

        body.dark-mode .form-input,
        body.dark-mode .form-select {
            background: #0f172a;
            border-color: #334155;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-hint {
            font-size: 0.75rem;
            color: #6b7280;
            font-style: italic;
        }

        .experiment-creator-footer {
            padding: 1.5rem 2rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            background: #f9fafb;
            border-radius: 0 0 1rem 1rem;
        }

        body.dark-mode .experiment-creator-footer {
            background: #0f172a;
            border-top-color: #334155;
        }

        .btn-secondary, .btn-primary {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 0.875rem;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        body.dark-mode .btn-secondary {
            background: #334155;
            color: #f1f5f9;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }

        .param-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            background: var(--primary);
            color: white;
            border-radius: 0.25rem;
            font-size: 0.65rem;
            font-weight: 600;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-width: 0;
        }

        .form-hint {
            font-size: 0.75rem;
            color: #6b7280;
            font-style: italic;
            margin-top: -0.25rem;
            line-height: 1.3;
        }
    </style>
</head>
<body>
<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Experiment Creator Modal -->
<div class="experiment-creator-modal" id="experimentCreatorModal">
    <div class="experiment-creator-content">
        <div class="experiment-creator-header">
            <div class="experiment-creator-title">
                <i class="fas fa-flask"></i>
                Criar Novo Experimento
            </div>
            <button class="experiment-creator-close" onclick="closeExperimentCreator()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="experiment-creator-body">
            <!-- Basic Configuration -->
            <div class="form-section">
                <div class="form-section-title">
                    <i class="fas fa-cog"></i>
                    Configura√ß√£o B√°sica
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">
                            Nome do Experimento
                            <span class="param-badge">Obrigat√≥rio</span>
                        </label>
                        <input type="text" class="form-input" id="experimentName" placeholder="Ex: teste_adversarial_01">
                        <span class="form-hint">Identificador √∫nico para este experimento</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Tipo de Modelo
                            <span class="param-badge">model_type</span>
                        </label>
                        <select class="form-select" id="modelType" onchange="updateModelParameters()">
                            <option value="">Selecione...</option>
                            <option value="adversarial">Adversarial (GAN)</option>
                            <option value="autoencoder">Autoencoder</option>
                            <option value="variational">Variational Autoencoder</option>
                            <option value="wasserstein">Wasserstein GAN</option>
                            <option value="wasserstein_gp">Wasserstein GP</option>
                            <option value="latent_diffusion">Latent Diffusion</option>
                            <option value="denoising_diffusion">Denoising Diffusion</option>
                            <option value="ctgan">CTGAN</option>
                            <option value="tvae">TVAE</option>
                            <option value="copula">Copula GAN</option>
                        </select>
                        <span class="form-hint">Arquitetura do modelo generativo</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Dataset
                            <span class="param-badge">data_load_path_file_input</span>
                        </label>
                        <select class="form-select" id="datasetPath">
                        <option value="">Carregando datasets...</option>
                        </select>
                        <span class="form-hint">Selecione um dataset dispon√≠vel no servidor</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Amostras por Classe
                            <span class="param-badge">number_samples_per_class</span>
                        </label>
                        <input type="text" class="form-input" id="samplesPerClass" value="0:2000,1:2000">
                        <span class="form-hint">Formato: classe:quantidade (ex: 0:100,1:100)</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            K-Folds
                            <span class="param-badge">number_k_folds</span>
                        </label>
                        <input type="number" class="form-input" id="kFolds" value="5" min="2" max="10">
                        <span class="form-hint">N√∫mero de folds para valida√ß√£o cruzada</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Classificadores
                            <span class="param-badge">classifier</span>
                        </label>
                        <input type="text" class="form-input" id="classifiers" value="RandomForest SupportVectorMachine KNN">
                        <span class="form-hint">Separados por espa√ßo</span>
                    </div>
                </div>
            </div>

            <!-- Model-specific Parameters (shown based on model_type) -->
            <div id="modelSpecificParams" style="display: none;">
                <!-- Adversarial Parameters -->
                <div class="form-section" id="adversarialParams" style="display: none;">
                    <div class="form-section-title">
                        <i class="fas fa-sliders-h"></i>
                        Par√¢metros do Modelo Adversarial
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                √âpocas
                                <span class="param-badge">adversarial_number_epochs</span>
                            </label>
                            <input type="number" class="form-input" id="adversarialEpochs" value="300" min="1">
                            <span class="form-hint">N√∫mero de √©pocas de treinamento</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Batch Size
                                <span class="param-badge">adversarial_batch_size</span>
                            </label>
                            <input type="number" class="form-input" id="adversarialBatchSize" value="128" min="16">
                            <span class="form-hint">Tamanho do batch</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Dimens√£o Latente
                                <span class="param-badge">adversarial_latent_dimension</span>
                            </label>
                            <input type="number" class="form-input" id="adversarialLatentDim" value="128" min="16">
                            <span class="form-hint">Dimens√£o do espa√ßo latente</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Camadas Gerador
                                <span class="param-badge">adversarial_dense_layer_sizes_g</span>
                            </label>
                            <input type="text" class="form-input" id="adversarialLayersG" value="512">
                            <span class="form-hint">Tamanhos das camadas separadas por espa√ßo</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Camadas Discriminador
                                <span class="param-badge">adversarial_dense_layer_sizes_d</span>
                            </label>
                            <input type="text" class="form-input" id="adversarialLayersD" value="256">
                            <span class="form-hint">Tamanhos das camadas separadas por espa√ßo</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Dropout Gerador
                                <span class="param-badge">adversarial_dropout_decay_rate_g</span>
                            </label>
                            <input type="number" class="form-input" id="adversarialDropoutG" value="0.2" step="0.05" min="0" max="1">
                            <span class="form-hint">Taxa de dropout do gerador</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Dropout Discriminador
                                <span class="param-badge">adversarial_dropout_decay_rate_d</span>
                            </label>
                            <input type="number" class="form-input" id="adversarialDropoutD" value="0.4" step="0.05" min="0" max="1">
                            <span class="form-hint">Taxa de dropout do discriminador</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Fun√ß√£o de Ativa√ß√£o
                                <span class="param-badge">adversarial_activation_function</span>
                            </label>
                            <select class="form-select" id="adversarialActivation">
                                <option value="leakyrelu">LeakyReLU</option>
                                <option value="relu">ReLU</option>
                                <option value="elu">ELU</option>
                                <option value="tanh">Tanh</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Algoritmo de Treino
                                <span class="param-badge">adversarial_training_algorithm</span>
                            </label>
                            <select class="form-select" id="adversarialOptimizer">
                                <option value="Adam">Adam</option>
                                <option value="RMSprop">RMSprop</option>
                                <option value="SGD">SGD</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Loss Gerador
                                <span class="param-badge">adversarial_loss_generator</span>
                            </label>
                            <select class="form-select" id="adversarialLossG">
                                <option value="binary_crossentropy">Binary Crossentropy</option>
                                <option value="mse">MSE</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Loss Discriminador
                                <span class="param-badge">adversarial_loss_discriminator</span>
                            </label>
                            <select class="form-select" id="adversarialLossD">
                                <option value="binary_crossentropy">Binary Crossentropy</option>
                                <option value="mse">MSE</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Label Smoothing
                                <span class="param-badge">adversarial_smoothing_rate</span>
                            </label>
                            <input type="number" class="form-input" id="adversarialSmoothing" value="0.15" step="0.05" min="0" max="1">
                            <span class="form-hint">Taxa de suaviza√ß√£o de labels</span>
                        </div>
                    </div>
                </div>

                <!-- Autoencoder Parameters -->
                <div class="form-section" id="autoencoderParams" style="display: none;">
                    <div class="form-section-title">
                        <i class="fas fa-sliders-h"></i>
                        Par√¢metros do Autoencoder
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                √âpocas
                                <span class="param-badge">autoencoder_number_epochs</span>
                            </label>
                            <input type="number" class="form-input" id="autoencoderEpochs" value="300" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Dimens√£o Latente
                                <span class="param-badge">autoencoder_latent_dimension</span>
                            </label>
                            <input type="number" class="form-input" id="autoencoderLatentDim" value="128" min="8">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Batch Size
                                <span class="param-badge">autoencoder_batch_size</span>
                            </label>
                            <input type="number" class="form-input" id="autoencoderBatchSize" value="256" min="16">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Fun√ß√£o de Ativa√ß√£o
                                <span class="param-badge">autoencoder_activation_function</span>
                            </label>
                            <select class="form-select" id="autoencoderActivation">
                                <option value="elu">ELU</option>
                                <option value="relu">ReLU</option>
                                <option value="leakyrelu">LeakyReLU</option>
                                <option value="tanh">Tanh</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Camadas Encoder
                                <span class="param-badge">autoencoder_dense_layer_sizes_encoder</span>
                            </label>
                            <input type="text" class="form-input" id="autoencoderLayersEnc" value="128 128">
                            <span class="form-hint">Tamanhos separados por espa√ßo</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Camadas Decoder
                                <span class="param-badge">autoencoder_dense_layer_sizes_decoder</span>
                            </label>
                            <input type="text" class="form-input" id="autoencoderLayersDec" value="128 128">
                            <span class="form-hint">Tamanhos separados por espa√ßo</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Dropout Encoder
                                <span class="param-badge">autoencoder_dropout_decay_rate_encoder</span>
                            </label>
                            <input type="number" class="form-input" id="autoencoderDropoutEnc" value="0.10" step="0.05" min="0" max="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Dropout Decoder
                                <span class="param-badge">autoencoder_dropout_decay_rate_decoder</span>
                            </label>
                            <input type="number" class="form-input" id="autoencoderDropoutDec" value="0.10" step="0.05" min="0" max="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                N√∫mero de Classes
                                <span class="param-badge">autoencoder_number_classes</span>
                            </label>
                            <input type="number" class="form-input" id="autoencoderNumClasses" value="2" min="2">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Loss Function
                                <span class="param-badge">autoencoder_loss_function</span>
                            </label>
                            <select class="form-select" id="autoencoderLoss">
                                <option value="binary_crossentropy">Binary Crossentropy</option>
                                <option value="mse">MSE</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Momentum
                                <span class="param-badge">autoencoder_momentum</span>
                            </label>
                            <input type="number" class="form-input" id="autoencoderMomentum" value="0.8" step="0.1" min="0" max="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Ativa√ß√£o Camada Final
                                <span class="param-badge">autoencoder_last_activation_layer</span>
                            </label>
                            <select class="form-select" id="autoencoderLastActivation">
                                <option value="sigmoid">Sigmoid</option>
                                <option value="tanh">Tanh</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Initializer Mean
                                <span class="param-badge">autoencoder_initializer_mean</span>
                            </label>
                            <input type="number" class="form-input" id="autoencoderInitMean" value="0.0" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Initializer Deviation
                                <span class="param-badge">autoencoder_initializer_deviation</span>
                            </label>
                            <input type="number" class="form-input" id="autoencoderInitDev" value="0.125" step="0.025">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Latent Mean Distribution
                                <span class="param-badge">autoencoder_latent_mean_distribution</span>
                            </label>
                            <input type="number" class="form-input" id="autoencoderLatentMean" value="0.5" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Latent Stander Deviation
                                <span class="param-badge">autoencoder_latent_stander_deviation</span>
                            </label>
                            <input type="number" class="form-input" id="autoencoderLatentStd" value="0.500" step="0.05">
                        </div>
                    </div>
                </div>

                <!-- Variational Autoencoder Parameters -->
                <div class="form-section" id="variationalParams" style="display: none;">
                    <div class="form-section-title">
                        <i class="fas fa-sliders-h"></i>
                        Par√¢metros do Variational Autoencoder
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                √âpocas
                                <span class="param-badge">variational_autoencoder_number_epochs</span>
                            </label>
                            <input type="number" class="form-input" id="variationalEpochs" value="300" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Dimens√£o Latente
                                <span class="param-badge">variational_autoencoder_latent_dimension</span>
                            </label>
                            <input type="number" class="form-input" id="variationalLatentDim" value="68" min="8">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Batch Size
                                <span class="param-badge">variational_autoencoder_batch_size</span>
                            </label>
                            <input type="number" class="form-input" id="variationalBatchSize" value="32" min="16">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Algoritmo de Treino
                                <span class="param-badge">variational_autoencoder_training_algorithm</span>
                            </label>
                            <select class="form-select" id="variationalOptimizer">
                                <option value="Adam">Adam</option>
                                <option value="RMSprop">RMSprop</option>
                                <option value="SGD">SGD</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Fun√ß√£o de Ativa√ß√£o
                                <span class="param-badge">variational_autoencoder_activation_function</span>
                            </label>
                            <select class="form-select" id="variationalActivation">
                                <option value="relu">ReLU</option>
                                <option value="elu">ELU</option>
                                <option value="leakyrelu">LeakyReLU</option>
                                <option value="tanh">Tanh</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Camadas Encoder
                                <span class="param-badge">variational_autoencoder_dense_layer_sizes_encoder</span>
                            </label>
                            <input type="text" class="form-input" id="variationalLayersEnc" value="128 64">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Camadas Decoder
                                <span class="param-badge">variational_autoencoder_dense_layer_sizes_decoder</span>
                            </label>
                            <input type="text" class="form-input" id="variationalLayersDec" value="64 128">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Dropout Encoder
                                <span class="param-badge">variational_autoencoder_dropout_decay_rate_encoder</span>
                            </label>
                            <input type="number" class="form-input" id="variationalDropoutEnc" value="0.2" step="0.05" min="0" max="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Dropout Decoder
                                <span class="param-badge">variational_autoencoder_dropout_decay_rate_decoder</span>
                            </label>
                            <input type="number" class="form-input" id="variationalDropoutDec" value="0.2" step="0.05" min="0" max="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                N√∫mero de Classes
                                <span class="param-badge">variational_autoencoder_number_classes</span>
                            </label>
                            <input type="number" class="form-input" id="variationalNumClasses" value="2" min="2">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Loss Function
                                <span class="param-badge">variational_autoencoder_loss_function</span>
                            </label>
                            <select class="form-select" id="variationalLoss">
                                <option value="binary_crossentropy">Binary Crossentropy</option>
                                <option value="mse">MSE</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Momentum
                                <span class="param-badge">variational_autoencoder_momentum</span>
                            </label>
                            <input type="number" class="form-input" id="variationalMomentum" value="0.8" step="0.1" min="0" max="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Ativa√ß√£o Camada Final
                                <span class="param-badge">variational_autoencoder_last_activation_layer</span>
                            </label>
                            <select class="form-select" id="variationalLastActivation">
                                <option value="sigmoid">Sigmoid</option>
                                <option value="tanh">Tanh</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Initializer Mean
                                <span class="param-badge">variational_autoencoder_initializer_mean</span>
                            </label>
                            <input type="number" class="form-input" id="variationalInitMean" value="0.0" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Initializer Deviation
                                <span class="param-badge">variational_autoencoder_initializer_deviation</span>
                            </label>
                            <input type="number" class="form-input" id="variationalInitDev" value="0.125" step="0.025">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Mean Distribution
                                <span class="param-badge">variational_autoencoder_mean_distribution</span>
                            </label>
                            <input type="number" class="form-input" id="variationalMeanDist" value="0.5" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Stander Deviation
                                <span class="param-badge">variational_autoencoder_stander_deviation</span>
                            </label>
                            <input type="number" class="form-input" id="variationalStdDev" value="0.125" step="0.025">
                        </div>
                    </div>
                </div>

                <!-- Wasserstein Parameters -->
                <div class="form-section" id="wassersteinParams" style="display: none;">
                    <div class="form-section-title">
                        <i class="fas fa-sliders-h"></i>
                        Par√¢metros do Wasserstein GAN
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                √âpocas
                                <span class="param-badge">wasserstein_number_epochs</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinEpochs" value="300" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Batch Size
                                <span class="param-badge">wasserstein_batch_size</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinBatchSize" value="256" min="16">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Dimens√£o Latente
                                <span class="param-badge">wasserstein_latent_dimension</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinLatentDim" value="32" min="8">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Camadas Gerador
                                <span class="param-badge">wasserstein_dense_layer_sizes_generator</span>
                            </label>
                            <input type="text" class="form-input" id="wassersteinLayersG" value="1024">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Camadas Discriminador
                                <span class="param-badge">wasserstein_dense_layer_sizes_discriminator</span>
                            </label>
                            <input type="text" class="form-input" id="wassersteinLayersD" value="512">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Dropout Gerador
                                <span class="param-badge">wasserstein_dropout_decay_rate_g</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinDropoutG" value="0.0" step="0.05" min="0" max="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Dropout Discriminador
                                <span class="param-badge">wasserstein_dropout_decay_rate_d</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinDropoutD" value="0.0" step="0.05" min="0" max="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Fun√ß√£o de Ativa√ß√£o
                                <span class="param-badge">wasserstein_activation_function</span>
                            </label>
                            <select class="form-select" id="wassersteinActivation">
                                <option value="elu">ELU</option>
                                <option value="relu">ReLU</option>
                                <option value="leakyrelu">LeakyReLU</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Algoritmo de Treino
                                <span class="param-badge">wasserstein_training_algorithm</span>
                            </label>
                            <select class="form-select" id="wassersteinOptimizer">
                                <option value="Adam">Adam</option>
                                <option value="RMSprop">RMSprop</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Learning Rate Gerador
                                <span class="param-badge">wasserstein_optimizer_generator_learning_rate</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinLrG" value="0.001" step="0.0001">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Learning Rate Discriminador
                                <span class="param-badge">wasserstein_optimizer_discriminator_learning_rate</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinLrD" value="0.001" step="0.0001">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Beta Gerador
                                <span class="param-badge">wasserstein_optimizer_generator_beta</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinBetaG" value="0.5" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Beta Discriminador
                                <span class="param-badge">wasserstein_optimizer_discriminator_beta</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinBetaD" value="0.5" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Discriminator Steps
                                <span class="param-badge">wasserstein_discriminator_steps</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinDiscSteps" value="3" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Smoothing Rate
                                <span class="param-badge">wasserstein_smoothing_rate</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinSmoothing" value="0.10" step="0.05">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                N√∫mero de Classes
                                <span class="param-badge">wasserstein_number_classes</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinNumClasses" value="2" min="2">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Momentum
                                <span class="param-badge">wasserstein_momentum</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinMomentum" value="0.8" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Ativa√ß√£o Camada Final
                                <span class="param-badge">wasserstein_last_activation_layer</span>
                            </label>
                            <select class="form-select" id="wassersteinLastActivation">
                                <option value="sigmoid">Sigmoid</option>
                                <option value="tanh">Tanh</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Initializer Mean
                                <span class="param-badge">wasserstein_initializer_mean</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinInitMean" value="0.0" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Initializer Deviation
                                <span class="param-badge">wasserstein_initializer_deviation</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinInitDev" value="0.256" step="0.05">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Latent Mean Distribution
                                <span class="param-badge">wasserstein_latent_mean_distribution</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinLatentMean" value="0.5" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Latent Stander Deviation
                                <span class="param-badge">wasserstein_latent_stander_deviation</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinLatentStd" value="0.125" step="0.025">
                        </div>
                    </div>
                </div>

                <!-- Wasserstein GP Parameters -->
                <div class="form-section" id="wassersteinGpParams" style="display: none;">
                    <div class="form-section-title">
                        <i class="fas fa-sliders-h"></i>
                        Par√¢metros do Wasserstein GAN GP
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                √âpocas
                                <span class="param-badge">wasserstein_gp_number_epochs</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinGpEpochs" value="300" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Batch Size
                                <span class="param-badge">wasserstein_gp_batch_size</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinGpBatchSize" value="64" min="16">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Dimens√£o Latente
                                <span class="param-badge">wasserstein_gp_latent_dimension</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinGpLatentDim" value="32" min="8">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Gradient Penalty
                                <span class="param-badge">wasserstein_gp_gradient_penalty</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinGpGradientPenalty" value="10.0" step="1.0">
                            <span class="form-hint">Peso da penalidade de gradiente</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Camadas Gerador
                                <span class="param-badge">wasserstein_gp_dense_layer_sizes_generator</span>
                            </label>
                            <input type="text" class="form-input" id="wassersteinGpLayersG" value="256">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Camadas Discriminador
                                <span class="param-badge">wasserstein_gp_dense_layer_sizes_discriminator</span>
                            </label>
                            <input type="text" class="form-input" id="wassersteinGpLayersD" value="64">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Dropout Gerador
                                <span class="param-badge">wasserstein_gp_dropout_decay_rate_g</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinGpDropoutG" value="0.0" step="0.05" min="0" max="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Dropout Discriminador
                                <span class="param-badge">wasserstein_gp_dropout_decay_rate_d</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinGpDropoutD" value="0.0" step="0.05" min="0" max="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Fun√ß√£o de Ativa√ß√£o
                                <span class="param-badge">wasserstein_gp_activation_function</span>
                            </label>
                            <select class="form-select" id="wassersteinGpActivation">
                                <option value="leakyrelu">LeakyReLU</option>
                                <option value="elu">ELU</option>
                                <option value="relu">ReLU</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Algoritmo de Treino
                                <span class="param-badge">wasserstein_gp_training_algorithm</span>
                            </label>
                            <select class="form-select" id="wassersteinGpOptimizer">
                                <option value="Adam">Adam</option>
                                <option value="RMSprop">RMSprop</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Learning Rate Gerador
                                <span class="param-badge">wasserstein_gp_optimizer_generator_learning_rate</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinGpLrG" value="0.001" step="0.0001">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Learning Rate Discriminador
                                <span class="param-badge">wasserstein_gp_optimizer_discriminator_learning_rate</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinGpLrD" value="0.001" step="0.0001">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Beta Gerador
                                <span class="param-badge">wasserstein_gp_optimizer_generator_beta</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinGpBetaG" value="0.5" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Beta Discriminador
                                <span class="param-badge">wasserstein_gp_optimizer_discriminator_beta</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinGpBetaD" value="0.5" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Discriminator Steps
                                <span class="param-badge">wasserstein_gp_discriminator_steps</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinGpDiscSteps" value="3" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Smoothing Rate
                                <span class="param-badge">wasserstein_gp_smoothing_rate</span>
                            </label>
                            <input type="number" class="form-input" id="wassersteinGpSmoothing" value="0.10" step="0.05">
                        </div>
                    </div>
                </div>

                <!-- Latent Diffusion Parameters -->
                <div class="form-section" id="latentDiffusionParams" style="display: none;">
                    <div class="form-section-title">
                        <i class="fas fa-sliders-h"></i>
                        Par√¢metros do Latent Diffusion
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                √âpocas UNet
                                <span class="param-badge">latent_diffusion_unet_epochs</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionUnetEpochs" value="300" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                √âpocas Autoencoder
                                <span class="param-badge">latent_diffusion_autoencoder_epochs</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionAeEpochs" value="300" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Dimens√£o Latente
                                <span class="param-badge">latent_diffusion_latent_dimension</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionLatentDim" value="32" min="8">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Batch Size
                                <span class="param-badge">latent_diffusion_unet_batch_size</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionUnetBatchSize" value="256" min="16">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Ativa√ß√£o Final
                                <span class="param-badge">latent_diffusion_unet_last_layer_activation</span>
                            </label>
                            <select class="form-select" id="latentDiffusionUnetLastActivation">
                                <option value="tanh">Tanh</option>
                                <option value="sigmoid">Sigmoid</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Num Embedding Channels
                                <span class="param-badge">latent_diffusion_unet_num_embedding_channels</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionUnetEmbedChannels" value="1" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Channels Per Level
                                <span class="param-badge">latent_diffusion_unet_channels_per_level</span>
                            </label>
                            <input type="text" class="form-input" id="latentDiffusionUnetChannels" value="1 2 4">
                            <span class="form-hint">Separados por espa√ßo</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Attention Mode
                                <span class="param-badge">latent_diffusion_unet_attention_mode</span>
                            </label>
                            <input type="text" class="form-input" id="latentDiffusionUnetAttention" value="False True True">
                            <span class="form-hint">Valores booleanos separados por espa√ßo</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Residual Blocks
                                <span class="param-badge">latent_diffusion_unet_num_residual_blocks</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionUnetResBlocks" value="2" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Group Normalization
                                <span class="param-badge">latent_diffusion_unet_group_normalization</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionUnetGroupNorm" value="1" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Ativa√ß√£o Intermedi√°ria
                                <span class="param-badge">latent_diffusion_unet_intermediary_activation</span>
                            </label>
                            <select class="form-select" id="latentDiffusionUnetIntermActivation">
                                <option value="elu">ELU</option>
                                <option value="relu">ReLU</option>
                                <option value="leakyrelu">LeakyReLU</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Activation Alpha
                                <span class="param-badge">latent_diffusion_unet_intermediary_activation_alpha</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionUnetActivationAlpha" value="0.05" step="0.01">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Gaussian Beta Start
                                <span class="param-badge">latent_diffusion_gaussian_beta_start</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionGaussianBetaStart" value="0.0001" step="0.0001">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Gaussian Beta End
                                <span class="param-badge">latent_diffusion_gaussian_beta_end</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionGaussianBetaEnd" value="0.02" step="0.01">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Gaussian Time Steps
                                <span class="param-badge">latent_diffusion_gaussian_time_steps</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionGaussianTimeSteps" value="300" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Gaussian Clip Min
                                <span class="param-badge">latent_diffusion_gaussian_clip_min</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionGaussianClipMin" value="-1.0" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Gaussian Clip Max
                                <span class="param-badge">latent_diffusion_gaussian_clip_max</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionGaussianClipMax" value="1.0" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Autoencoder Loss
                                <span class="param-badge">latent_diffusion_autoencoder_loss</span>
                            </label>
                            <select class="form-select" id="latentDiffusionAeLoss">
                                <option value="mse">MSE</option>
                                <option value="binary_crossentropy">Binary Crossentropy</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                AE Encoder Filters
                                <span class="param-badge">latent_diffusion_autoencoder_encoder_filters</span>
                            </label>
                            <input type="text" class="form-input" id="latentDiffusionAeEncFilters" value="64 32">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                AE Decoder Filters
                                <span class="param-badge">latent_diffusion_autoencoder_decoder_filters</span>
                            </label>
                            <input type="text" class="form-input" id="latentDiffusionAeDecFilters" value="32 64">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                AE Ativa√ß√£o Final
                                <span class="param-badge">latent_diffusion_autoencoder_last_layer_activation</span>
                            </label>
                            <select class="form-select" id="latentDiffusionAeLastActivation">
                                <option value="sigmoid">Sigmoid</option>
                                <option value="tanh">Tanh</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                AE Dimens√£o Latente
                                <span class="param-badge">latent_diffusion_autoencoder_latent_dimension</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionAeLatentDim" value="32" min="8">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                AE Batch Size Embedding
                                <span class="param-badge">latent_diffusion_autoencoder_batch_size_create_embedding</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionAeBatchEmbed" value="128" min="16">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                AE Batch Size Training
                                <span class="param-badge">latent_diffusion_autoencoder_batch_size_training</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionAeBatchTrain" value="128" min="16">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                AE Ativa√ß√£o Intermedi√°ria
                                <span class="param-badge">latent_diffusion_autoencoder_intermediary_activation_function</span>
                            </label>
                            <select class="form-select" id="latentDiffusionAeIntermActivation">
                                <option value="elu">ELU</option>
                                <option value="relu">ReLU</option>
                                <option value="leakyrelu">LeakyReLU</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                AE Activation Alpha
                                <span class="param-badge">latent_diffusion_autoencoder_intermediary_activation_alpha</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionAeActivationAlpha" value="0.05" step="0.01">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                AE Ativa√ß√£o Output Encoder
                                <span class="param-badge">latent_diffusion_autoencoder_activation_output_encoder</span>
                            </label>
                            <select class="form-select" id="latentDiffusionAeOutputEncActivation">
                                <option value="sigmoid">Sigmoid</option>
                                <option value="tanh">Tanh</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Margin
                                <span class="param-badge">latent_diffusion_margin</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionMargin" value="0.5" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                EMA
                                <span class="param-badge">latent_diffusion_ema</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionEma" value="0.999" step="0.001">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Time Steps
                                <span class="param-badge">latent_diffusion_time_steps</span>
                            </label>
                            <input type="number" class="form-input" id="latentDiffusionTimeSteps" value="300" min="1">
                        </div>
                    </div>
                </div>

                <!-- Denoising Diffusion Parameters -->
                <div class="form-section" id="denoisingDiffusionParams" style="display: none;">
                    <div class="form-section-title">
                        <i class="fas fa-sliders-h"></i>
                        Par√¢metros do Denoising Diffusion
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                √âpocas UNet
                                <span class="param-badge">denoising_diffusion_unet_epochs</span>
                            </label>
                            <input type="number" class="form-input" id="denoisingDiffusionUnetEpochs" value="300" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Batch Size
                                <span class="param-badge">denoising_diffusion_unet_batch_size</span>
                            </label>
                            <input type="number" class="form-input" id="denoisingDiffusionUnetBatchSize" value="128" min="16">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Ativa√ß√£o Final
                                <span class="param-badge">denoising_diffusion_unet_last_layer_activation</span>
                            </label>
                            <select class="form-select" id="denoisingDiffusionUnetLastActivation">
                                <option value="tanh">Tanh</option>
                                <option value="sigmoid">Sigmoid</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Num Embedding Channels
                                <span class="param-badge">denoising_diffusion_unet_num_embedding_channels</span>
                            </label>
                            <input type="number" class="form-input" id="denoisingDiffusionUnetEmbedChannels" value="1" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Channels Per Level
                                <span class="param-badge">denoising_diffusion_unet_channels_per_level</span>
                            </label>
                            <input type="text" class="form-input" id="denoisingDiffusionUnetChannels" value="1 2 4">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Attention Mode
                                <span class="param-badge">denoising_diffusion_unet_attention_mode</span>
                            </label>
                            <input type="text" class="form-input" id="denoisingDiffusionUnetAttention" value="False True True">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Residual Blocks
                                <span class="param-badge">denoising_diffusion_unet_num_residual_blocks</span>
                            </label>
                            <input type="number" class="form-input" id="denoisingDiffusionUnetResBlocks" value="2" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Group Normalization
                                <span class="param-badge">denoising_diffusion_unet_group_normalization</span>
                            </label>
                            <input type="number" class="form-input" id="denoisingDiffusionUnetGroupNorm" value="1" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Ativa√ß√£o Intermedi√°ria
                                <span class="param-badge">denoising_diffusion_unet_intermediary_activation</span>
                            </label>
                            <select class="form-select" id="denoisingDiffusionUnetIntermActivation">
                                <option value="ELU">ELU</option>
                                <option value="relu">ReLU</option>
                                <option value="leakyrelu">LeakyReLU</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                UNet Activation Alpha
                                <span class="param-badge">denoising_diffusion_unet_intermediary_activation_alpha</span>
                            </label>
                            <input type="number" class="form-input" id="denoisingDiffusionUnetActivationAlpha" value="0.05" step="0.01">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Gaussian Beta Start
                                <span class="param-badge">denoising_diffusion_gaussian_beta_start</span>
                            </label>
                            <input type="number" class="form-input" id="denoisingDiffusionGaussianBetaStart" value="0.0001" step="0.0001">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Gaussian Beta End
                                <span class="param-badge">denoising_diffusion_gaussian_beta_end</span>
                            </label>
                            <input type="number" class="form-input" id="denoisingDiffusionGaussianBetaEnd" value="0.02" step="0.01">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Gaussian Time Steps
                                <span class="param-badge">denoising_diffusion_gaussian_time_steps</span>
                            </label>
                            <input type="number" class="form-input" id="denoisingDiffusionGaussianTimeSteps" value="300" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Gaussian Clip Min
                                <span class="param-badge">denoising_diffusion_gaussian_clip_min</span>
                            </label>
                            <input type="number" class="form-input" id="denoisingDiffusionGaussianClipMin" value="-1.0" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Gaussian Clip Max
                                <span class="param-badge">denoising_diffusion_gaussian_clip_max</span>
                            </label>
                            <input type="number" class="form-input" id="denoisingDiffusionGaussianClipMax" value="1.0" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Margin
                                <span class="param-badge">denoising_diffusion_margin</span>
                            </label>
                            <input type="number" class="form-input" id="denoisingDiffusionMargin" value="0.5" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                EMA
                                <span class="param-badge">denoising_diffusion_ema</span>
                            </label>
                            <input type="number" class="form-input" id="denoisingDiffusionEma" value="0.999" step="0.001">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Time Steps
                                <span class="param-badge">denoising_diffusion_time_steps</span>
                            </label>
                            <input type="number" class="form-input" id="denoisingDiffusionTimeSteps" value="300" min="1">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="experiment-creator-footer">
            <button class="btn-secondary" onclick="closeExperimentCreator()">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="btn-secondary" onclick="saveExperimentConfig()">
                <i class="fas fa-save"></i> Salvar Configura√ß√£o
            </button>
            <button class="btn-primary" onclick="runExperiment()">
                <i class="fas fa-play"></i> Executar Experimento
            </button>
        </div>
    </div>
</div>

<!-- Top Navbar -->
<nav class="navbar">
    <div class="nav-content">
        <div class="nav-left">
            <button class="menu-toggle" id="menuToggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">
                <img src="Logo.png" alt="SynDataGen Logo" class="logo-img" width="50" height="50">
                <span>SynDataGen</span>
            </div>
        </div>
        <div class="nav-right">
            <button class="nav-btn" onclick="refreshExperiment()" title="Atualizar">
                <i class="fas fa-sync-alt"></i>
            </button>
            <button class="nav-btn" onclick="showNotificationsCenter()" title="Notifica√ß√µes">
                <i class="fas fa-bell"></i>
                <span class="nav-badge">3</span>
            </button>
            <button class="nav-btn" onclick="toggleTheme()" title="Alternar Tema">
                <i class="fas fa-moon" id="themeIcon"></i>
            </button>
            <button class="nav-btn" onclick="showSettings()" title="Configura√ß√µes">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </div>
</nav>

<!-- Sidebar -->
<aside class="sidebar" id="sidebar">
    <div class="sidebar-section">
        <div class="sidebar-title">
            <i class="fas fa-flask"></i>
            Experimentos
            <span id="totalExperiments" style="margin-left: auto; background: var(--primary); color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.7rem;">0</span>
        </div>
        <div class="experiment-list" id="experimentList">
            <!-- Experiments will be populated here -->
        </div>
    </div>

    <div class="sidebar-section">
        <div class="sidebar-title">
            <i class="fas fa-bolt"></i>
            A√ß√µes R√°pidas
        </div>
        <div class="quick-actions">
            <button class="action-btn" onclick="showExperimentCreator()" style="background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border: none; font-weight: 600;">
                <i class="fas fa-flask"></i>
                Criar Novo Experimento
            </button>
            <button class="action-btn" onclick="document.getElementById('fileInput').click()">
                <i class="fas fa-upload"></i>
                Carregar Mais JSONs
            </button>
            <button class="action-btn" onclick="exportCurrentExperiment()">
                <i class="fas fa-download"></i>
                Exportar CSV
            </button>
            <button class="action-btn" onclick="compareExperiments()">
                <i class="fas fa-columns"></i>
                Comparar Experimentos
            </button>
            <button class="action-btn" onclick="generateReport()">
                <i class="fas fa-file-alt"></i>
                Gerar Relat√≥rio
            </button>
            <button class="action-btn" onclick="exportAllExperiments()">
                <i class="fas fa-file-archive"></i>
                Exportar Todos
            </button>
            <button class="action-btn" onclick="resetDashboard()">
                <i class="fas fa-redo"></i>
                Limpar Tudo
            </button>
            <button class="action-btn" onclick="showDatasetManager()" style="background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; font-weight: 600;">
            <i class="fas fa-database"></i>
            Gerenciar Datasets
            </button>

        </div>
    </div>
</aside>

<!-- Main Content -->
<main class="main-content" id="mainContent">
    <!-- Upload Section -->
    <div class="upload-section" id="uploadSection">
        <div class="upload-container">
            <div class="upload-icon">
                <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <h1 class="upload-title">Carregue seus experimentos</h1>
            <p class="upload-subtitle">
                Arraste e solte um arquivo JSON ou clique para selecionar
            </p>
            <div class="file-input-wrapper">
                <input type="file" id="fileInput" class="file-input" accept=".json" multiple onchange="handleFileUpload(event)">
                <label for="fileInput" class="file-input-label">
                    <i class="fas fa-folder-open"></i>
                    Selecionar Arquivos JSON
                </label>
            </div>
            <p style="margin-top: 1rem; color: #6b7280; font-size: 0.875rem;">
                <i class="fas fa-info-circle"></i> Voc√™ pode selecionar m√∫ltiplos arquivos
            </p>
        </div>
    </div>

    <!-- Dashboard Content (Hidden by default) -->
    <div id="dashboardContent" style="display: none;">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="header-left">
                <h1 id="experimentTitle">Dashboard de Experimentos</h1>
                <div class="breadcrumb">
                    <i class="fas fa-home"></i>
                    <span>/</span>
                    <span id="breadcrumbPath">Dashboard</span>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="exportAsPDF()">
                    <i class="fas fa-file-pdf"></i>
                    Exportar PDF
                </button>
                <button class="btn btn-primary" onclick="shareExperiment()">
                    <i class="fas fa-share-alt"></i>
                    Compartilhar
                </button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs" id="metricsTabs">
            <div class="tab active" onclick="switchTab('classification')">
                <i class="fas fa-chart-bar"></i>
                Classifica√ß√£o
            </div>
            <div class="tab" onclick="switchTab('distance')">
                <i class="fas fa-ruler"></i>
                Dist√¢ncias
            </div>
            <div class="tab" onclick="switchTab('efficiency')">
                <i class="fas fa-tachometer-alt"></i>
                Efici√™ncia
            </div>
            <div class="tab" onclick="switchTab('monitoring')">
                <i class="fas fa-desktop"></i>
                Monitoramento
            </div>
            <div class="tab" onclick="switchTab('sdv')">
                <i class="fas fa-check-circle"></i>
                SDV Metrics
            </div>
            <div class="tab" onclick="switchTab('arguments')">
                <i class="fas fa-cog"></i>
                Argumentos
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid" id="statsGrid">
            <!-- Stats will be populated dynamically -->
        </div>

        <!-- Charts Section -->
        <div class="chart-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-chart-area"></i>
                    Visualiza√ß√µes
                </h2>
                <div class="section-actions">
                    <button class="icon-btn" onclick="refreshCharts()" title="Atualizar Gr√°ficos">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="icon-btn" onclick="downloadCharts()" title="Baixar Gr√°ficos">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </div>
            <div class="chart-grid" id="chartsContainer">
                <!-- Charts will be populated dynamically -->
            </div>
        </div>

        <!-- Metrics Table -->
        <div class="table-container">
            <div class="table-header">
                <h3 class="section-title">
                    <i class="fas fa-table"></i>
                    M√©tricas Detalhadas
                </h3>
                <div class="table-controls">
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" placeholder="Buscar modelo..." onkeyup="filterTable(this.value)">
                    </div>
                    <select class="filter-select" onchange="filterByMetric(this.value)">
                        <option value="all">Todos os Modelos</option>
                        <option value="high">Alta Performance (>70%)</option>
                        <option value="medium">M√©dia Performance (50-70%)</option>
                        <option value="low">Baixa Performance (<50%)</option>
                    </select>
                </div>
            </div>
            <div style="overflow-x: auto;">
                <table id="metricsTable">
                    <thead>
                    <tr>
                        <th onclick="sortTable(0)">Modelo <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable(1)">Fold <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable(2)">Accuracy <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable(3)">F1-Score <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable(4)">Precision <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable(5)">Recall <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable(6)">MSE <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable(7)">MAE <i class="fas fa-sort"></i></th>
                    </tr>
                    </thead>
                    <tbody id="metricsTableBody">
                    <!-- Table rows will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</main>

<script>
    let allExperiments = {};
    let experimentMetadata = {};
    let currentExperiment = null;
    let currentTab = 'classification';
    let charts = {};
    let isDarkMode = false;
    let isSidebarOpen = true;
    let comparisonMode = false;
    let monitoringInterval = null;


    // Helper function to extract value (handles both direct values and {mean, std} objects)
    function getValue(val, defaultValue = 0) {
        if (val === null || val === undefined) return defaultValue;
        if (typeof val === 'object' && val.mean !== undefined) {
            return val.mean;
        }
        return val;
    }




    // Nova fun√ß√£o: Renderiza mensagem para experimentos placeholder
    function renderPlaceholderMessage(data) {
        const statsGrid = document.getElementById('statsGrid');
        const container = document.getElementById('chartsContainer');
        const tbody = document.getElementById('metricsTableBody');

        if (!statsGrid || !container || !tbody) {
            console.error('‚ùå Elementos do dashboard n√£o encontrados!');
            return;
        }

        const experimentName = data.Arguments?.experiment_name || 'Experimento';
        const serverId = data.server_id || 'N/A';
        const createdAt = data.created_at ? new Date(data.created_at).toLocaleString('pt-BR') : 'N/A';
        const modelType = data.Arguments?.model_type || 'N/A';

        tbody.innerHTML = '';

        // Renderiza o progresso do treinamento
        renderTrainingProgress(serverId, experimentName, modelType, createdAt, statsGrid, container);
    }

    async function renderTrainingProgress(serverId, experimentName, modelType, createdAt, statsGrid, container) {
        // Cria containers de progresso
        statsGrid.innerHTML = `
            <div style="grid-column: 1 / -1;">
                <div id="trainingProgressContainer" style="padding: 2rem;">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <i class="fas fa-sync fa-spin" style="font-size: 2rem; color: var(--primary);"></i>
                        <p style="margin-top: 1rem;">Carregando dados de progresso...</p>
                    </div>
                </div>
            </div>
        `;

        // Busca os dados de progresso
        await fetchTrainingProgress(serverId, experimentName, modelType, createdAt);

        // Inicia polling a cada 2 segundos
        const pollInterval = setInterval(async () => {
            await fetchTrainingProgress(serverId, experimentName, modelType, createdAt);

            // Para o polling se o experimento foi conclu√≠do
            if (currentExperiment && allExperiments[currentExperiment] && !allExperiments[currentExperiment].is_placeholder) {
                clearInterval(pollInterval);
            }
        }, 2000);
    }

    async function fetchTrainingProgress(serverId, experimentName, modelType, createdAt) {
        try {
            const response = await fetch(`http://localhost:5000/api/experiments/${serverId}/training-progress`);
            const data = await response.json();

            const container = document.getElementById('trainingProgressContainer');
            if (!container) return;

            if (data.status === 'no_data') {
                container.innerHTML = `
                    <div style="text-align: center; max-width: 600px; margin: 0 auto;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">
                            <i class="fas fa-hourglass-half" style="color: var(--warning); animation: pulse 2s ease-in-out infinite;"></i>
                        </div>
                        <h2 style="margin-bottom: 1rem;">Inicializando Treinamento</h2>
                        <p style="color: #6b7280; margin-bottom: 2rem;">
                            O experimento <strong>"${experimentName}"</strong> est√° sendo preparado...
                        </p>
                        <div style="background: #f3f4f6; border-radius: 0.75rem; padding: 1.5rem;">
                            <div style="display: grid; gap: 0.75rem; text-align: left;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>ID:</span>
                                    <strong style="font-family: monospace;">${serverId}</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Modelo:</span>
                                    <strong>${modelType.toUpperCase()}</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Criado:</span>
                                    <strong>${createdAt}</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            if (data.status === 'success') {
                updateTrainingProgressUI(data, experimentName, modelType, createdAt, serverId);
            }

        } catch (error) {
            console.error('Erro ao buscar progresso:', error);
        }
    }

    async function updateTrainingProgressUI(data, experimentName, modelType, createdAt, serverId) {
        const container = document.getElementById('trainingProgressContainer');
        if (!container) return;

        const summary = data.summary;
        const monitors = data.monitors;

        // Buscar informa√ß√µes de recursos do sistema
        let resourcesHTML = '';
        try {
            const resourcesResponse = await fetch('http://localhost:5000/api/system-info');
            if (resourcesResponse.ok) {
                const resourcesData = await resourcesResponse.json();
                resourcesHTML = generateResourcesSection(resourcesData);
            }
        } catch (error) {
            console.warn('N√£o foi poss√≠vel obter informa√ß√µes de recursos:', error);
        }

        // HTML do progresso
        let html = `
            <div style="max-width: 1400px; margin: 0 auto;">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">
                        <i class="fas fa-chart-line status-running" style="color: var(--success);"></i>
                    </div>
                    <h2 style="margin-bottom: 0.5rem; font-weight: 900;">Treinamento em Andamento</h2>
                    <p style="color: #6b7280; font-size: 1.125rem;"><strong>"${experimentName}"</strong></p>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin-top: 0.5rem; font-size: 0.875rem; color: #9ca3af;">
                        <span><i class="fas fa-server"></i> ${serverId.substring(0, 8)}</span>
                        <span><i class="fas fa-brain"></i> ${modelType.toUpperCase()}</span>
                        <span><i class="fas fa-clock"></i> ${createdAt}</span>
                    </div>
                </div>

                <!-- Recursos do Sistema -->
                ${resourcesHTML}

                <!-- Progresso Geral -->
                <div style="background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; padding: 2rem; border-radius: 1rem; margin-bottom: 2rem; box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                        <div style="text-align: center;">
                            <div style="font-size: 2.5rem; font-weight: 900;">${summary.total_folds}</div>
                            <div style="opacity: 0.9; font-size: 0.875rem;">Total de Folds</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2.5rem; font-weight: 900;">${summary.total_epochs_completed}</div>
                            <div style="opacity: 0.9; font-size: 0.875rem;">√âpocas Completas</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2.5rem; font-weight: 900;">${summary.overall_progress.toFixed(1)}%</div>
                            <div style="opacity: 0.9; font-size: 0.875rem;">Progresso Geral</div>
                        </div>
                    </div>

                    <!-- Barra de Progresso -->
                    <div style="background: rgba(255,255,255,0.2); border-radius: 9999px; height: 28px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="background: linear-gradient(90deg, rgba(255,255,255,0.9), rgba(255,255,255,1)); height: 100%; width: ${summary.overall_progress}%; transition: width 0.5s ease; display: flex; align-items: center; justify-content: flex-end; padding-right: 0.75rem; font-weight: 700; color: var(--primary); font-size: 0.875rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            ${summary.overall_progress > 10 ? summary.overall_progress.toFixed(1) + '%' : ''}
                        </div>
                    </div>
                </div>

                <!-- M√©tricas Mais Recentes -->
                ${summary.latest_metrics ? `
                <div style="background: linear-gradient(135deg, #f0f9ff, #f0fdf4); padding: 1.5rem; border-radius: 1rem; margin-bottom: 2rem; border: 2px solid #e0f2fe;">
                    <h3 style="font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-chart-bar" style="color: var(--success);"></i>
                        M√©tricas Mais Recentes
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                        ${Object.entries(summary.latest_metrics).map(([key, value]) => `
                            <div style="background: white; padding: 1rem; border-radius: 0.5rem; border: 2px solid #e5e7eb; transition: all 0.2s;" onmouseover="this.style.borderColor='var(--primary)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.borderColor='#e5e7eb'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem; text-transform: uppercase; font-weight: 600;">${key}</div>
                                <div style="font-size: 1.5rem; font-weight: 900; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${typeof value === 'number' ? value.toFixed(6) : value}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}

                <!-- Detalhes por Fold -->
                <div style="display: grid; gap: 1.5rem;">
        `;

        // Adiciona informa√ß√µes de cada fold
        monitors.forEach((monitor, index) => {
            const monitorData = monitor.data;
            const foldNumber = monitor.fold !== null ? monitor.fold : index;

            if (!monitorData.epochs || monitorData.epochs.length === 0) return;

            const lastEpoch = monitorData.epochs[monitorData.epochs.length - 1];
            const progress = monitorData.status === 'Completed' ? 100 : (lastEpoch.epoch / monitorData.epochs.length * 100);
            const eta = monitorData.expected_finish ? new Date(monitorData.expected_finish * 1000).toLocaleTimeString('pt-BR') : 'Calculando...';

            // Calcula estat√≠sticas da loss
            const lossStats = calculateLossStats(monitorData.epochs);

            html += `
                <div style="background: white; border: 2px solid #e5e7eb; border-radius: 1rem; padding: 1.5rem; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);" onmouseover="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 8px 24px rgba(59, 130, 246, 0.15)'" onmouseout="this.style.borderColor='#e5e7eb'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="font-weight: 700; font-size: 1.125rem; color: var(--dark); display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-layer-group" style="color: var(--primary);"></i>
                            Fold ${foldNumber}
                        </h4>
                        <span style="background: ${monitorData.status === 'Completed' ? 'var(--success)' : 'var(--warning)'}; color: white; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            ${monitorData.status || 'Em Andamento'}
                        </span>
                    </div>

                    <!-- Progress Bar para o Fold -->
                    <div style="background: linear-gradient(135deg, #f3f4f6, #e5e7eb); border-radius: 9999px; height: 24px; overflow: hidden; margin-bottom: 1rem; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="background: linear-gradient(90deg, var(--primary), var(--secondary)); height: 100%; width: ${progress}%; transition: width 0.5s ease; display: flex; align-items: center; justify-content: flex-end; padding-right: 0.5rem; color: white; font-weight: 600; font-size: 0.75rem; box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
                            ${progress > 15 ? progress.toFixed(1) + '%' : ''}
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                        <div>
                            <div style="font-size: 0.75rem; color: #6b7280; font-weight: 600;">√âpoca Atual</div>
                            <div style="font-weight: 900; font-size: 1.25rem; color: var(--dark);">${lastEpoch.epoch} / ${monitorData.epochs.length}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.75rem; color: #6b7280; font-weight: 600;">Loss Atual</div>
                            <div style="font-weight: 900; font-size: 1.25rem; color: ${lossStats.trend === 'down' ? 'var(--success)' : 'var(--warning)'};">
                                ${lastEpoch.metrics.loss.toFixed(6)}
                                <i class="fas fa-arrow-${lossStats.trend === 'down' ? 'down' : 'up'}" style="font-size: 0.75rem; margin-left: 0.25rem;"></i>
                            </div>
                        </div>
                        <div>
                            <div style="font-size: 0.75rem; color: #6b7280; font-weight: 600;">Tempo/√âpoca</div>
                            <div style="font-weight: 900; font-size: 1.25rem; color: var(--primary);">${lastEpoch.time.toFixed(2)}s</div>
                        </div>
                        <div>
                            <div style="font-size: 0.75rem; color: #6b7280; font-weight: 600;">ETA</div>
                            <div style="font-weight: 900; font-size: 1.25rem; color: var(--info);">${eta}</div>
                        </div>
                    </div>

                    <!-- Estat√≠sticas da Loss -->
                    <div style="background: linear-gradient(135deg, #fdfdfd, #ffffff); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; border: 1px solid #ffffff;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 0.75rem; font-size: 0.75rem;">
                            <div>
                                <span style="color: #92400e; font-weight: 600;">Min:</span>
                                <span style="font-weight: 900; color: var(--success); margin-left: 0.25rem;">${lossStats.min.toFixed(6)}</span>
                            </div>
                            <div>
                                <span style="color: #92400e; font-weight: 600;">Max:</span>
                                <span style="font-weight: 900; color: var(--danger); margin-left: 0.25rem;">${lossStats.max.toFixed(6)}</span>
                            </div>
                            <div>
                                <span style="color: #92400e; font-weight: 600;">M√©dia:</span>
                                <span style="font-weight: 900; color: var(--primary); margin-left: 0.25rem;">${lossStats.avg.toFixed(6)}</span>
                            </div>
                            <div>
                                <span style="color: #92400e; font-weight: 600;">Redu√ß√£o:</span>
                                <span style="font-weight: 900; color: var(--success); margin-left: 0.25rem;">${lossStats.reduction.toFixed(2)}%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Gr√°fico de Loss Melhorado -->
                    <div style="background: #f9fafb; padding: 1rem; border-radius: 0.5rem; border: 1px solid #e5e7eb;">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-size: 0.875rem; font-weight: 700; color: #374151;">
                                <i class="fas fa-chart-line"></i> Evolu√ß√£o da Loss
                            </span>
                            <span style="font-size: 0.75rem; color: #6b7280;">
                                ${monitorData.epochs.length} √©pocas
                            </span>
                        </div>
                        <div style="height: 150px; position: relative;">
                            ${generateEnhancedLossChart(monitorData.epochs, foldNumber)}
                        </div>
                    </div>
                </div>
            `;
        });

        html += `
                </div>
            </div>
        `;

        container.innerHTML = html;
    }

    function generateResourcesSection(resourcesData) {
        const cpuPercent = resourcesData.cpu.percent;
        const memoryPercent = resourcesData.memory.percent;
        const gpuData = resourcesData.gpu && resourcesData.gpu.length > 0 ? resourcesData.gpu[0] : null;

        return `
            <div style="background: linear-gradient(135deg, #fff7ed, #ffedd5); padding: 1.5rem; border-radius: 1rem; margin-bottom: 2rem; border: 2px solid #758ef8;">
                <h3 style="font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; color: #9a3412;">
                    <i class="fas fa-server"></i>
                    Uso de Recursos do Sistema
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <!-- CPU -->
                    <div style="background: white; padding: 1rem; border-radius: 0.5rem; border: 2px solid #e5e7eb;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-size: 0.75rem; font-weight: 600; color: #6b7280;">
                                <i class="fas fa-microchip" style="color: var(--primary);"></i> CPU
                            </span>
                            <span style="font-size: 1.25rem; font-weight: 900; color: ${cpuPercent > 80 ? 'var(--danger)' : cpuPercent > 60 ? 'var(--warning)' : 'var(--success)'};">
                                ${cpuPercent}%
                            </span>
                        </div>
                        <div style="background: #f3f4f6; border-radius: 9999px; height: 8px; overflow: hidden;">
                            <div style="background: ${cpuPercent > 80 ? 'var(--danger)' : cpuPercent > 60 ? 'var(--warning)' : 'var(--success)'}; height: 100%; width: ${cpuPercent}%; transition: width 0.5s ease;"></div>
                        </div>
                    </div>

                    <!-- RAM -->
                    <div style="background: white; padding: 1rem; border-radius: 0.5rem; border: 2px solid #e5e7eb;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-size: 0.75rem; font-weight: 600; color: #6b7280;">
                                <i class="fas fa-memory" style="color: var(--success);"></i> RAM
                            </span>
                            <span style="font-size: 1.25rem; font-weight: 900; color: ${memoryPercent > 80 ? 'var(--danger)' : memoryPercent > 60 ? 'var(--warning)' : 'var(--success)'};">
                                ${memoryPercent}%
                            </span>
                        </div>
                        <div style="background: #f3f4f6; border-radius: 9999px; height: 8px; overflow: hidden;">
                            <div style="background: ${memoryPercent > 80 ? 'var(--danger)' : memoryPercent > 60 ? 'var(--warning)' : 'var(--success)'}; height: 100%; width: ${memoryPercent}%; transition: width 0.5s ease;"></div>
                        </div>
                        <div style="font-size: 0.65rem; color: #9ca3af; margin-top: 0.25rem;">
                            ${resourcesData.memory.used} GB / ${resourcesData.memory.total} GB
                        </div>
                    </div>

                    <!-- GPU -->
                    ${gpuData ? `
                    <div style="background: white; padding: 1rem; border-radius: 0.5rem; border: 2px solid #e5e7eb;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-size: 0.75rem; font-weight: 600; color: #6b7280;">
                                <i class="fas fa-server" style="color: var(--secondary);"></i> GPU
                            </span>
                            <span style="font-size: 1.25rem; font-weight: 900; color: ${gpuData.load > 80 ? 'var(--danger)' : gpuData.load > 60 ? 'var(--warning)' : 'var(--success)'};">
                                ${gpuData.load}%
                            </span>
                        </div>
                        <div style="background: #f3f4f6; border-radius: 9999px; height: 8px; overflow: hidden;">
                            <div style="background: ${gpuData.load > 80 ? 'var(--danger)' : gpuData.load > 60 ? 'var(--warning)' : 'var(--success)'}; height: 100%; width: ${gpuData.load}%; transition: width 0.5s ease;"></div>
                        </div>
                        <div style="font-size: 0.65rem; color: #9ca3af; margin-top: 0.25rem;">
                            ${gpuData.memory_used} MB / ${gpuData.memory_total} MB | ${gpuData.temperature}¬∞C
                        </div>
                    </div>
                    ` : ''}
                </div>
            </div>
        `;
    }

    function calculateLossStats(epochs) {
        if (!epochs || epochs.length === 0) return { min: 0, max: 0, avg: 0, reduction: 0, trend: 'stable' };

        const losses = epochs.map(e => e.metrics.loss);
        const min = Math.min(...losses);
        const max = Math.max(...losses);
        const avg = losses.reduce((a, b) => a + b, 0) / losses.length;
        const firstLoss = losses[0];
        const lastLoss = losses[losses.length - 1];
        const reduction = ((firstLoss - lastLoss) / firstLoss) * 100;

        // Determina tend√™ncia (√∫ltimos 20% das √©pocas)
        const recentCount = Math.max(3, Math.floor(losses.length * 0.2));
        const recentLosses = losses.slice(-recentCount);
        const recentAvg = recentLosses.reduce((a, b) => a + b, 0) / recentLosses.length;
        const previousAvg = losses.slice(-recentCount * 2, -recentCount).reduce((a, b) => a + b, 0) / recentCount;
        const trend = recentAvg < previousAvg ? 'down' : recentAvg > previousAvg ? 'up' : 'stable';

        return { min, max, avg, reduction, trend };}

    function generateEnhancedLossChart(epochs, foldNumber) {
        if (!epochs || epochs.length === 0) {
            return '<div style="text-align: center; padding: 2rem; color: #9ca3af;">Sem dados</div>';
        }

        const losses = epochs.map(e => e.metrics.loss);
        const max = Math.max(...losses);
        const min = Math.min(...losses);
        const range = max - min || 1;

        // Pontos do gr√°fico
        const points = epochs.map((epoch, i) => {
            const x = (i / (epochs.length - 1)) * 100;
            const y = 100 - ((epoch.metrics.loss - min) / range * 100);
            return `${x},${y}`;
        }).join(' ');

        // √Årea preenchida
        const areaPoints = `0,100 ${points} 100,100`;

        // Pontos de destaque (min, max, √∫ltimo)
        const minIndex = losses.indexOf(min);
        const maxIndex = losses.indexOf(max);
        const lastIndex = losses.length - 1;

        const getX = (index) => (index / (epochs.length - 1)) * 100;
        const getY = (loss) => 100 - ((loss - min) / range * 100);

        // Grid lines
        const gridLines = [0, 25, 50, 75, 100].map(y =>
            `<line x1="0" y1="${y}" x2="100" y2="${y}" stroke="#e5e7eb" stroke-width="0.5" stroke-dasharray="2,2"/>`
        ).join('');

        return `
        <svg width="100%" height="100%" viewBox="0 0 100 100" preserveAspectRatio="none" style="border: 2px solid #e5e7eb; border-radius: 0.5rem; background: linear-gradient(180deg, #ffffff 0%, #f9fafb 100%);">
            <!-- Grid -->
            ${gridLines}

            <!-- √Årea preenchida com gradiente -->
            <defs>
                <linearGradient id="lossGradient_${foldNumber}" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:rgb(16, 185, 129);stop-opacity:0.4" />
                    <stop offset="100%" style="stop-color:rgb(16, 185, 129);stop-opacity:0.05" />
                </linearGradient>
                <filter id="shadow_${foldNumber}">
                    <feGaussianBlur in="SourceAlpha" stdDeviation="0.5"/>
                    <feOffset dx="0" dy="1" result="offsetblur"/>
                    <feComponentTransfer>
                        <feFuncA type="linear" slope="0.3"/>
                    </feComponentTransfer>
                    <feMerge>
                        <feMergeNode/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
            </defs>
            <polygon points="${areaPoints}" fill="url(#lossGradient_${foldNumber})" />

            <!-- Linha principal -->
            <polyline
                points="${points}"
                fill="none"
                stroke="rgb(16, 185, 129)"
                stroke-width="1"
                stroke-linecap="round"
                stroke-linejoin="round"
                filter="url(#shadow_${foldNumber})"
                style="vector-effect: non-scaling-stroke;"
            />

            <!-- Pontos de destaque -->
            <!-- Ponto m√≠nimo (verde) -->
            <circle cx="${getX(minIndex)}" cy="${getY(min)}" r="1.5" fill="rgb(16, 185, 129)" stroke="white" stroke-width="0.5"/>

            <!-- Ponto m√°ximo (vermelho) -->
            <circle cx="${getX(maxIndex)}" cy="${getY(max)}" r="1.5" fill="rgb(239, 68, 68)" stroke="white" stroke-width="0.5"/>

            <!-- Ponto atual (azul pulsante) -->
            <circle cx="${getX(lastIndex)}" cy="${getY(losses[lastIndex])}" r="2" fill="rgb(59, 130, 246)" stroke="white" stroke-width="0.5">
                <animate attributeName="r" values="2;2.5;2" dur="1.5s" repeatCount="indefinite"/>
            </circle>
        </svg>
    `;
    }












    // Handle file upload
    function handleFileUpload(event) {
        const files = event.target.files;
        console.log('=== IN√çCIO handleFileUpload ===');
        console.log('Files selected:', files.length);
        if (!files || files.length === 0) return;

        let filesProcessed = 0;
        let filesWithErrors = [];
        const totalFiles = files.length;
        let lastLoadedExperiment = null; // Armazena o √∫ltimo experimento carregado

        Array.from(files).forEach(file => {
            console.log('Processing file:', file.name);
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    console.log('Parsing JSON for:', file.name);
                    const data = JSON.parse(e.target.result);
                    let experimentName = file.name.replace('.json', '');

                    // Check if experiment already exists
                    if (allExperiments[experimentName]) {
                        const timestamp = new Date().getTime();
                        experimentName = `${experimentName}_${timestamp}`;
                    }

                    console.log('Storing experiment:', experimentName);
                    // Store experiment
                    allExperiments[experimentName] = data;

                    // Extract metadata
                    experimentMetadata[experimentName] = {
                        modelType: data.Arguments?.model_type || 'unknown',
                        numFolds: extractNumFolds(data),
                        timestamp: new Date().toISOString(),
                        originalName: file.name.replace('.json', '')
                    };

                    console.log('Adding to sidebar:', experimentName);
                    // Add to sidebar
                    addExperimentToSidebar(experimentName);

                    filesProcessed++;
                    lastLoadedExperiment = experimentName; // Atualiza com o √∫ltimo experimento
                    console.log(`Files processed: ${filesProcessed}/${totalFiles}`);

                    // After all files are processed
                    if (filesProcessed === totalFiles) {
                        console.log('All files processed, showing dashboard');
                        console.log('Total experiments loaded:', Object.keys(allExperiments).length);
                        console.log('Experiment names:', Object.keys(allExperiments));

                        // Update counter
                        document.getElementById('totalExperiments').textContent = Object.keys(allExperiments).length;

                        // Show dashboard
                        document.getElementById('uploadSection').style.display = 'none';
                        document.getElementById('dashboardContent').style.display = 'block';

                        // For√ßa a sidebar a ficar vis√≠vel
                        const sidebar = document.getElementById('sidebar');
                        if (sidebar) {
                            sidebar.classList.remove('collapsed');
                        }

                        // MODIFICADO: Seleciona o √öLTIMO experimento carregado
                        if (lastLoadedExperiment) {
                            console.log('Selecting last loaded experiment:', lastLoadedExperiment);
                            setTimeout(() => {
                                selectExperiment(lastLoadedExperiment);
                            }, 100);
                        } else if (!currentExperiment && Object.keys(allExperiments).length > 0) {
                            const firstExp = Object.keys(allExperiments)[0];
                            console.log('Selecting first experiment:', firstExp);
                            setTimeout(() => {
                                selectExperiment(firstExp);
                            }, 100);
                        }

                        if (filesWithErrors.length > 0) {
                            showNotification(
                                `‚úì ${filesProcessed - filesWithErrors.length} de ${totalFiles} arquivo(s) carregado(s). ` +
                                `${filesWithErrors.length} com erro. Veja todos na barra lateral.`,
                                'warning'
                            );
                        } else {
                            const msg = totalFiles > 1
                                ? `‚úì ${filesProcessed} arquivos carregados! Veja todos na barra lateral √† esquerda.`
                                : `‚úì Arquivo carregado com sucesso!`;
                            showNotification(msg, 'success');
                        }
                        console.log('=== FIM handleFileUpload ===');
                    }

                } catch (error) {
                    console.error(`Erro ao carregar ${file.name}:`, error);
                    filesWithErrors.push(file.name);
                    filesProcessed++;

                    if (filesProcessed === totalFiles) {
                        if (filesWithErrors.length === totalFiles) {
                            showNotification('Erro ao carregar todos os arquivos. Verifique o formato.', 'error');
                        } else {
                            document.getElementById('uploadSection').style.display = 'none';
                            document.getElementById('dashboardContent').style.display = 'block';
                            document.getElementById('totalExperiments').textContent = Object.keys(allExperiments).length;

                            if (lastLoadedExperiment) {
                                setTimeout(() => selectExperiment(lastLoadedExperiment), 100);
                            } else if (!currentExperiment && Object.keys(allExperiments).length > 0) {
                                setTimeout(() => selectExperiment(Object.keys(allExperiments)[0]), 100);
                            }

                            showNotification(`${filesProcessed - filesWithErrors.length} arquivo(s) carregado(s). ${filesWithErrors.length} com erro.`, 'warning');
                        }
                    }
                }
            };

            reader.onerror = function() {
                console.error(`Erro ao ler arquivo ${file.name}`);
                filesWithErrors.push(file.name);
                filesProcessed++;

                if (filesProcessed === totalFiles) {
                    if (filesWithErrors.length === totalFiles) {
                        showNotification('Erro ao ler todos os arquivos', 'error');
                    } else {
                        document.getElementById('uploadSection').style.display = 'none';
                        document.getElementById('dashboardContent').style.display = 'block';

                        if (lastLoadedExperiment) {
                            setTimeout(() => selectExperiment(lastLoadedExperiment), 100);
                        } else if (Object.keys(allExperiments).length > 0) {
                            setTimeout(() => selectExperiment(Object.keys(allExperiments)[0]), 100);
                        }

                        showNotification(`${filesProcessed - filesWithErrors.length} arquivo(s) carregado(s)`, 'success');
                    }
                }
            };

            reader.readAsText(file);
        });

        // Clear the file input so the same file can be selected again
        event.target.value = '';
    }

    function extractNumFolds(data) {
        // Try ClassificationMetrics first
        if (data.ClassificationMetrics) {
            const models = Object.values(data.ClassificationMetrics);
            if (models.length > 0) {
                const folds = Object.keys(models[0]).filter(k => k.includes('Fold') && !k.includes('Summary'));
                return folds.length;
            }
        }

        // Try EfficiencyMetrics
        if (data.EfficiencyMetrics) {
            const folds = Object.keys(data.EfficiencyMetrics).filter(k => k.includes('Fold') && !k.includes('Summary'));
            return folds.length;
        }

        // Try Arguments
        if (data.Arguments && data.Arguments.number_k_folds) {
            return data.Arguments.number_k_folds;
        }

        return 0;
    }

    function addExperimentToSidebar(name) {
        console.log('Adding experiment to sidebar:', name);

        const list = document.getElementById('experimentList');
        if (!list) {
            console.error('‚ùå Elemento experimentList n√£o encontrado no DOM!');
            throw new Error('Elemento experimentList n√£o existe na p√°gina');
        }

        const metadata = experimentMetadata[name];
        if (!metadata) {
            console.error('‚ùå Metadata n√£o encontrado para:', name);
            throw new Error('Metadata n√£o encontrado para o experimento: ' + name);
        }

        console.log('Metadata:', metadata);

        const item = document.createElement('div');
        item.className = 'experiment-item';
        item.dataset.experimentName = name;

        // Main content (clickable)
        const mainContent = document.createElement('div');
        mainContent.style.flex = '1';
        mainContent.onclick = () => selectExperiment(name);
        mainContent.innerHTML = `
        <div class="experiment-name">
            <i class="fas fa-database"></i>
            ${metadata.originalName || name}
        </div>
        <div class="experiment-meta">
            <span class="meta-badge">
                <i class="fas fa-layer-group"></i>
                ${metadata.modelType || 'unknown'}
            </span>
            <span class="meta-badge">
                <i class="fas fa-folder"></i>
                ${metadata.numFolds || 0} Folds
            </span>
        </div>
    `;

        // Actions (not clickable for selection)
        const actions = document.createElement('div');
        actions.className = 'experiment-actions';
        actions.style.cssText = 'display: flex; gap: 0.25rem; margin-top: 0.5rem;';
        actions.innerHTML = `
        <button class="experiment-action-btn" onclick="event.stopPropagation(); removeExperiment('${name}')" title="Remover">
            <i class="fas fa-trash"></i>
        </button>
        <button class="experiment-action-btn" onclick="event.stopPropagation(); duplicateExperiment('${name}')" title="Duplicar">
            <i class="fas fa-copy"></i>
        </button>
        <button class="experiment-action-btn" onclick="event.stopPropagation(); downloadExperiment('${name}')" title="Baixar">
            <i class="fas fa-download"></i>
        </button>
    `;

        item.appendChild(mainContent);
        item.appendChild(actions);
        list.appendChild(item);
        console.log('‚úÖ Experiment added to sidebar successfully');
    }
    function createNewExperimentInSidebar(experimentConfig, serverId) {
        console.log('üìù Criando novo experimento na sidebar...');
        console.log('üìã Config recebido:', experimentConfig);
        console.log('üÜî Server ID:', serverId);

        try {
            // Verifica se os elementos necess√°rios existem
            const experimentList = document.getElementById('experimentList');
            if (!experimentList) {
                throw new Error('Elemento experimentList n√£o encontrado no DOM. A p√°gina pode n√£o estar completamente carregada.');
            }

            // Gera um nome √∫nico para o experimento
            const experimentName = `exp_${serverId}`;
            console.log('üìå Nome do experimento:', experimentName);

            // Cria metadados ANTES dos dados do experimento
            experimentMetadata[experimentName] = {
                modelType: experimentConfig.model_type || 'unknown',
                numFolds: parseInt(experimentConfig.number_k_folds) || 0,
                timestamp: new Date().toISOString(),
                originalName: experimentConfig.experiment_name || 'Novo Experimento',
                serverId: serverId,
                status: 'pending'
            };
            console.log('‚úÖ Metadados criados:', experimentMetadata[experimentName]);

            // Cria dados placeholder para o experimento
            const placeholderData = {
                Arguments: {
                    model_type: experimentConfig.model_type || 'unknown',
                    experiment_name: experimentConfig.experiment_name || 'Novo Experimento',
                    number_k_folds: parseInt(experimentConfig.number_k_folds) || 0
                },
                server_id: serverId,
                status: 'pending',
                created_at: new Date().toISOString(),
                classification_results: {},
                regression_results: {},
                is_placeholder: true
            };

            // Adiciona aos experimentos
            allExperiments[experimentName] = placeholderData;
            console.log('‚úÖ Experimento adicionado ao allExperiments');

            // Adiciona √† sidebar
            addExperimentToSidebar(experimentName);
            console.log('‚úÖ Adicionado √† sidebar');

            // Atualiza contador de experimentos
            const totalExpElement = document.getElementById('totalExperiments');
            if (totalExpElement) {
                const totalExperiments = Object.keys(allExperiments).length;
                totalExpElement.textContent = totalExperiments;
                console.log('‚úÖ Contador atualizado:', totalExperiments);
            } else {
                console.warn('‚ö†Ô∏è Elemento totalExperiments n√£o encontrado');
            }

            // Mostra dashboard se ainda n√£o estiver vis√≠vel
            const uploadSection = document.getElementById('uploadSection');
            const dashboardContent = document.getElementById('dashboardContent');

            if (uploadSection) {
                uploadSection.style.display = 'none';
                console.log('‚úÖ Upload section ocultada');
            } else {
                console.warn('‚ö†Ô∏è Elemento uploadSection n√£o encontrado');
            }

            if (dashboardContent) {
                dashboardContent.style.display = 'block';
                console.log('‚úÖ Dashboard exibido');
            } else {
                console.warn('‚ö†Ô∏è Elemento dashboardContent n√£o encontrado');
            }

            // Seleciona automaticamente o novo experimento
            selectExperiment(experimentName);
            console.log('‚úÖ Experimento selecionado');

            console.log('‚úÖ Experimento criado na sidebar com sucesso:', experimentName);

            return experimentName;

        } catch (error) {
            console.error('‚ùå Erro ao criar experimento na sidebar:', error);
            console.error('   Nome do erro:', error.name);
            console.error('   Mensagem:', error.message);
            console.error('   Stack:', error.stack);
            throw error; // Re-lan√ßa o erro para ser tratado no .then
        }
    }


    function selectExperiment(name) {
        console.log('Selecting experiment:', name);
        currentExperiment = name;

        // Update active state
        document.querySelectorAll('.experiment-item').forEach(item => {
            item.classList.remove('active');
            if (item.dataset.experimentName === name) {
                item.classList.add('active');
            }
        });

        // Update breadcrumb
        const displayName = experimentMetadata[name]?.originalName || name;
        document.getElementById('experimentTitle').textContent = displayName;
        document.getElementById('breadcrumbPath').textContent = `Dashboard / ${displayName}`;

        console.log('Rendering dashboard for:', name);
        // Render dashboard
        renderDashboard();
    }

    function removeExperiment(name) {
        const displayName = experimentMetadata[name]?.originalName || name;
        const serverId = experimentMetadata[name]?.serverId;

        if (confirm(`Deseja remover o experimento "${displayName}"?`)) {
            // Se o experimento tem um ID no servidor, tenta deletar l√° primeiro
            if (serverId) {
                console.log('üóëÔ∏è Deletando experimento do servidor:', serverId);

                fetch(`http://localhost:5000/api/experiments/${serverId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                    .then(response => {
                        console.log('üì® Resposta do servidor:', response.status);

                        if (!response.ok) {
                            throw new Error(`Erro HTTP: ${response.status}`);
                        }

                        return response.json();
                    })
                    .then(result => {
                        console.log('‚úÖ Experimento deletado do servidor:', result);

                        // Remove localmente ap√≥s sucesso no servidor
                        removeExperimentLocally(name);

                        showNotification(`Experimento "${displayName}" removido do servidor e localmente`, 'success');
                    })
                    .catch(error => {
                        console.error('‚ùå Erro ao deletar do servidor:', error);

                        // Pergunta se quer remover localmente mesmo assim
                        if (confirm(`N√£o foi poss√≠vel remover do servidor. Deseja remover apenas localmente?`)) {
                            removeExperimentLocally(name);
                            showNotification(`Experimento removido apenas localmente`, 'warning');
                        }
                    });
            } else {
                // Se n√£o tem ID do servidor, remove apenas localmente
                console.log('üìù Experimento sem ID do servidor, removendo apenas localmente');
                removeExperimentLocally(name);
                showNotification('Experimento removido com sucesso', 'success');
            }
        }
    }

    function removeExperimentLocally(name) {
        console.log('üóëÔ∏è Removendo experimento localmente:', name);

        // Remove from data structures
        delete allExperiments[name];
        delete experimentMetadata[name];

        // Remove from sidebar
        const item = document.querySelector(`.experiment-item[data-experiment-name="${name}"]`);
        if (item) {
            item.remove();
        }

        // Update counter
        const totalExpElement = document.getElementById('totalExperiments');
        if (totalExpElement) {
            totalExpElement.textContent = Object.keys(allExperiments).length;
        }

        // If it was the current experiment, select another or show upload section
        if (currentExperiment === name) {
            const remainingExperiments = Object.keys(allExperiments);
            if (remainingExperiments.length > 0) {
                selectExperiment(remainingExperiments[0]);
            } else {
                currentExperiment = null;
                document.getElementById('uploadSection').style.display = 'block';
                document.getElementById('dashboardContent').style.display = 'none';
            }
        }

        console.log('‚úÖ Experimento removido localmente');
    }

    function duplicateExperiment(name) {
        const timestamp = new Date().getTime();
        const newName = `${name}_copy_${timestamp}`;

        // Deep clone the data
        allExperiments[newName] = JSON.parse(JSON.stringify(allExperiments[name]));

        // Clone metadata
        experimentMetadata[newName] = {
            ...experimentMetadata[name],
            originalName: (experimentMetadata[name]?.originalName || name) + ' (c√≥pia)',
            timestamp: new Date().toISOString()
        };

        // Add to sidebar
        addExperimentToSidebar(newName);

        // Update counter
        document.getElementById('totalExperiments').textContent = Object.keys(allExperiments).length;

        // Select the new experiment
        selectExperiment(newName);

        showNotification('Experimento duplicado com sucesso', 'success');
    }

    function downloadExperiment(name) {
        const data = allExperiments[name];
        const json = JSON.stringify(data, null, 2);
        const blob = new Blob([json], { type: 'application/json' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${experimentMetadata[name]?.originalName || name}.json`;
        a.click();
        window.URL.revokeObjectURL(url);

        showNotification('Download iniciado', 'success');
    }

    function showNotification(message, type = 'info') {
        const container = document.getElementById('toastContainer');

        const toast = document.createElement('div');
        toast.className = `toast ${type}`;

        const icons = {
            success: 'fa-check-circle',
            error: 'fa-exclamation-circle',
            warning: 'fa-exclamation-triangle',
            info: 'fa-info-circle'
        };

        toast.innerHTML = `
            <i class="fas ${icons[type]} toast-icon"></i>
            <span class="toast-message">${message}</span>
            <button class="toast-close" onclick="this.parentElement.remove()">
                <i class="fas fa-times"></i>
            </button>
        `;

        container.appendChild(toast);

        // Auto remove after 5 seconds
        setTimeout(() => {
            toast.remove();
        }, 5000);
    }

    // Alias para showNotification
    const showToast = showNotification;

    function switchTab(tabName) {
        // Limpar intervalo de monitoramento se estiver ativo
        if (monitoringInterval) {
            clearInterval(monitoringInterval);
            monitoringInterval = null;
        }

        currentTab = tabName;

        // Update active tab
        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('active');
        });
        event.target.closest('.tab').classList.add('active');

        // Re-render dashboard based on tab
        renderDashboard();
    }

    function renderDashboard() {
        console.log('renderDashboard called for:', currentExperiment, 'tab:', currentTab);
        if (!currentExperiment) {
            console.warn('No current experiment selected');
            return;
        }

        const data = allExperiments[currentExperiment];
        console.log('Experiment data:', data);

        // Verifica se √© um experimento placeholder (rec√©m-criado sem dados)
        if (data && data.is_placeholder) {
            console.log('‚è≥ Experimento placeholder detectado - mostrando mensagem de aguarde');
            renderPlaceholderMessage(data);
            return;
        }

        switch(currentTab) {
            case 'classification':
                console.log('Rendering classification metrics');
                renderClassificationMetrics(data);
                break;
            case 'distance':
                console.log('Rendering distance metrics');
                renderDistanceMetrics(data);
                break;
            case 'efficiency':
                console.log('Rendering efficiency metrics');
                renderEfficiencyMetrics(data);
                break;
            case 'monitoring':
                console.log('Rendering monitoring metrics');
                renderMonitoringMetrics(data);
                break;
            case 'sdv':
                console.log('Rendering SDV metrics');
                renderSDVMetrics(data);
                break;
            case 'arguments':
                console.log('Rendering arguments');
                renderArguments(data);
                break;
        }
    }


    // Nova fun√ß√£o: Verifica status do experimento no servidor
    function checkExperimentStatus(serverId) {
        console.log('üîç Verificando status do experimento:', serverId);
        showToast('Verificando status do experimento...', 'info');

        // Aqui voc√™ pode adicionar uma chamada ao servidor para verificar o status
        const flaskServerUrl = `http://localhost:5000/api/experiments/${serverId}`;

        fetch(flaskServerUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Experimento n√£o encontrado no servidor');
                }
                return response.json();
            })
            .then(result => {
                console.log('üìä Status do experimento:', result);
                showToast('Status: Ainda em processamento', 'info');
                // Aqui voc√™ pode atualizar os dados se o servidor retornar resultados
            })
            .catch(error => {
                console.error('‚ùå Erro ao verificar status:', error);
                showToast('N√£o foi poss√≠vel verificar o status. Verifique se o servidor est√° rodando.', 'error');
            });
    }

    function renderClassificationMetrics(data) {
        // Check for classification data in various evaluation sections
        const evaluationSections = ['TS-TR', 'TR-TS', 'TR-TR'];
        let classificationData = null;

        // Try to find data in evaluation sections first
        for (const section of evaluationSections) {
            if (data[section]) {
                classificationData = data[section];
                break;
            }
        }

        // Fallback to ClassificationMetrics if it exists
        if (!classificationData && data.ClassificationMetrics) {
            classificationData = data.ClassificationMetrics;
        }

        if (!classificationData) {
            showNoDataMessage();
            return;
        }

        // Render stats cards
        renderClassificationStats(classificationData);

        // Render charts
        renderClassificationCharts(classificationData);

        // Render table with all evaluation sections
        renderClassificationTable(data);
    }

    function renderClassificationStats(metrics) {
        const statsGrid = document.getElementById('statsGrid');
        statsGrid.innerHTML = '';

        // Calculate overall statistics
        let totalModels = 0;
        let avgAccuracy = 0;
        let avgF1 = 0;
        let bestModel = '';
        let bestAccuracy = 0;

        Object.entries(metrics).forEach(([modelName, folds]) => {
            totalModels++;
            const summary = folds.Summary;
            if (summary && summary.Accuracy) {
                // Handle both direct value and {mean, std} structure
                const acc = (typeof summary.Accuracy === 'object' ? summary.Accuracy.mean : summary.Accuracy) * 100;
                const f1 = (typeof summary.F1Score === 'object' ? summary.F1Score.mean : summary.F1Score || 0) * 100;

                avgAccuracy += acc;
                avgF1 += f1;

                if (acc > bestAccuracy) {
                    bestAccuracy = acc;
                    bestModel = modelName;
                }
            }
        });

        avgAccuracy /= totalModels;
        avgF1 /= totalModels;

        const stats = [
            {
                icon: 'fa-brain',
                label: 'Total de Modelos',
                value: totalModels,
                color: 'var(--primary)',
                trend: null
            },
            {
                icon: 'fa-percentage',
                label: 'Accuracy M√©dia',
                value: avgAccuracy.toFixed(2) + '%',
                color: 'var(--success)',
                trend: { value: '+2.5%', up: true }
            },
            {
                icon: 'fa-chart-line',
                label: 'F1-Score M√©dio',
                value: avgF1.toFixed(2) + '%',
                color: 'var(--info)',
                trend: { value: '+1.8%', up: true }
            },
            {
                icon: 'fa-trophy',
                label: 'Melhor Modelo',
                value: bestModel,
                subvalue: bestAccuracy.toFixed(2) + '%',
                color: 'var(--warning)',
                trend: null
            }
        ];

        stats.forEach(stat => {
            const card = document.createElement('div');
            card.className = 'stat-card';
            card.innerHTML = `
                <div class="stat-header">
                    <div class="stat-icon" style="background: ${stat.color}20; color: ${stat.color};">
                        <i class="fas ${stat.icon}"></i>
                    </div>
                </div>
                <div class="stat-value">${stat.value}</div>
                ${stat.subvalue ? `<div class="stat-label">${stat.subvalue}</div>` : ''}
                <div class="stat-label">${stat.label}</div>
                ${stat.trend ? `
                    <div class="stat-trend ${stat.trend.up ? 'trend-up' : 'trend-down'}">
                        <i class="fas fa-arrow-${stat.trend.up ? 'up' : 'down'}"></i>
                        ${stat.trend.value}
                    </div>
                ` : ''}
            `;
            statsGrid.appendChild(card);
        });
    }

    function renderClassificationCharts(metrics) {
        const container = document.getElementById('chartsContainer');
        container.innerHTML = '';

        // Destroy existing charts
        Object.values(charts).forEach(chart => chart?.destroy());
        charts = {};

        // Prepare data for charts
        const chartData = prepareClassificationChartData(metrics);

        // Create chart cards
        const chartConfigs = [
            {
                id: 'accuracyChart',
                title: 'Accuracy por Modelo',
                type: 'bar',
                data: chartData.accuracy,
                color: 'rgba(59, 130, 246, 0.8)'
            },
            {
                id: 'f1Chart',
                title: 'F1-Score por Modelo',
                type: 'bar',
                data: chartData.f1,
                color: 'rgba(16, 185, 129, 0.8)'
            },
            {
                id: 'precisionRecallChart',
                title: 'Precision vs Recall',
                type: 'radar',
                data: [chartData.precision, chartData.recall],
                labels: ['Precision', 'Recall']
            },
            {
                id: 'errorChart',
                title: 'M√©tricas de Erro',
                type: 'bar',
                data: [chartData.mse, chartData.mae],
                labels: ['MSE', 'MAE']
            }
        ];

        chartConfigs.forEach(config => {
            const card = document.createElement('div');
            card.className = 'chart-card';
            card.innerHTML = `
                <div class="chart-header">
                    <h3 class="chart-title">${config.title}</h3>
                </div>
                <div class="chart-container">
                    <canvas id="${config.id}"></canvas>
                </div>
            `;
            container.appendChild(card);
        });

        // Create charts
        setTimeout(() => createClassificationCharts(chartData), 100);
    }

    function prepareClassificationChartData(metrics) {
        const labels = [];
        const accuracy = [];
        const f1 = [];
        const precision = [];
        const recall = [];
        const mse = [];
        const mae = [];

        // Obter precis√£o das settings
        const precision_decimals = parseInt(localStorage.getItem('chartPrecision') || '2');

        Object.entries(metrics).forEach(([modelName, folds]) => {
            const summary = folds.Summary;
            if (summary) {
                labels.push(modelName);
                accuracy.push((getValue(summary.Accuracy) * 100).toFixed(precision_decimals));
                f1.push((getValue(summary.F1Score) * 100).toFixed(precision_decimals));
                precision.push((getValue(summary.Precision) * 100).toFixed(precision_decimals));
                recall.push((getValue(summary.Recall) * 100).toFixed(precision_decimals));
                mse.push(getValue(summary.MeanSquareError).toFixed(precision_decimals));
                mae.push(getValue(summary.MeanAbsoluteError).toFixed(precision_decimals));
            }
        });

        return { labels, accuracy, f1, precision, recall, mse, mae };
    }

    function getChartAnimationOptions() {
        const animationSpeed = localStorage.getItem('chartAnimationSpeed') || 'normal';
        const durations = {
            'slow': 2000,
            'normal': 1000,
            'fast': 500,
            'none': 0
        };

        return {
            animation: {
                duration: durations[animationSpeed]
            }
        };
    }

    function createClassificationCharts(chartData) {
        const isDark = document.body.classList.contains('dark-mode');
        const textColor = isDark ? '#f1f5f9' : '#0f172a';
        const gridColor = isDark ? '#334155' : '#e5e7eb';
        const animationOptions = getChartAnimationOptions();

        // Accuracy Chart
        charts.accuracy = new Chart(document.getElementById('accuracyChart'), {
            type: 'bar',
            data: {
                labels: chartData.labels,
                datasets: [{
                    label: 'Accuracy (%)',
                    data: chartData.accuracy,
                    backgroundColor: 'rgba(59, 130, 246, 0.8)',
                    borderColor: 'rgba(59, 130, 246, 1)',
                    borderWidth: 2,
                    borderRadius: 8
                }]
            },
            options: {
                ...animationOptions,
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { labels: { color: textColor } },
                    tooltip: {
                        backgroundColor: isDark ? '#1e293b' : '#ffffff',
                        titleColor: isDark ? '#f1f5f9' : '#0f172a',
                        bodyColor: isDark ? '#f1f5f9' : '#0f172a',
                        borderColor: gridColor,
                        borderWidth: 1
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        grid: { color: gridColor },
                        ticks: { color: textColor }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: textColor }
                    }
                }
            }
        });

        // F1-Score Chart
        charts.f1 = new Chart(document.getElementById('f1Chart'), {
            type: 'bar',
            data: {
                labels: chartData.labels,
                datasets: [{
                    label: 'F1-Score (%)',
                    data: chartData.f1,
                    backgroundColor: 'rgba(16, 185, 129, 0.8)',
                    borderColor: 'rgba(16, 185, 129, 1)',
                    borderWidth: 2,
                    borderRadius: 8
                }]
            },
            options: {
                ...animationOptions,
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { labels: { color: textColor } },
                    tooltip: {
                        backgroundColor: isDark ? '#1e293b' : '#ffffff',
                        titleColor: isDark ? '#f1f5f9' : '#0f172a',
                        bodyColor: isDark ? '#f1f5f9' : '#0f172a',
                        borderColor: gridColor,
                        borderWidth: 1
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        grid: { color: gridColor },
                        ticks: { color: textColor }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: textColor }
                    }
                }
            }
        });

        // Precision vs Recall Radar Chart
        charts.radar = new Chart(document.getElementById('precisionRecallChart'), {
            type: 'radar',
            data: {
                labels: chartData.labels,
                datasets: [
                    {
                        label: 'Precision',
                        data: chartData.precision,
                        backgroundColor: 'rgba(139, 92, 246, 0.2)',
                        borderColor: 'rgba(139, 92, 246, 1)',
                        borderWidth: 2
                    },
                    {
                        label: 'Recall',
                        data: chartData.recall,
                        backgroundColor: 'rgba(6, 182, 212, 0.2)',
                        borderColor: 'rgba(6, 182, 212, 1)',
                        borderWidth: 2
                    }
                ]
            },
            options: {
                ...animationOptions,
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { labels: { color: textColor } }
                },
                scales: {
                    r: {
                        beginAtZero: true,
                        max: 100,
                        grid: { color: gridColor },
                        ticks: { color: textColor },
                        pointLabels: { color: textColor }
                    }
                }
            }
        });

        // Error Chart
        charts.error = new Chart(document.getElementById('errorChart'), {
            type: 'bar',
            data: {
                labels: chartData.labels,
                datasets: [
                    {
                        label: 'MSE',
                        data: chartData.mse,
                        backgroundColor: 'rgba(239, 68, 68, 0.8)',
                        borderColor: 'rgba(239, 68, 68, 1)',
                        borderWidth: 2,
                        borderRadius: 8
                    },
                    {
                        label: 'MAE',
                        data: chartData.mae,
                        backgroundColor: 'rgba(245, 158, 11, 0.8)',
                        borderColor: 'rgba(245, 158, 11, 1)',
                        borderWidth: 2,
                        borderRadius: 8
                    }
                ]
            },
            options: {
                ...animationOptions,
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { labels: { color: textColor } },
                    tooltip: {
                        backgroundColor: isDark ? '#1e293b' : '#ffffff',
                        titleColor: isDark ? '#f1f5f9' : '#0f172a',
                        bodyColor: isDark ? '#f1f5f9' : '#0f172a',
                        borderColor: gridColor,
                        borderWidth: 1
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: gridColor },
                        ticks: { color: textColor }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: textColor }
                    }
                }
            }
        });
    }

    function renderClassificationTable(data) {
        const tbody = document.getElementById('metricsTableBody');
        tbody.innerHTML = '';

        // Obter precis√£o das settings
        const precision_decimals = parseInt(localStorage.getItem('chartPrecision') || '2');

        // Define evaluation sections to check
        const evaluationSections = ['TS-TR', 'TR-TS', 'TR-TR'];

        // Check if we have ClassificationMetrics (old format) or evaluation sections (new format)
        let hasOldFormat = data.ClassificationMetrics;
        let hasNewFormat = evaluationSections.some(section => data[section]);

        if (hasNewFormat) {
            // New format: iterate through evaluation sections
            evaluationSections.forEach(evalSection => {
                if (!data[evalSection]) return;

                const metrics = data[evalSection];

                Object.entries(metrics).forEach(([modelName, folds]) => {
                    Object.entries(folds).forEach(([fold, foldData]) => {
                        if (fold === 'Summary') {
                            // Show summary as separate row
                            const row = document.createElement('tr');
                            row.style.fontWeight = 'bold';
                            row.style.background = isDarkMode ? '#0f172a' : '#f9fafb';

                            const accuracy = getValue(foldData.Accuracy) * 100;
                            const badge = accuracy >= 70 ? 'badge-success' : accuracy >= 50 ? 'badge-warning' : 'badge-danger';

                            row.innerHTML = `
                                <td>${evalSection} - ${modelName}</td>
                                <td>M√©dia (Summary)</td>
                                <td><span class="metric-badge ${badge}">${accuracy.toFixed(precision_decimals)}%</span></td>
                                <td>${(getValue(foldData.F1Score) * 100).toFixed(precision_decimals)}%</td>
                                <td>${(getValue(foldData.Precision) * 100).toFixed(precision_decimals)}%</td>
                                <td>${(getValue(foldData.Recall) * 100).toFixed(precision_decimals)}%</td>
                                <td>${getValue(foldData.MeanSquareError).toFixed(precision_decimals)}</td>
                                <td>${getValue(foldData.MeanAbsoluteError).toFixed(precision_decimals)}</td>
                            `;
                            tbody.appendChild(row);
                        } else if (fold.includes('Fold')) {
                            const row = document.createElement('tr');

                            const accuracy = getValue(foldData.Accuracy) * 100;
                            const badge = accuracy >= 70 ? 'badge-success' : accuracy >= 50 ? 'badge-warning' : 'badge-danger';

                            row.innerHTML = `
                                <td>${evalSection} - ${modelName}</td>
                                <td>${fold}</td>
                                <td><span class="metric-badge ${badge}">${accuracy.toFixed(precision_decimals)}%</span></td>
                                <td>${(getValue(foldData.F1Score) * 100).toFixed(precision_decimals)}%</td>
                                <td>${(getValue(foldData.Precision) * 100).toFixed(precision_decimals)}%</td>
                                <td>${(getValue(foldData.Recall) * 100).toFixed(precision_decimals)}%</td>
                                <td>${getValue(foldData.MeanSquareError).toFixed(precision_decimals)}</td>
                                <td>${getValue(foldData.MeanAbsoluteError).toFixed(precision_decimals)}</td>
                            `;
                            tbody.appendChild(row);
                        }
                    });
                });
            });
        } else if (hasOldFormat) {
            // Old format: use ClassificationMetrics directly
            const metrics = data.ClassificationMetrics;

            Object.entries(metrics).forEach(([modelName, folds]) => {
                Object.entries(folds).forEach(([fold, foldData]) => {
                    if (fold === 'Summary') {
                        // Show summary as separate row
                        const row = document.createElement('tr');
                        row.style.fontWeight = 'bold';
                        row.style.background = isDarkMode ? '#0f172a' : '#f9fafb';

                        const accuracy = getValue(foldData.Accuracy) * 100;
                        const badge = accuracy >= 70 ? 'badge-success' : accuracy >= 50 ? 'badge-warning' : 'badge-danger';

                        row.innerHTML = `
                            <td>${modelName}</td>
                            <td>M√©dia (Summary)</td>
                            <td><span class="metric-badge ${badge}">${accuracy.toFixed(precision_decimals)}%</span></td>
                            <td>${(getValue(foldData.F1Score) * 100).toFixed(precision_decimals)}%</td>
                            <td>${(getValue(foldData.Precision) * 100).toFixed(precision_decimals)}%</td>
                            <td>${(getValue(foldData.Recall) * 100).toFixed(precision_decimals)}%</td>
                            <td>${getValue(foldData.MeanSquareError).toFixed(precision_decimals)}</td>
                            <td>${getValue(foldData.MeanAbsoluteError).toFixed(precision_decimals)}</td>
                        `;
                        tbody.appendChild(row);
                    } else if (fold.includes('Fold')) {
                        const row = document.createElement('tr');

                        const accuracy = getValue(foldData.Accuracy) * 100;
                        const badge = accuracy >= 70 ? 'badge-success' : accuracy >= 50 ? 'badge-warning' : 'badge-danger';

                        row.innerHTML = `
                            <td>${modelName}</td>
                            <td>${fold}</td>
                            <td><span class="metric-badge ${badge}">${accuracy.toFixed(precision_decimals)}%</span></td>
                            <td>${(getValue(foldData.F1Score) * 100).toFixed(precision_decimals)}%</td>
                            <td>${(getValue(foldData.Precision) * 100).toFixed(precision_decimals)}%</td>
                            <td>${(getValue(foldData.Recall) * 100).toFixed(precision_decimals)}%</td>
                            <td>${getValue(foldData.MeanSquareError).toFixed(precision_decimals)}</td>
                            <td>${getValue(foldData.MeanAbsoluteError).toFixed(precision_decimals)}</td>
                        `;
                        tbody.appendChild(row);
                    }
                });
            });
        }
    }

    function renderDistanceMetrics(data) {
        if (!data.DistanceMetrics) {
            showNoDataMessage();
            return;
        }

        const metrics = data.DistanceMetrics;
        const statsGrid = document.getElementById('statsGrid');
        const container = document.getElementById('chartsContainer');
        const tbody = document.getElementById('metricsTableBody');

        // Clear previous content
        statsGrid.innerHTML = '';
        container.innerHTML = '';
        tbody.innerHTML = '';

        // Render stats - get averages from Summary of each comparison type
        const distanceTypes = ['EuclideanDistance', 'HellingerDistance', 'ManhattanDistance', 'HammingDistance', 'JaccardDistance'];
        const comparisonTypes = Object.keys(metrics); // S-S, S-R, R-S, R-R

        // Create stats for the first few distance metrics from first comparison type
        const firstType = comparisonTypes[0];
        if (metrics[firstType] && metrics[firstType].Summary) {
            const stats = [];
            const colors = ['var(--primary)', 'var(--success)', 'var(--warning)', 'var(--info)'];
            const icons = ['fa-ruler', 'fa-ruler-horizontal', 'fa-ruler-vertical', 'fa-ruler-combined'];

            distanceTypes.slice(0, 4).forEach((distType, i) => {
                if (metrics[firstType].Summary[distType]) {
                    stats.push({
                        icon: icons[i],
                        label: `${firstType} - ${distType}`,
                        value: getValue(metrics[firstType].Summary[distType]).toFixed(4),
                        color: colors[i]
                    });
                }
            });

            stats.forEach(stat => {
                const card = document.createElement('div');
                card.className = 'stat-card';
                card.innerHTML = `
                    <div class="stat-header">
                        <div class="stat-icon" style="background: ${stat.color}20; color: ${stat.color};">
                            <i class="fas ${stat.icon}"></i>
                        </div>
                    </div>
                    <div class="stat-value">${stat.value}</div>
                    <div class="stat-label">${stat.label}</div>
                `;
                statsGrid.appendChild(card);
            });
        }

        // Render charts - one chart per comparison type
        comparisonTypes.forEach(compType => {
            const chartCard = document.createElement('div');
            chartCard.className = 'chart-card';
            chartCard.innerHTML = `
                <div class="chart-header">
                    <h3 class="chart-title">Dist√¢ncias - ${compType}</h3>
                </div>
                <div class="chart-container">
                    <canvas id="distanceChart_${compType}"></canvas>
                </div>
            `;
            container.appendChild(chartCard);
        });

        // Create charts
        setTimeout(() => {
            const isDark = document.body.classList.contains('dark-mode');
            const textColor = isDark ? '#f1f5f9' : '#0f172a';
            const gridColor = isDark ? '#334155' : '#e5e7eb';

            comparisonTypes.forEach(compType => {
                const compData = metrics[compType];
                if (!compData) return;

                const labels = [];
                const datasets = {};

                // Collect fold data
                Object.entries(compData).forEach(([fold, foldData]) => {
                    if (fold !== 'Summary' && foldData) {
                        labels.push(fold);

                        distanceTypes.forEach(distType => {
                            if (!datasets[distType]) {
                                datasets[distType] = [];
                            }
                            datasets[distType].push(getValue(foldData[distType]).toFixed(4));
                        });
                    }
                });

                const colors = [
                    'rgba(59, 130, 246, 0.8)',
                    'rgba(16, 185, 129, 0.8)',
                    'rgba(245, 158, 11, 0.8)',
                    'rgba(239, 68, 68, 0.8)',
                    'rgba(139, 92, 246, 0.8)'
                ];

                const chartDatasets = Object.entries(datasets).map(([name, data], i) => ({
                    label: name,
                    data: data,
                    backgroundColor: colors[i],
                    borderColor: colors[i].replace('0.8', '1'),
                    borderWidth: 2,
                    borderRadius: 8
                }));

                charts[`distance_${compType}`] = new Chart(document.getElementById(`distanceChart_${compType}`), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: chartDatasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { labels: { color: textColor } }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: gridColor },
                                ticks: { color: textColor }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: textColor }
                            }
                        }
                    }
                });
            });
        }, 100);

        // Render table
        const thead = document.querySelector('#metricsTable thead tr');
        thead.innerHTML = `
            <th>Tipo de Compara√ß√£o</th>
            <th>Fold</th>
            <th>Euclidean</th>
            <th>Hellinger</th>
            <th>Manhattan</th>
            <th>Hamming</th>
            <th>Jaccard</th>
        `;

        Object.entries(metrics).forEach(([compType, folds]) => {
            Object.entries(folds).forEach(([fold, data]) => {
                if (data && typeof data === 'object') {
                    const row = document.createElement('tr');
                    if (fold === 'Summary') {
                        row.style.fontWeight = 'bold';
                        row.style.background = isDarkMode ? '#0f172a' : '#f9fafb';
                    }

                    row.innerHTML = `
                        <td>${compType}</td>
                        <td>${fold === 'Summary' ? 'M√©dia (Summary)' : fold}</td>
                        <td>${getValue(data.EuclideanDistance, 'N/A') !== 'N/A' ? getValue(data.EuclideanDistance).toFixed(4) : 'N/A'}</td>
                        <td>${getValue(data.HellingerDistance, 'N/A') !== 'N/A' ? getValue(data.HellingerDistance).toFixed(4) : 'N/A'}</td>
                        <td>${getValue(data.ManhattanDistance, 'N/A') !== 'N/A' ? getValue(data.ManhattanDistance).toFixed(4) : 'N/A'}</td>
                        <td>${getValue(data.HammingDistance, 'N/A') !== 'N/A' ? getValue(data.HammingDistance).toFixed(4) : 'N/A'}</td>
                        <td>${getValue(data.JaccardDistance, 'N/A') !== 'N/A' ? getValue(data.JaccardDistance).toFixed(4) : 'N/A'}</td>
                    `;
                    tbody.appendChild(row);
                }
            });
        });
    }

    function renderEfficiencyMetrics(data) {
        if (!data.EfficiencyMetrics) {
            showNoDataMessage();
            return;
        }

        const metrics = data.EfficiencyMetrics;
        const statsGrid = document.getElementById('statsGrid');
        const container = document.getElementById('chartsContainer');
        const tbody = document.getElementById('metricsTableBody');

        statsGrid.innerHTML = '';
        container.innerHTML = '';
        tbody.innerHTML = '';

        // Render stats from Summary
        if (metrics.Summary) {
            const summary = metrics.Summary;
            const stats = [
                {
                    icon: 'fa-microchip',
                    label: 'CPU M√©dio',
                    value: getValue(summary['Process_CPU_%']).toFixed(2) + '%',
                    color: 'var(--primary)'
                },
                {
                    icon: 'fa-memory',
                    label: 'Mem√≥ria M√©dia',
                    value: getValue(summary.Process_Memory_MB).toFixed(2) + ' MB',
                    color: 'var(--success)'
                },
                {
                    icon: 'fa-clock',
                    label: 'Tempo de Treinamento',
                    value: (getValue(summary.Time_training_ms) / 1000).toFixed(2) + ' s',
                    color: 'var(--warning)'
                },
                {
                    icon: 'fa-bolt',
                    label: 'Tempo de Gera√ß√£o',
                    value: getValue(summary.Time_generating_ms).toFixed(2) + ' ms',
                    color: 'var(--info)'
                }
            ];

            stats.forEach(stat => {
                const card = document.createElement('div');
                card.className = 'stat-card';
                card.innerHTML = `
                    <div class="stat-header">
                        <div class="stat-icon" style="background: ${stat.color}20; color: ${stat.color};">
                            <i class="fas ${stat.icon}"></i>
                        </div>
                    </div>
                    <div class="stat-value">${stat.value}</div>
                    <div class="stat-label">${stat.label}</div>
                `;
                statsGrid.appendChild(card);
            });
        }

        // Render charts
        const chartCard = document.createElement('div');
        chartCard.className = 'chart-card';
        chartCard.style.gridColumn = '1 / -1';
        chartCard.innerHTML = `
            <div class="chart-header">
                <h3 class="chart-title">M√©tricas de Efici√™ncia por Fold</h3>
            </div>
            <div class="chart-container">
                <canvas id="efficiencyChart"></canvas>
            </div>
        `;
        container.appendChild(chartCard);

        // Create chart
        setTimeout(() => {
            const labels = [];
            const cpuData = [];
            const memoryData = [];
            const trainingTime = [];

            Object.entries(metrics).forEach(([fold, data]) => {
                if (fold !== 'Summary' && data) {
                    labels.push(fold);
                    cpuData.push(getValue(data['Process_CPU_%']).toFixed(2));
                    memoryData.push(getValue(data.Process_Memory_MB).toFixed(2));
                    trainingTime.push((getValue(data.Time_training_ms) / 1000).toFixed(2));
                }
            });

            const isDark = document.body.classList.contains('dark-mode');
            const textColor = isDark ? '#f1f5f9' : '#0f172a';
            const gridColor = isDark ? '#334155' : '#e5e7eb';

            charts.efficiency = new Chart(document.getElementById('efficiencyChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'CPU (%)',
                            data: cpuData,
                            borderColor: 'rgba(59, 130, 246, 1)',
                            backgroundColor: 'rgba(59, 130, 246, 0.2)',
                            borderWidth: 2,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Mem√≥ria (MB)',
                            data: memoryData,
                            borderColor: 'rgba(16, 185, 129, 1)',
                            backgroundColor: 'rgba(16, 185, 129, 0.2)',
                            borderWidth: 2,
                            tension: 0.4,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'Tempo Treinamento (s)',
                            data: trainingTime,
                            borderColor: 'rgba(245, 158, 11, 1)',
                            backgroundColor: 'rgba(245, 158, 11, 0.2)',
                            borderWidth: 2,
                            tension: 0.4,
                            yAxisID: 'y2'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: textColor } }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            position: 'left',
                            title: { display: true, text: 'CPU (%)', color: textColor },
                            grid: { color: gridColor },
                            ticks: { color: textColor }
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            title: { display: true, text: 'Mem√≥ria (MB)', color: textColor },
                            grid: { display: false },
                            ticks: { color: textColor }
                        },
                        y2: {
                            type: 'linear',
                            position: 'right',
                            title: { display: true, text: 'Tempo (s)', color: textColor },
                            grid: { display: false },
                            ticks: { color: textColor }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: textColor }
                        }
                    }
                }
            });
        }, 100);

        // Render table
        const thead = document.querySelector('#metricsTable thead tr');
        thead.innerHTML = `
            <th>Fold</th>
            <th>Process CPU %</th>
            <th>Process Memory MB</th>
            <th>System CPU %</th>
            <th>System Memory MB</th>
            <th>Training Time (s)</th>
            <th>Generating Time (ms)</th>
        `;

        Object.entries(metrics).forEach(([fold, data]) => {
            if (data && typeof data === 'object') {
                const row = document.createElement('tr');
                if (fold === 'Summary') {
                    row.style.fontWeight = 'bold';
                    row.style.background = isDarkMode ? '#0f172a' : '#f9fafb';
                }

                row.innerHTML = `
                    <td>${fold === 'Summary' ? 'M√©dia (Summary)' : fold}</td>
                    <td>${getValue(data['Process_CPU_%']).toFixed(2)}</td>
                    <td>${getValue(data.Process_Memory_MB).toFixed(2)}</td>
                    <td>${getValue(data['System_CPU_%']).toFixed(2)}</td>
                    <td>${getValue(data.System_Memory_MB).toFixed(2)}</td>
                    <td>${(getValue(data.Time_training_ms) / 1000).toFixed(2)}</td>
                    <td>${getValue(data.Time_generating_ms).toFixed(2)}</td>
                `;
                tbody.appendChild(row);
            }
        });
    }

    function renderSDVMetrics(data) {
        if (!data.SDVMetrics) {
            showNoDataMessage();
            return;
        }

        const metrics = data.SDVMetrics;
        const statsGrid = document.getElementById('statsGrid');
        const container = document.getElementById('chartsContainer');
        const tbody = document.getElementById('metricsTableBody');

        statsGrid.innerHTML = '';
        container.innerHTML = '';
        tbody.innerHTML = '';

        // Render stats
        if (metrics.Summary) {
            const stats = [
                {
                    icon: 'fa-check-circle',
                    label: 'Diagnostic Score',
                    value: getValue(metrics.Summary.diagnostic).toFixed(4),
                    color: 'var(--success)'
                },
                {
                    icon: 'fa-star',
                    label: 'Quality Score',
                    value: getValue(metrics.Summary.quality).toFixed(4),
                    color: 'var(--warning)'
                }
            ];

            stats.forEach(stat => {
                const card = document.createElement('div');
                card.className = 'stat-card';
                card.innerHTML = `
                    <div class="stat-header">
                        <div class="stat-icon" style="background: ${stat.color}20; color: ${stat.color};">
                            <i class="fas ${stat.icon}"></i>
                        </div>
                    </div>
                    <div class="stat-value">${stat.value}</div>
                    <div class="stat-label">${stat.label}</div>
                `;
                statsGrid.appendChild(card);
            });
        }

        // Render chart
        const chartCard = document.createElement('div');
        chartCard.className = 'chart-card';
        chartCard.innerHTML = `
            <div class="chart-header">
                <h3 class="chart-title">SDV Metrics por Fold</h3>
            </div>
            <div class="chart-container">
                <canvas id="sdvChart"></canvas>
            </div>
        `;
        container.appendChild(chartCard);

        setTimeout(() => {
            const labels = [];
            const diagnostic = [];
            const quality = [];

            Object.entries(metrics).forEach(([fold, data]) => {
                if (fold !== 'Summary' && data) {
                    labels.push(fold);
                    diagnostic.push(getValue(data.diagnostic));
                    quality.push(getValue(data.quality));
                }
            });

            const isDark = document.body.classList.contains('dark-mode');
            const textColor = isDark ? '#f1f5f9' : '#0f172a';
            const gridColor = isDark ? '#334155' : '#e5e7eb';

            charts.sdv = new Chart(document.getElementById('sdvChart'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Diagnostic',
                            data: diagnostic,
                            backgroundColor: 'rgba(16, 185, 129, 0.8)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 2,
                            borderRadius: 8
                        },
                        {
                            label: 'Quality',
                            data: quality,
                            backgroundColor: 'rgba(245, 158, 11, 0.8)',
                            borderColor: 'rgba(245, 158, 11, 1)',
                            borderWidth: 2,
                            borderRadius: 8
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: textColor } }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: gridColor },
                            ticks: { color: textColor }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: textColor }
                        }
                    }
                }
            });
        }, 100);

        // Render table
        const thead = document.querySelector('#metricsTable thead tr');
        thead.innerHTML = `
            <th>Fold</th>
            <th>Diagnostic Score</th>
            <th>Quality Score</th>
        `;

        Object.entries(metrics).forEach(([fold, data]) => {
            if (data && typeof data === 'object') {
                const row = document.createElement('tr');
                if (fold === 'Summary') {
                    row.style.fontWeight = 'bold';
                    row.style.background = isDarkMode ? '#0f172a' : '#f9fafb';
                }

                row.innerHTML = `
                    <td>${fold === 'Summary' ? 'M√©dia (Summary)' : fold}</td>
                    <td>${getValue(data.diagnostic).toFixed(4)}</td>
                    <td>${getValue(data.quality).toFixed(4)}</td>
                `;
                tbody.appendChild(row);
            }
        });
    }

    function renderArguments(data) {
        if (!data.Arguments) {
            showNoDataMessage();
            return;
        }

        const args = data.Arguments;
        const statsGrid = document.getElementById('statsGrid');
        const container = document.getElementById('chartsContainer');
        const tbody = document.getElementById('metricsTableBody');

        statsGrid.innerHTML = '';
        container.innerHTML = '';
        tbody.innerHTML = '';

        // Show key arguments as stats
        const keyArgs = [
            { key: 'model_type', label: 'Tipo de Modelo', icon: 'fa-brain' },
            { key: 'number_k_folds', label: 'N√∫mero de Folds', icon: 'fa-layer-group' },
            { key: 'adversarial_number_epochs', label: 'Epochs', icon: 'fa-sync' },
            { key: 'adversarial_batch_size', label: 'Batch Size', icon: 'fa-cubes' }
        ];

        const colors = ['var(--primary)', 'var(--success)', 'var(--warning)', 'var(--info)'];

        keyArgs.forEach((arg, i) => {
            const value = args[arg.key];
            if (value !== undefined) {
                const card = document.createElement('div');
                card.className = 'stat-card';
                card.innerHTML = `
                    <div class="stat-header">
                        <div class="stat-icon" style="background: ${colors[i]}20; color: ${colors[i]};">
                            <i class="fas ${arg.icon}"></i>
                        </div>
                    </div>
                    <div class="stat-value">${typeof value === 'object' ? JSON.stringify(value) : value}</div>
                    <div class="stat-label">${arg.label}</div>
                `;
                statsGrid.appendChild(card);
            }
        });

        // Show all arguments in a formatted view
        const argsCard = document.createElement('div');
        argsCard.className = 'chart-card';
        argsCard.style.gridColumn = '1 / -1';
        argsCard.innerHTML = `
            <div class="chart-header">
                <h3 class="chart-title">Todos os Argumentos</h3>
            </div>
            <div style="padding: 1rem; max-height: 400px; overflow-y: auto;">
                <pre style="background: ${isDarkMode ? '#0f172a' : '#f9fafb'}; padding: 1rem; border-radius: 0.5rem; font-size: 0.875rem;">${JSON.stringify(args, null, 2)}</pre>
            </div>
        `;
        container.appendChild(argsCard);

        // Render table
        const thead = document.querySelector('#metricsTable thead tr');
        thead.innerHTML = `
            <th>Par√¢metro</th>
            <th>Valor</th>
        `;

        Object.entries(args).forEach(([key, value]) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><code>${key}</code></td>
                <td>${typeof value === 'object' ? JSON.stringify(value) : value}</td>
            `;
            tbody.appendChild(row);
        });
    }

    function showNoDataMessage() {
        const statsGrid = document.getElementById('statsGrid');
        const container = document.getElementById('chartsContainer');
        const tbody = document.getElementById('metricsTableBody');

        statsGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #9ca3af;">Nenhum dado dispon√≠vel para esta se√ß√£o</div>';
        container.innerHTML = '';
        tbody.innerHTML = '';
    }

    // UI Functions
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const menuToggle = document.getElementById('menuToggle');

        isSidebarOpen = !isSidebarOpen;

        if (isSidebarOpen) {
            sidebar.classList.remove('collapsed');
            mainContent.classList.remove('expanded');
            menuToggle.innerHTML = '<i class="fas fa-bars"></i>';
        } else {
            sidebar.classList.add('collapsed');
            mainContent.classList.add('expanded');
            menuToggle.innerHTML = '<i class="fas fa-times"></i>';
        }
    }

    function toggleTheme() {
        isDarkMode = !isDarkMode;
        document.body.classList.toggle('dark-mode');
        document.getElementById('themeIcon').className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';

        if (currentExperiment) {
            renderDashboard();
        }
    }

    function exportCurrentExperiment() {
        if (!currentExperiment) {
            showNotification('Nenhum experimento selecionado', 'error');
            return;
        }

        const data = allExperiments[currentExperiment];
        let csv = '';

        if (currentTab === 'classification' && data.ClassificationMetrics) {
            csv = 'Modelo,Fold,Accuracy,F1-Score,Precision,Recall,MSE,MAE\n';
            Object.entries(data.ClassificationMetrics).forEach(([model, folds]) => {
                Object.entries(folds).forEach(([fold, metrics]) => {
                    if (metrics && typeof metrics === 'object') {
                        const acc = getValue(metrics.Accuracy) * 100;
                        const f1 = getValue(metrics.F1Score) * 100;
                        const prec = getValue(metrics.Precision) * 100;
                        const rec = getValue(metrics.Recall) * 100;
                        const mse = getValue(metrics.MeanSquareError);
                        const mae = getValue(metrics.MeanAbsoluteError);

                        csv += `${model},${fold},${acc.toFixed(2)},${f1.toFixed(2)},${prec.toFixed(2)},${rec.toFixed(2)},${mse.toFixed(4)},${mae.toFixed(4)}\n`;
                    }
                });
            });
        } else {
            csv = JSON.stringify(data, null, 2);
        }

        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        const displayName = experimentMetadata[currentExperiment]?.originalName || currentExperiment;
        a.download = `${displayName}_${currentTab}_report.csv`;
        a.click();
        window.URL.revokeObjectURL(url);

        showNotification('Arquivo CSV exportado com sucesso', 'success');
    }

    async function exportAsPDF() {
        if (!currentExperiment) {
            showNotification('Nenhum experimento selecionado', 'warning');
            return;
        }

        showNotification('Gerando PDF... Por favor aguarde', 'info');

        try {
            // Verificar se jsPDF est√° dispon√≠vel
            if (typeof window.jspdf === 'undefined') {
                throw new Error('jsPDF n√£o carregado. Recarregue a p√°gina.');
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const margin = 15;
            let yPosition = margin;

            // Header com fundo azul
            doc.setFillColor(59, 130, 246);
            doc.rect(0, 0, pageWidth, 35, 'F');

            // T√≠tulo
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.text('SynDataGen Analytics', margin, 15);

            doc.setFontSize(11);
            doc.text('Relat√≥rio de An√°lise', margin, 25);

            yPosition = 45;

            // Informa√ß√µes do Experimento
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(14);
            doc.text('Experimento: ' + currentExperiment, margin, yPosition);
            yPosition += 8;

            const metadata = experimentMetadata[currentExperiment];
            doc.setFontSize(10);
            doc.text('Data: ' + metadata.uploadDate, margin, yPosition);
            yPosition += 6;
            doc.text('Tamanho: ' + metadata.fileSize, margin, yPosition);
            yPosition += 6;
            doc.text('Tipo: ' + metadata.type, margin, yPosition);
            yPosition += 12;

            // Se√ß√£o atual
            const tabNames = {
                'classification': 'Classifica√ß√£o',
                'distance': 'Dist√¢ncia',
                'privacy': 'Privacidade',
                'statistical': 'Estat√≠sticas'
            };

            doc.setFontSize(12);
            doc.text('An√°lise: ' + tabNames[currentTab], margin, yPosition);
            yPosition += 10;

            // Linha separadora
            doc.setDrawColor(200, 200, 200);
            doc.line(margin, yPosition, pageWidth - margin, yPosition);
            yPosition += 8;

            // Dados do experimento
            const data = allExperiments[currentExperiment];
            const precision = parseInt(localStorage.getItem('chartPrecision') || '2');

            // Adicionar m√©tricas baseado na aba
            if (currentTab === 'classification' && (data.ClassificationMetrics || data['TS-TR'])) {
                yPosition = addClassificationToPDF(doc, data, yPosition, margin, precision, pageWidth, pageHeight);
            } else if (currentTab === 'distance' && data.DistanceMetrics) {
                yPosition = addDistanceToPDF(doc, data, yPosition, margin, precision, pageWidth, pageHeight);
            } else if (currentTab === 'privacy' && data.PrivacyMetrics) {
                yPosition = addPrivacyToPDF(doc, data, yPosition, margin, precision, pageWidth, pageHeight);
            } else if (currentTab === 'statistical' && data.StatisticalMetrics) {
                yPosition = addStatisticalToPDF(doc, data, yPosition, margin, precision, pageWidth, pageHeight);
            }

            // Verificar se deve incluir gr√°ficos
            const includeCharts = localStorage.getItem('includeCharts') !== 'false';

            if (includeCharts) {
                await addChartsPageToPDF(doc, margin, pageWidth);
            }

            // Rodap√©
            const totalPages = doc.internal.pages.length - 1;
            for (let i = 1; i <= totalPages; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(150, 150, 150);
                const footerText = 'Gerado em ' + new Date().toLocaleString('pt-BR') + ' | P√°gina ' + i + ' de ' + totalPages;
                doc.text(footerText, pageWidth / 2, pageHeight - 10, { align: 'center' });
            }

            // Salvar
            const fileName = currentExperiment + '_' + currentTab + '.pdf';
            doc.save(fileName);

            showNotification('PDF exportado com sucesso!', 'success');
        } catch (error) {
            console.error('Erro ao gerar PDF:', error);
            showNotification('Erro ao gerar PDF: ' + error.message, 'error');
        }
    }

    function addClassificationToPDF(doc, data, yPosition, margin, precision, pageWidth, pageHeight) {
        doc.setFontSize(11);
        doc.setFont(undefined, 'bold');
        doc.text('M√©tricas de Classifica√ß√£o:', margin, yPosition);
        yPosition += 8;

        doc.setFontSize(9);
        doc.setFont(undefined, 'normal');

        const evaluationSections = ['TS-TR', 'TR-TS', 'TR-TR'];
        const hasNewFormat = evaluationSections.some(section => data[section]);
        const metrics = hasNewFormat ? data : { 'Geral': data.ClassificationMetrics };

        if (!metrics) {
            doc.text('Nenhuma m√©trica dispon√≠vel', margin, yPosition);
            return yPosition + 10;
        }

        for (const [section, sectionData] of Object.entries(metrics)) {
            // Verificar se sectionData √© v√°lido e n√£o √© outra m√©trica
            if (!sectionData ||
                typeof sectionData !== 'object' ||
                section === 'DistanceMetrics' ||
                section === 'PrivacyMetrics' ||
                section === 'StatisticalMetrics') {
                continue;
            }

            if (yPosition > pageHeight - 30) {
                doc.addPage();
                yPosition = margin;
            }

            doc.setFont(undefined, 'bold');
            doc.text(section + ':', margin, yPosition);
            yPosition += 5;
            doc.setFont(undefined, 'normal');

            for (const [modelName, folds] of Object.entries(sectionData)) {
                // Verificar se folds existe e n√£o √© nulo
                if (!folds || typeof folds !== 'object') {
                    continue;
                }

                if (folds.Summary) {
                    if (yPosition > pageHeight - 30) {
                        doc.addPage();
                        yPosition = margin;
                    }

                    const summary = folds.Summary;

                    // Verificar se os valores existem antes de usar
                    if (summary && summary.Accuracy !== undefined && summary.Accuracy !== null) {
                        const acc = (getValue(summary.Accuracy) * 100).toFixed(precision);
                        const f1 = summary.F1Score ? (getValue(summary.F1Score) * 100).toFixed(precision) : 'N/A';
                        const prec = summary.Precision ? (getValue(summary.Precision) * 100).toFixed(precision) : 'N/A';
                        const rec = summary.Recall ? (getValue(summary.Recall) * 100).toFixed(precision) : 'N/A';

                        doc.text('  ' + modelName + ':', margin + 5, yPosition);
                        yPosition += 5;
                        doc.text('    Accuracy: ' + acc + '%', margin + 10, yPosition);
                        yPosition += 4;
                        doc.text('    F1-Score: ' + f1 + '%', margin + 10, yPosition);
                        yPosition += 4;
                        doc.text('    Precision: ' + prec + '%', margin + 10, yPosition);
                        yPosition += 4;
                        doc.text('    Recall: ' + rec + '%', margin + 10, yPosition);
                        yPosition += 6;
                    }
                }
            }
            yPosition += 3;
        }

        return yPosition;
    }

    function addDistanceToPDF(doc, data, yPosition, margin, precision, pageWidth, pageHeight) {
        if (!data.DistanceMetrics) {
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            doc.text('M√©tricas de Dist√¢ncia:', margin, yPosition);
            yPosition += 8;
            doc.setFontSize(9);
            doc.setFont(undefined, 'normal');
            doc.text('Nenhuma m√©trica dispon√≠vel', margin, yPosition);
            return yPosition + 10;
        }

        doc.setFontSize(11);
        doc.setFont(undefined, 'bold');
        doc.text('M√©tricas de Dist√¢ncia:', margin, yPosition);
        yPosition += 8;

        doc.setFontSize(9);
        doc.setFont(undefined, 'normal');

        for (const [metric, value] of Object.entries(data.DistanceMetrics)) {
            if (yPosition > pageHeight - 20) {
                doc.addPage();
                yPosition = margin;
            }
            if (value !== null && value !== undefined) {
                doc.text(metric + ': ' + getValue(value).toFixed(precision), margin + 5, yPosition);
                yPosition += 5;
            }
        }

        return yPosition + 5;
    }

    function addPrivacyToPDF(doc, data, yPosition, margin, precision, pageWidth, pageHeight) {
        if (!data.PrivacyMetrics) {
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            doc.text('M√©tricas de Privacidade:', margin, yPosition);
            yPosition += 8;
            doc.setFontSize(9);
            doc.setFont(undefined, 'normal');
            doc.text('Nenhuma m√©trica dispon√≠vel', margin, yPosition);
            return yPosition + 10;
        }

        doc.setFontSize(11);
        doc.setFont(undefined, 'bold');
        doc.text('M√©tricas de Privacidade:', margin, yPosition);
        yPosition += 8;

        doc.setFontSize(9);
        doc.setFont(undefined, 'normal');

        for (const [metric, value] of Object.entries(data.PrivacyMetrics)) {
            if (yPosition > pageHeight - 20) {
                doc.addPage();
                yPosition = margin;
            }
            if (value !== null && value !== undefined) {
                const displayValue = typeof value === 'number' ? value.toFixed(precision) : value;
                doc.text(metric + ': ' + displayValue, margin + 5, yPosition);
                yPosition += 5;
            }
        }

        return yPosition + 5;
    }

    function addStatisticalToPDF(doc, data, yPosition, margin, precision, pageWidth, pageHeight) {
        if (!data.StatisticalMetrics) {
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            doc.text('M√©tricas Estat√≠sticas:', margin, yPosition);
            yPosition += 8;
            doc.setFontSize(9);
            doc.setFont(undefined, 'normal');
            doc.text('Nenhuma m√©trica dispon√≠vel', margin, yPosition);
            return yPosition + 10;
        }

        doc.setFontSize(11);
        doc.setFont(undefined, 'bold');
        doc.text('M√©tricas Estat√≠sticas:', margin, yPosition);
        yPosition += 8;

        doc.setFontSize(9);
        doc.setFont(undefined, 'normal');

        for (const [metric, value] of Object.entries(data.StatisticalMetrics)) {
            if (yPosition > pageHeight - 20) {
                doc.addPage();
                yPosition = margin;
            }
            if (value !== null && value !== undefined) {
                const displayValue = typeof value === 'number' ? value.toFixed(precision) : value;
                doc.text(metric + ': ' + displayValue, margin + 5, yPosition);
                yPosition += 5;
            }
        }

        return yPosition + 5;
    }

    async function addChartsPageToPDF(doc, margin, pageWidth) {
        const chartIds = {
            'classification': ['accuracyChart', 'f1Chart', 'precisionRecallChart', 'errorChart'],
            'distance': ['distanceChart'],
            'privacy': ['privacyChart'],
            'statistical': ['statisticalChart']
        };

        const ids = chartIds[currentTab] || [];
        let hasCharts = false;

        for (const chartId of ids) {
            const chartElement = document.getElementById(chartId);
            if (chartElement && chartElement.querySelector('canvas')) {
                if (!hasCharts) {
                    doc.addPage();
                    doc.setFontSize(14);
                    doc.setTextColor(0, 0, 0);
                    doc.text('Gr√°ficos', margin, 15);
                    hasCharts = true;
                }

                try {
                    const canvas = chartElement.querySelector('canvas');
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = pageWidth - (2 * margin);
                    const imgHeight = 80; // Altura fixa para cada gr√°fico

                    const yPos = 25 + (ids.indexOf(chartId) * 90);

                    if (yPos + imgHeight > 270) {
                        doc.addPage();
                        doc.addImage(imgData, 'PNG', margin, 15, imgWidth, imgHeight);
                    } else {
                        doc.addImage(imgData, 'PNG', margin, yPos, imgWidth, imgHeight);
                    }
                } catch (error) {
                    console.error('Erro ao capturar gr√°fico ' + chartId + ':', error);
                }
            }
        }
    }

    function shareExperiment() {
        const url = window.location.href;
        navigator.clipboard.writeText(url).then(() => {
            showNotification('Link copiado para √°rea de transfer√™ncia!', 'success');
        }).catch(() => {
            showNotification('Erro ao copiar link', 'error');
        });
    }

    function refreshExperiment() {
        if (currentExperiment) {
            renderDashboard();
        }
    }

    function refreshCharts() {
        if (currentExperiment) {
            renderDashboard();
            showNotification('Gr√°ficos atualizados', 'success');
        }
    }

    function downloadCharts() {
        if (!currentExperiment) {
            showNotification('Nenhum experimento selecionado', 'error');
            return;
        }

        showNotification('Preparando download dos gr√°ficos...', 'info');

        const chartElements = document.querySelectorAll('.chart-container canvas');
        let downloadCount = 0;

        chartElements.forEach((canvas, index) => {
            setTimeout(() => {
                const link = document.createElement('a');
                link.download = `chart_${currentExperiment}_${index + 1}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();

                downloadCount++;
                if (downloadCount === chartElements.length) {
                    showNotification(`${downloadCount} gr√°fico(s) baixado(s) com sucesso`, 'success');
                }
            }, index * 500);
        });

        if (chartElements.length === 0) {
            showNotification('Nenhum gr√°fico dispon√≠vel para download', 'warning');
        }
    }

    async function generateReport() {
        if (!currentExperiment) {
            showNotification('Nenhum experimento selecionado', 'error');
            return;
        }

        showNotification('Gerando relat√≥rio em PDF...', 'info');

        try {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            let yPosition = 20;

            // Header
            pdf.setFontSize(20);
            pdf.setTextColor(59, 130, 246);
            pdf.text('SynDataGen - Relat√≥rio de Experimento', pageWidth / 2, yPosition, { align: 'center' });

            yPosition += 15;
            pdf.setFontSize(12);
            pdf.setTextColor(0, 0, 0);
            const displayName = experimentMetadata[currentExperiment]?.originalName || currentExperiment;
            pdf.text(`Experimento: ${displayName}`, 20, yPosition);

            yPosition += 10;
            pdf.setFontSize(10);
            pdf.text(`Data de Gera√ß√£o: ${new Date().toLocaleString('pt-BR')}`, 20, yPosition);

            yPosition += 15;

            // Get experiment data
            const expData = allExperiments[currentExperiment];

            // Classification Metrics
            if (currentTab === 'classification') {
                pdf.setFontSize(14);
                pdf.setTextColor(59, 130, 246);
                pdf.text('M√©tricas de Classifica√ß√£o', 20, yPosition);
                yPosition += 8;

                const classData = expData['TS-TR'] || expData['TR-TS'] || expData['TR-TR'] || expData.ClassificationMetrics;

                if (classData) {
                    pdf.setFontSize(10);
                    pdf.setTextColor(0, 0, 0);

                    Object.entries(classData).forEach(([model, metrics]) => {
                        if (yPosition > pageHeight - 40) {
                            pdf.addPage();
                            yPosition = 20;
                        }

                        pdf.setFontSize(11);
                        pdf.setTextColor(59, 130, 246);
                        pdf.text(`Modelo: ${model}`, 20, yPosition);
                        yPosition += 7;

                        if (metrics.Summary) {
                            pdf.setFontSize(9);
                            pdf.setTextColor(0, 0, 0);
                            Object.entries(metrics.Summary).forEach(([metric, value]) => {
                                if (metric !== 'Summary') {
                                    const val = getValue(value);
                                    pdf.text(`  ${metric}: ${(val * 100).toFixed(2)}%`, 25, yPosition);
                                    yPosition += 5;
                                }
                            });
                        }
                        yPosition += 5;
                    });
                }
            }

            // Regression Metrics
            if (currentTab === 'regression' && expData.RegressionMetrics) {
                if (yPosition > pageHeight - 60) {
                    pdf.addPage();
                    yPosition = 20;
                }

                yPosition += 10;
                pdf.setFontSize(14);
                pdf.setTextColor(59, 130, 246);
                pdf.text('M√©tricas de Regress√£o', 20, yPosition);
                yPosition += 8;

                pdf.setFontSize(10);
                pdf.setTextColor(0, 0, 0);

                Object.entries(expData.RegressionMetrics).forEach(([model, metrics]) => {
                    if (yPosition > pageHeight - 40) {
                        pdf.addPage();
                        yPosition = 20;
                    }

                    pdf.setFontSize(11);
                    pdf.setTextColor(59, 130, 246);
                    pdf.text(`Modelo: ${model}`, 20, yPosition);
                    yPosition += 7;

                    pdf.setFontSize(9);
                    pdf.setTextColor(0, 0, 0);
                    Object.entries(metrics).forEach(([metric, value]) => {
                        pdf.text(`  ${metric}: ${getValue(value).toFixed(4)}`, 25, yPosition);
                        yPosition += 5;
                    });
                    yPosition += 5;
                });
            }

            // Add charts as images
            const chartElements = document.querySelectorAll('.chart-container canvas');
            if (chartElements.length > 0) {
                for (let i = 0; i < chartElements.length; i++) {
                    if (yPosition > pageHeight - 100) {
                        pdf.addPage();
                        yPosition = 20;
                    }

                    const canvas = chartElements[i];
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = pageWidth - 40;
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;

                    if (imgHeight > pageHeight - yPosition - 20) {
                        pdf.addPage();
                        yPosition = 20;
                    }

                    pdf.addImage(imgData, 'PNG', 20, yPosition, imgWidth, imgHeight);
                    yPosition += imgHeight + 10;
                }
            }

            // Footer
            const pageCount = pdf.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                pdf.setPage(i);
                pdf.setFontSize(8);
                pdf.setTextColor(128, 128, 128);
                pdf.text(`P√°gina ${i} de ${pageCount}`, pageWidth / 2, pageHeight - 10, { align: 'center' });
            }

            // Save PDF
            pdf.save(`relatorio_${displayName}_${new Date().getTime()}.pdf`);
            showNotification('Relat√≥rio gerado com sucesso', 'success');

        } catch (error) {
            console.error('Erro ao gerar relat√≥rio:', error);
            showNotification('Erro ao gerar relat√≥rio: ' + error.message, 'error');
        }
    }

    function filterTable(searchTerm) {
        const table = document.getElementById('metricsTable');
        const rows = table.getElementsByTagName('tr');

        for (let i = 1; i < rows.length; i++) {
            const firstCell = rows[i].cells[0]?.textContent || '';
            if (firstCell.toLowerCase().includes(searchTerm.toLowerCase())) {
                rows[i].style.display = '';
            } else {
                rows[i].style.display = 'none';
            }
        }
    }

    function filterByMetric(criteria) {
        if (currentTab !== 'classification') return;

        const table = document.getElementById('metricsTable');
        const rows = table.getElementsByTagName('tr');

        for (let i = 1; i < rows.length; i++) {
            const accCell = rows[i].cells[2];
            if (!accCell) continue;

            const accText = accCell.textContent;
            const acc = parseFloat(accText.replace('%', ''));

            let show = true;
            if (criteria === 'high' && acc < 70) show = false;
            if (criteria === 'medium' && (acc < 50 || acc >= 70)) show = false;
            if (criteria === 'low' && acc >= 50) show = false;

            rows[i].style.display = show ? '' : 'none';
        }
    }

    function sortTable(columnIndex) {
        const table = document.getElementById('metricsTable');
        const tbody = table.getElementsByTagName('tbody')[0];
        const rows = Array.from(tbody.getElementsByTagName('tr'));

        rows.sort((a, b) => {
            const aVal = a.cells[columnIndex]?.textContent || '';
            const bVal = b.cells[columnIndex]?.textContent || '';

            const aNum = parseFloat(aVal.replace(/[^0-9.-]/g, ''));
            const bNum = parseFloat(bVal.replace(/[^0-9.-]/g, ''));

            if (!isNaN(aNum) && !isNaN(bNum)) {
                return bNum - aNum;
            }
            return aVal.localeCompare(bVal);
        });

        rows.forEach(row => tbody.appendChild(row));
    }

    function toggleComparisonMode() {
        comparisonMode = !comparisonMode;
        alert(comparisonMode ? 'Modo compara√ß√£o ativado!' : 'Modo compara√ß√£o desativado!');
    }

    function compareExperiments() {
        const experimentNames = Object.keys(allExperiments);
        if (experimentNames.length < 2) {
            showNotification('√â necess√°rio ter pelo menos 2 experimentos para comparar', 'error');
            return;
        }

        // Create comparison data
        let comparisonData = 'Experimento,';

        // Get metric names from first experiment
        const firstExp = allExperiments[experimentNames[0]];
        const evaluationSections = ['TS-TR', 'TR-TS', 'TR-TR'];

        // Try to get classification data from evaluation sections or ClassificationMetrics
        let classificationData = null;
        for (const section of evaluationSections) {
            if (firstExp[section]) {
                classificationData = firstExp[section];
                break;
            }
        }

        if (!classificationData && firstExp.ClassificationMetrics) {
            classificationData = firstExp.ClassificationMetrics;
        }

        if (classificationData) {
            const firstModel = Object.keys(classificationData)[0];
            const summary = classificationData[firstModel].Summary;
            if (summary) {
                const metrics = Object.keys(summary).filter(k => k !== 'Summary');
                comparisonData += metrics.join(',') + '\n';

                // Add data for each experiment
                experimentNames.forEach(expName => {
                    const exp = allExperiments[expName];
                    const displayName = experimentMetadata[expName]?.originalName || expName;
                    comparisonData += `${displayName},`;

                    // Get classification data for this experiment
                    let expClassData = null;
                    for (const section of evaluationSections) {
                        if (exp[section]) {
                            expClassData = exp[section];
                            break;
                        }
                    }

                    if (!expClassData && exp.ClassificationMetrics) {
                        expClassData = exp.ClassificationMetrics;
                    }

                    if (expClassData) {
                        // Average across all models
                        let avgMetrics = {};
                        let modelCount = 0;

                        Object.values(expClassData).forEach(model => {
                            if (model.Summary) {
                                modelCount++;
                                metrics.forEach(metric => {
                                    if (!avgMetrics[metric]) avgMetrics[metric] = 0;
                                    avgMetrics[metric] += getValue(model.Summary[metric]);
                                });
                            }
                        });

                        // Calculate averages
                        metrics.forEach(metric => {
                            const avg = modelCount > 0 ? (avgMetrics[metric] / modelCount).toFixed(4) : '0';
                            comparisonData += avg + ',';
                        });
                        comparisonData = comparisonData.slice(0, -1) + '\n';
                    }
                });
            }
        }

        // Download comparison CSV
        const blob = new Blob([comparisonData], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'experiments_comparison.csv';
        a.click();
        window.URL.revokeObjectURL(url);

        showNotification('Compara√ß√£o exportada com sucesso', 'success');
    }

    function exportAllExperiments() {
        if (Object.keys(allExperiments).length === 0) {
            showNotification('Nenhum experimento para exportar', 'error');
            return;
        }

        // Create a combined JSON with all experiments
        const combinedData = {
            exportDate: new Date().toISOString(),
            experimentsCount: Object.keys(allExperiments).length,
            experiments: {}
        };

        Object.entries(allExperiments).forEach(([name, data]) => {
            const displayName = experimentMetadata[name]?.originalName || name;
            combinedData.experiments[displayName] = {
                metadata: experimentMetadata[name],
                data: data
            };
        });

        const json = JSON.stringify(combinedData, null, 2);
        const blob = new Blob([json], { type: 'application/json' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `all_experiments_${new Date().getTime()}.json`;
        a.click();
        window.URL.revokeObjectURL(url);

        showNotification(`${Object.keys(allExperiments).length} experimentos exportados`, 'success');
    }

    async function downloadAllReports() {
        const experimentNames = Object.keys(allExperiments);

        if (experimentNames.length === 0) {
            showNotification('Nenhum experimento dispon√≠vel', 'error');
            return;
        }

        showNotification(`Gerando relat√≥rios para ${experimentNames.length} experimento(s)...`, 'info');

        let reportCount = 0;

        for (const expName of experimentNames) {
            try {
                const savedCurrent = currentExperiment;
                currentExperiment = expName;

                await new Promise((resolve) => {
                    setTimeout(async () => {
                        await generateReport();
                        reportCount++;
                        resolve();
                    }, reportCount * 1000);
                });

                currentExperiment = savedCurrent;
            } catch (error) {
                console.error(`Erro ao gerar relat√≥rio para ${expName}:`, error);
            }
        }

        showNotification(`${reportCount} relat√≥rio(s) gerado(s) com sucesso`, 'success');
    }

    function showNotificationsCenter() {
        const notificationsHTML = `
            <div id="notificationsCenter" style="
                position: fixed;
                top: 0;
                right: 0;
                width: 400px;
                height: 100vh;
                background: white;
                box-shadow: -2px 0 10px rgba(0,0,0,0.1);
                z-index: 10000;
                padding: 2rem;
                overflow-y: auto;
                animation: slideInRight 0.3s ease;
            ">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2 style="font-size: 1.5rem; font-weight: bold; color: #1f2937;">
                        <i class="fas fa-bell"></i> Notifica√ß√µes
                    </h2>
                    <button onclick="closeNotificationsCenter()" style="
                        background: none;
                        border: none;
                        font-size: 1.5rem;
                        cursor: pointer;
                        color: #6b7280;
                    ">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <div style="padding: 1rem; background: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 0.5rem;">
                        <div style="display: flex; align-items: start; gap: 0.75rem;">
                            <i class="fas fa-info-circle" style="color: #3b82f6; margin-top: 0.25rem;"></i>
                            <div style="flex: 1;">
                                <p style="font-weight: 600; margin-bottom: 0.25rem; color: #1f2937;">Sistema Atualizado</p>
                                <p style="font-size: 0.875rem; color: #6b7280;">Plataforma SynDataGen est√° funcionando perfeitamente</p>
                                <p style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.5rem;">H√° 5 minutos</p>
                            </div>
                        </div>
                    </div>

                    <div style="padding: 1rem; background: #f0fdf4; border-left: 4px solid #10b981; border-radius: 0.5rem;">
                        <div style="display: flex; align-items: start; gap: 0.75rem;">
                            <i class="fas fa-check-circle" style="color: #10b981; margin-top: 0.25rem;"></i>
                            <div style="flex: 1;">
                                <p style="font-weight: 600; margin-bottom: 0.25rem; color: #1f2937;">Experimentos Carregados</p>
                                <p style="font-size: 0.875rem; color: #6b7280;">${Object.keys(allExperiments).length} experimento(s) dispon√≠vel(is)</p>
                                <p style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.5rem;">Hoje</p>
                            </div>
                        </div>
                    </div>

                    <div style="padding: 1rem; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 0.5rem;">
                        <div style="display: flex; align-items: start; gap: 0.75rem;">
                            <i class="fas fa-exclamation-triangle" style="color: #f59e0b; margin-top: 0.25rem;"></i>
                            <div style="flex: 1;">
                                <p style="font-weight: 600; margin-bottom: 0.25rem; color: #1f2937;">Dica</p>
                                <p style="font-size: 0.875rem; color: #6b7280;">Use o modo de compara√ß√£o para analisar m√∫ltiplos experimentos</p>
                                <p style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.5rem;">Ontem</p>
                            </div>
                        </div>
                    </div>
                </div>

                <button onclick="clearAllNotifications()" style="
                    width: 100%;
                    margin-top: 2rem;
                    padding: 0.75rem;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 0.5rem;
                    cursor: pointer;
                    font-weight: 600;
                    color: #6b7280;
                    transition: all 0.2s;
                " onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">
                    <i class="fas fa-trash"></i> Limpar Todas
                </button>
            </div>

            <div id="notificationsOverlay" onclick="closeNotificationsCenter()" style="
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 9999;
                animation: fadeIn 0.3s ease;
            "></div>

            <style>
                @keyframes slideInRight {
                    from {
                        transform: translateX(100%);
                    }
                    to {
                        transform: translateX(0);
                    }
                }

                @keyframes fadeIn {
                    from {
                        opacity: 0;
                    }
                    to {
                        opacity: 1;
                    }
                }
            </style>
        `;

        document.body.insertAdjacentHTML('beforeend', notificationsHTML);
    }

    function closeNotificationsCenter() {
        const center = document.getElementById('notificationsCenter');
        const overlay = document.getElementById('notificationsOverlay');
        if (center) center.remove();
        if (overlay) overlay.remove();
    }

    function clearAllNotifications() {
        showNotification('Todas as notifica√ß√µes foram limpas', 'success');
        closeNotificationsCenter();
    }

    function showSettings() {
        const settingsHTML = `
            <div id="settingsPanel" style="
                position: fixed;
                top: 0;
                right: 0;
                width: 500px;
                height: 100vh;
                background: white;
                box-shadow: -2px 0 10px rgba(0,0,0,0.1);
                z-index: 10000;
                padding: 2rem;
                overflow-y: auto;
                animation: slideInRight 0.3s ease;
            ">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2 style="font-size: 1.5rem; font-weight: bold; color: #1f2937;">
                        <i class="fas fa-cog"></i> Configura√ß√µes
                    </h2>
                    <button onclick="closeSettings()" style="
                        background: none;
                        border: none;
                        font-size: 1.5rem;
                        cursor: pointer;
                        color: #6b7280;
                    ">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div style="display: flex; flex-direction: column; gap: 2rem;">
                    <!-- Appearance Settings -->
                    <div>
                        <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; color: #1f2937;">
                            <i class="fas fa-palette"></i> Apar√™ncia
                        </h3>

                        <div style="padding: 1rem; background: #f9fafb; border-radius: 0.5rem;">
                            <label style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;">
                                <span style="font-weight: 500; color: #374151;">Modo Escuro</span>
                                <div style="position: relative;">
                                    <input type="checkbox" id="darkModeToggle" ${document.body.classList.contains('dark-mode') ? 'checked' : ''}
                                           onchange="toggleDarkMode()" style="
                                        appearance: none;
                                        width: 48px;
                                        height: 24px;
                                        background: #d1d5db;
                                        border-radius: 12px;
                                        position: relative;
                                        cursor: pointer;
                                        transition: all 0.3s;
                                    ">
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Chart Settings -->
                    <div>
                        <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; color: #1f2937;">
                            <i class="fas fa-chart-bar"></i> Gr√°ficos
                        </h3>

                        <div style="padding: 1rem; background: #f9fafb; border-radius: 0.5rem; display: flex; flex-direction: column; gap: 1rem;">
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 0.5rem; color: #374151;">
                                    Anima√ß√£o dos Gr√°ficos
                                </label>
                                <select id="chartAnimationSpeed" style="
                                    width: 100%;
                                    padding: 0.5rem;
                                    border: 1px solid #d1d5db;
                                    border-radius: 0.375rem;
                                    font-size: 0.875rem;
                                ">
                                    <option value="slow">Lenta</option>
                                    <option value="normal" selected>Normal</option>
                                    <option value="fast">R√°pida</option>
                                    <option value="none">Sem Anima√ß√£o</option>
                                </select>
                            </div>

                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 0.5rem; color: #374151;">
                                    Precis√£o dos Valores
                                </label>
                                <select id="chartPrecision" style="
                                    width: 100%;
                                    padding: 0.5rem;
                                    border: 1px solid #d1d5db;
                                    border-radius: 0.375rem;
                                    font-size: 0.875rem;
                                ">
                                    <option value="2" selected>2 casas decimais</option>
                                    <option value="3">3 casas decimais</option>
                                    <option value="4">4 casas decimais</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Export Settings -->
                    <div>
                        <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; color: #1f2937;">
                            <i class="fas fa-file-export"></i> Exporta√ß√£o
                        </h3>

                        <div style="padding: 1rem; background: #f9fafb; border-radius: 0.5rem; display: flex; flex-direction: column; gap: 1rem;">
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 0.5rem; color: #374151;">
                                    Formato Padr√£o de Exporta√ß√£o
                                </label>
                                <select id="exportFormat" style="
                                    width: 100%;
                                    padding: 0.5rem;
                                    border: 1px solid #d1d5db;
                                    border-radius: 0.375rem;
                                    font-size: 0.875rem;
                                ">
                                    <option value="pdf" selected>PDF</option>
                                    <option value="json">JSON</option>
                                    <option value="csv">CSV</option>
                                </select>
                            </div>

                            <div>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" id="includeCharts" checked style="
                                        width: 16px;
                                        height: 16px;
                                        cursor: pointer;
                                    ">
                                    <span style="font-size: 0.875rem; color: #374151;">Incluir gr√°ficos nos relat√≥rios</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- About -->
                    <div>
                        <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; color: #1f2937;">
                            <i class="fas fa-info-circle"></i> Sobre
                        </h3>

                        <div style="padding: 1rem; background: #f9fafb; border-radius: 0.5rem;">
                            <p style="font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;">SynDataGen Analytics Platform</p>
                            <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem;">Vers√£o 2.0.0</p>
                            <p style="font-size: 0.75rem; color: #9ca3af;">Plataforma avan√ßada para an√°lise de experimentos de dados sint√©ticos</p>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div style="display: flex; gap: 1rem;">
                        <button onclick="saveSettings()" style="
                            flex: 1;
                            padding: 0.75rem;
                            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
                            color: white;
                            border: none;
                            border-radius: 0.5rem;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s;
                        " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-save"></i> Salvar
                        </button>

                        <button onclick="closeSettings()" style="
                            flex: 1;
                            padding: 0.75rem;
                            background: #f3f4f6;
                            border: none;
                            border-radius: 0.5rem;
                            font-weight: 600;
                            color: #6b7280;
                            cursor: pointer;
                            transition: all 0.2s;
                        " onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </div>
            </div>

            <div id="settingsOverlay" onclick="closeSettings()" style="
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 9999;
                animation: fadeIn 0.3s ease;
            "></div>

            <style>
                @keyframes slideInRight {
                    from {
                        transform: translateX(100%);
                    }
                    to {
                        transform: translateX(0);
                    }
                }

                @keyframes fadeIn {
                    from {
                        opacity: 0;
                    }
                    to {
                        opacity: 1;
                    }
                }

                #darkModeToggle:checked {
                    background: #3b82f6 !important;
                }

                #darkModeToggle::after {
                    content: '';
                    position: absolute;
                    width: 18px;
                    height: 18px;
                    background: white;
                    border-radius: 50%;
                    top: 3px;
                    left: 3px;
                    transition: all 0.3s;
                }

                #darkModeToggle:checked::after {
                    left: 27px;
                }
            </style>
        `;

        document.body.insertAdjacentHTML('beforeend', settingsHTML);

        // Carregar configura√ß√µes salvas
        loadSavedSettings();
    }

    function loadSavedSettings() {
        // Carregar tema
        const savedDarkMode = localStorage.getItem('darkMode');
        if (savedDarkMode !== null) {
            const darkModeToggle = document.getElementById('darkModeToggle');
            darkModeToggle.checked = savedDarkMode === 'true';
        }

        // Carregar idioma
        const savedLanguage = localStorage.getItem('language');
        if (savedLanguage) {
            document.getElementById('languageSelect').value = savedLanguage;
        }

        // Carregar configura√ß√µes de gr√°fico
        const savedAnimationSpeed = localStorage.getItem('chartAnimationSpeed');
        if (savedAnimationSpeed) {
            document.getElementById('chartAnimationSpeed').value = savedAnimationSpeed;
        }

        const savedPrecision = localStorage.getItem('chartPrecision');
        if (savedPrecision) {
            document.getElementById('chartPrecision').value = savedPrecision;
        }

        // Carregar configura√ß√µes de exporta√ß√£o
        const savedExportFormat = localStorage.getItem('exportFormat');
        if (savedExportFormat) {
            document.getElementById('exportFormat').value = savedExportFormat;
        }

        const savedIncludeCharts = localStorage.getItem('includeCharts');
        if (savedIncludeCharts !== null) {
            document.getElementById('includeCharts').checked = savedIncludeCharts === 'true';
        }
    }

    function closeSettings() {
        const panel = document.getElementById('settingsPanel');
        const overlay = document.getElementById('settingsOverlay');
        if (panel) panel.remove();
        if (overlay) overlay.remove();
    }

    function saveSettings() {
        // Salvar tema
        const darkModeToggle = document.getElementById('darkModeToggle');
        const isDarkMode = darkModeToggle.checked;
        localStorage.setItem('darkMode', isDarkMode);

        // Aplicar tema
        if (isDarkMode) {
            document.body.classList.add('dark-mode');
        } else {
            document.body.classList.remove('dark-mode');
        }

        // Salvar idioma
        const language = document.getElementById('languageSelect').value;
        localStorage.setItem('language', language);

        // Salvar configura√ß√µes de gr√°fico
        const chartAnimationSpeed = document.getElementById('chartAnimationSpeed').value;
        const chartPrecision = document.getElementById('chartPrecision').value;
        localStorage.setItem('chartAnimationSpeed', chartAnimationSpeed);
        localStorage.setItem('chartPrecision', chartPrecision);

        // Salvar configura√ß√µes de exporta√ß√£o
        const exportFormat = document.getElementById('exportFormat').value;
        const includeCharts = document.getElementById('includeCharts').checked;
        localStorage.setItem('exportFormat', exportFormat);
        localStorage.setItem('includeCharts', includeCharts);

        // Recriar gr√°ficos com novas configura√ß√µes
        if (currentExperiment) {
            updateCharts(currentExperiment);
        }

        showNotification('Configura√ß√µes salvas com sucesso', 'success');
        closeSettings();
    }

    function resetDashboard() {
        if (confirm('Deseja limpar todos os dados e voltar ao in√≠cio?')) {
            const count = Object.keys(allExperiments).length;

            allExperiments = {};
            experimentMetadata = {};
            currentExperiment = null;
            currentTab = 'classification';

            document.getElementById('uploadSection').style.display = 'block';
            document.getElementById('dashboardContent').style.display = 'none';
            document.getElementById('experimentList').innerHTML = '';
            document.getElementById('totalExperiments').textContent = '0';

            Object.values(charts).forEach(chart => chart?.destroy());
            charts = {};

            showNotification(`${count} experimento(s) removido(s)`, 'success');
        }
    }

    async function loadExistingExperiments() {
        console.log('üîÑ Carregando experimentos existentes do servidor...');

        try {
            // MUDAN√áA: Busca TODOS os experimentos, n√£o apenas os com resultados
            const response = await fetch('http://localhost:5000/api/experiments');

            if (!response.ok) {
                console.log('‚ö†Ô∏è Nenhum experimento encontrado no servidor');
                return;
            }

            const data = await response.json();

            if (data.status !== 'success' || !data.experiments || data.experiments.length === 0) {
                console.log('‚ÑπÔ∏è Nenhum experimento encontrado');
                return;
            }

            console.log(`‚úÖ Encontrados ${data.experiments.length} experimento(s) no servidor`);

            // Para cada experimento
            for (const expData of data.experiments) {
                const experimentId = expData.id;
                const experimentName = expData.experiment_name || `Experimento ${experimentId}`;

                console.log(`üì• Carregando: ${experimentName}`);

                // Busca os resultados completos do experimento
                try {
                    const resultsResponse = await fetch(`http://localhost:5000/api/experiments/${experimentId}/results`);

                    if (resultsResponse.ok) {
                        const resultsData = await resultsResponse.json();

                        if (resultsData.status === 'success' && resultsData.results) {
                            // Experimento COM resultados
                            console.log(`  ‚úì Resultados encontrados para ${experimentName}`);
                            allExperiments[experimentId] = resultsData.results;

                            experimentMetadata[experimentId] = {
                                modelType: resultsData.results.Arguments?.model_type || expData.model_type || 'unknown',
                                numFolds: extractNumFolds(resultsData.results),
                                timestamp: expData.timestamp || new Date().toISOString(),
                                originalName: experimentName,
                                serverId: experimentId,
                                hasResults: true
                            };
                        }
                    } else {
                        // Experimento SEM resultados - criar placeholder
                        console.log(`  ‚è≥ Aguardando resultados para ${experimentName}`);
                        allExperiments[experimentId] = {
                            Arguments: {
                                model_type: expData.model_type || 'unknown',
                                experiment_name: experimentName
                            },
                            is_placeholder: true,
                            server_id: experimentId,
                            status: expData.execution_status || 'pending',
                            created_at: expData.received_at || expData.timestamp
                        };

                        experimentMetadata[experimentId] = {
                            modelType: expData.model_type || 'unknown',
                            numFolds: 0,
                            timestamp: expData.received_at || expData.timestamp || new Date().toISOString(),
                            originalName: experimentName,
                            serverId: experimentId,
                            hasResults: false,
                            status: expData.execution_status || 'pending'
                        };
                    }
                } catch (resultError) {
                    // Se falhar ao buscar resultados, cria placeholder
                    console.log(`  ‚ö†Ô∏è Erro ao buscar resultados para ${experimentName}, criando placeholder`);
                    allExperiments[experimentId] = {
                        Arguments: {
                            model_type: expData.model_type || 'unknown',
                            experiment_name: experimentName
                        },
                        is_placeholder: true,
                        server_id: experimentId,
                        status: 'error',
                        created_at: expData.received_at || expData.timestamp
                    };

                    experimentMetadata[experimentId] = {
                        modelType: expData.model_type || 'unknown',
                        numFolds: 0,
                        timestamp: expData.received_at || expData.timestamp || new Date().toISOString(),
                        originalName: experimentName,
                        serverId: experimentId,
                        hasResults: false,
                        status: 'error'
                    };
                }

                // Adiciona √† sidebar
                addExperimentToSidebar(experimentId);
            }

            // Atualiza contador
            const totalExpElement = document.getElementById('totalExperiments');
            if (totalExpElement) {
                totalExpElement.textContent = Object.keys(allExperiments).length;
            }

            // Se houver experimentos, mostra o dashboard e seleciona o primeiro
            if (Object.keys(allExperiments).length > 0) {
                document.getElementById('uploadSection').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';

                // Seleciona o primeiro experimento
                const firstExpId = Object.keys(allExperiments)[0];
                setTimeout(() => {
                    selectExperiment(firstExpId);
                }, 100);

                const withResults = Object.values(experimentMetadata).filter(m => m.hasResults).length;
                const pending = data.experiments.length - withResults;

                showNotification(
                    `${data.experiments.length} experimento(s) carregado(s): ${withResults} com resultados, ${pending} pendente(s)`,
                    'success'
                );

                // Inicia auto-refresh se houver experimentos pendentes
                if (pending > 0) {
                    console.log('üîÑ Iniciando auto-refresh para experimentos pendentes...');
                    startAutoRefresh();
                }
            }

        } catch (error) {
            console.error('‚ùå Erro ao carregar experimentos do servidor:', error);
            // N√£o mostra erro para o usu√°rio se o servidor n√£o estiver dispon√≠vel
            console.log('‚ÑπÔ∏è Servidor n√£o dispon√≠vel - modo offline');
        }
    }

    // Carregar experimentos existentes ao iniciar
    window.addEventListener('DOMContentLoaded', () => {
        console.log('üöÄ Aplica√ß√£o iniciada - verificando servidor...');
        loadExistingExperiments();
    });


    // Aplicar configura√ß√µes salvas ao carregar a p√°gina
    function applyInitialSettings() {
        // Aplicar tema
        const savedDarkMode = localStorage.getItem('darkMode');
        if (savedDarkMode === 'true') {
            document.body.classList.add('dark-mode');
        }
    }

    // Executar ao carregar
    applyInitialSettings();

    // Mobile responsiveness
    if (window.innerWidth < 1024) {
        document.getElementById('sidebar').classList.add('collapsed');
        document.getElementById('mainContent').classList.add('expanded');
        isSidebarOpen = false;
    }

    // ===== FUN√á√ïES DE MONITORAMENTO DO SISTEMA =====

    function renderMonitoringMetrics(data) {
        const statsGrid = document.getElementById('statsGrid');
        const container = document.getElementById('chartsContainer');
        const tbody = document.getElementById('metricsTableBody');

        statsGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 2rem;"><i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--primary);"></i><p style="margin-top: 1rem;">Carregando dados do sistema...</p></div>';
        container.innerHTML = '';
        tbody.innerHTML = '';

        fetchSystemData();
        if (monitoringInterval) clearInterval(monitoringInterval);
        monitoringInterval = setInterval(fetchSystemData, 2000);
    }

    async function fetchSystemData() {
        try {
            const response = await fetch('http://localhost:5000/api/system-info');
            const systemData = await response.json();
            updateMonitoringUI(systemData);
        } catch (error) {
            console.error('Erro ao buscar dados do sistema:', error);
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; background: rgba(239, 68, 68, 0.1); border-radius: 1rem;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 2rem; color: var(--danger);"></i>
                    <p style="margin-top: 1rem; color: var(--danger); font-weight: 600;">Erro ao conectar com o servidor</p>
                    <p style="margin-top: 0.5rem; font-size: 0.875rem; color: #6b7280;">Certifique-se de que o servidor Python est√° rodando em http://localhost:5000</p>
                </div>
            `;
        }
    }

    function updateMonitoringUI(systemData) {
        const statsGrid = document.getElementById('statsGrid');
        statsGrid.innerHTML = '';

        const stats = [
            { icon: 'fa-microchip', label: 'Uso de CPU', value: `${systemData.cpu.percent}%`, subvalue: `${systemData.cpu.count} n√∫cleos (${systemData.cpu.physical_count} f√≠sicos)`, color: 'var(--primary)' },
            { icon: 'fa-memory', label: 'Mem√≥ria RAM', value: `${systemData.memory.used} GB`, subvalue: `${systemData.memory.percent}% de ${systemData.memory.total} GB`, color: 'var(--success)' },
            { icon: 'fa-hdd', label: 'Disco', value: `${systemData.disk.percent}%`, subvalue: `${systemData.disk.used} GB / ${systemData.disk.total} GB`, color: 'var(--warning)' },
            { icon: 'fa-clock', label: 'Uptime', value: systemData.system.uptime_formatted, subvalue: `Boot: ${systemData.system.boot_time.substring(11, 16)}`, color: 'var(--info)' }
        ];

        if (systemData.gpu && systemData.gpu.length > 0) {
            systemData.gpu.forEach((gpu, index) => {
                stats.push({ icon: 'fa-server', label: `GPU ${index}: ${gpu.name}`, value: `${gpu.load}%`, subvalue: `${gpu.memory_used} MB / ${gpu.memory_total} MB (${gpu.temperature}¬∞C)`, color: 'var(--secondary)' });
            });
        }

        stats.forEach(stat => {
            const card = document.createElement('div');
            card.className = 'stat-card';
            card.innerHTML = `
                <div class="stat-header">
                    <div class="stat-icon" style="background: ${stat.color}20; color: ${stat.color};">
                        <i class="fas ${stat.icon}"></i>
                    </div>
                </div>
                <div class="stat-value">${stat.value}</div>
                ${stat.subvalue ? `<div class="stat-label" style="font-size: 0.75rem; margin-top: 0.25rem;">${stat.subvalue}</div>` : ''}
                <div class="stat-label">${stat.label}</div>
            `;
            statsGrid.appendChild(card);
        });

        const container = document.getElementById('chartsContainer');
        if (!charts.cpuChart) createMonitoringCharts(container);
        updateMonitoringCharts(systemData);
        updateMonitoringTable(systemData);
    }

    function createMonitoringCharts(container) {
        container.innerHTML = '';
        const chartConfigs = [
            { id: 'cpuHistoryChart', title: 'Hist√≥rico de CPU' },
            { id: 'memoryHistoryChart', title: 'Hist√≥rico de Mem√≥ria' },
            { id: 'cpuCoresChart', title: 'Uso de CPU por Core' },
            { id: 'processChart', title: 'Top 10 Processos por CPU' }
        ];

        chartConfigs.forEach(config => {
            const card = document.createElement('div');
            card.className = 'chart-card';
            card.innerHTML = `<div class="chart-header"><h3 class="chart-title">${config.title}</h3></div><div class="chart-container"><canvas id="${config.id}"></canvas></div>`;
            container.appendChild(card);
        });

        setTimeout(() => {
            const isDark = document.body.classList.contains('dark-mode');
            const textColor = isDark ? '#f1f5f9' : '#0f172a';
            const gridColor = isDark ? '#334155' : '#e5e7eb';

            charts.cpuChart = new Chart(document.getElementById('cpuHistoryChart'), {
                type: 'line',
                data: { labels: [], datasets: [{ label: 'CPU (%)', data: [], borderColor: 'rgba(59, 130, 246, 1)', backgroundColor: 'rgba(59, 130, 246, 0.2)', borderWidth: 2, tension: 0.4, fill: true }] },
                options: { responsive: true, maintainAspectRatio: false, animation: { duration: 0 }, plugins: { legend: { labels: { color: textColor } } }, scales: { y: { beginAtZero: true, max: 100, grid: { color: gridColor }, ticks: { color: textColor } }, x: { grid: { display: false }, ticks: { color: textColor } } } }
            });

            charts.memoryChart = new Chart(document.getElementById('memoryHistoryChart'), {
                type: 'line',
                data: { labels: [], datasets: [{ label: 'Mem√≥ria (%)', data: [], borderColor: 'rgba(16, 185, 129, 1)', backgroundColor: 'rgba(16, 185, 129, 0.2)', borderWidth: 2, tension: 0.4, fill: true }] },
                options: { responsive: true, maintainAspectRatio: false, animation: { duration: 0 }, plugins: { legend: { labels: { color: textColor } } }, scales: { y: { beginAtZero: true, max: 100, grid: { color: gridColor }, ticks: { color: textColor } }, x: { grid: { display: false }, ticks: { color: textColor } } } }
            });

            charts.cpuCoresChart = new Chart(document.getElementById('cpuCoresChart'), {
                type: 'bar',
                data: { labels: [], datasets: [{ label: 'Uso (%)', data: [], backgroundColor: 'rgba(139, 92, 246, 0.8)', borderColor: 'rgba(139, 92, 246, 1)', borderWidth: 2, borderRadius: 8 }] },
                options: { responsive: true, maintainAspectRatio: false, animation: { duration: 0 }, plugins: { legend: { labels: { color: textColor } } }, scales: { y: { beginAtZero: true, max: 100, grid: { color: gridColor }, ticks: { color: textColor } }, x: { grid: { display: false }, ticks: { color: textColor } } } }
            });

            charts.processChart = new Chart(document.getElementById('processChart'), {
                type: 'bar',
                data: { labels: [], datasets: [{ label: 'CPU (%)', data: [], backgroundColor: 'rgba(245, 158, 11, 0.8)', borderColor: 'rgba(245, 158, 11, 1)', borderWidth: 2, borderRadius: 8 }] },
                options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, animation: { duration: 0 }, plugins: { legend: { labels: { color: textColor } } }, scales: { x: { beginAtZero: true, grid: { color: gridColor }, ticks: { color: textColor } }, y: { grid: { display: false }, ticks: { color: textColor } } } }
            });
        }, 100);
    }

    function updateMonitoringCharts(systemData) {
        if (!charts.cpuChart) return;
        const cpuLabels = systemData.cpu.history.map((_, i) => `-${(systemData.cpu.history.length - i) * 2}s`);
        charts.cpuChart.data.labels = cpuLabels;
        charts.cpuChart.data.datasets[0].data = systemData.cpu.history;
        charts.cpuChart.update('none');
        charts.memoryChart.data.labels = cpuLabels;
        charts.memoryChart.data.datasets[0].data = systemData.memory.history;
        charts.memoryChart.update('none');
        charts.cpuCoresChart.data.labels = systemData.cpu.per_core.map((_, i) => `Core ${i}`);
        charts.cpuCoresChart.data.datasets[0].data = systemData.cpu.per_core;
        charts.cpuCoresChart.update('none');
        if (systemData.top_processes && systemData.top_processes.length > 0) {
            charts.processChart.data.labels = systemData.top_processes.map(p => p.name.substring(0, 20));
            charts.processChart.data.datasets[0].data = systemData.top_processes.map(p => p.cpu_percent);
            charts.processChart.update('none');
        }
    }

    function updateMonitoringTable(systemData) {
        const tbody = document.getElementById('metricsTableBody');
        const thead = document.querySelector('#metricsTable thead tr');
        thead.innerHTML = `<th>Propriedade</th><th>Valor</th>`;
        tbody.innerHTML = '';

        const tableData = [
            { property: 'Sistema Operacional', value: `${systemData.system.platform} ${systemData.system.platform_release}` },
            { property: 'Arquitetura', value: systemData.system.architecture },
            { property: 'Processador', value: systemData.system.processor },
            { property: 'CPU - Frequ√™ncia Atual', value: `${systemData.cpu.freq_current} MHz` },
            { property: 'CPU - Frequ√™ncia M√≠n/M√°x', value: `${systemData.cpu.freq_min} / ${systemData.cpu.freq_max} MHz` },
            { property: 'Mem√≥ria Total', value: `${systemData.memory.total} GB` },
            { property: 'Mem√≥ria Dispon√≠vel', value: `${systemData.memory.available} GB` },
            { property: 'Mem√≥ria Usada', value: `${systemData.memory.used} GB (${systemData.memory.percent}%)` },
            { property: 'Swap Total', value: `${systemData.swap.total} GB` },
            { property: 'Swap Usado', value: `${systemData.swap.used} GB (${systemData.swap.percent}%)` },
            { property: 'Disco Total', value: `${systemData.disk.total} GB` },
            { property: 'Disco Livre', value: `${systemData.disk.free} GB` },
            { property: 'Disco Usado', value: `${systemData.disk.used} GB (${systemData.disk.percent}%)` },
            { property: 'Rede - Bytes Enviados', value: `${(systemData.network.bytes_sent / (1024**3)).toFixed(2)} GB` },
            { property: 'Rede - Bytes Recebidos', value: `${(systemData.network.bytes_recv / (1024**3)).toFixed(2)} GB` },
            { property: 'Boot Time', value: systemData.system.boot_time },
            { property: 'Uptime', value: systemData.system.uptime_formatted }
        ];

        if (systemData.gpu && systemData.gpu.length > 0) {
            systemData.gpu.forEach((gpu, index) => {
                tableData.push({ property: `GPU ${index} - Nome`, value: gpu.name });
                tableData.push({ property: `GPU ${index} - Uso`, value: `${gpu.load}%` });
                tableData.push({ property: `GPU ${index} - Mem√≥ria`, value: `${gpu.memory_used} MB / ${gpu.memory_total} MB (${gpu.memory_percent}%)` });
                tableData.push({ property: `GPU ${index} - Temperatura`, value: `${gpu.temperature}¬∞C` });
            });
        }

        tableData.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `<td style="font-weight: 600;">${item.property}</td><td>${item.value}</td>`;
            tbody.appendChild(row);
        });
    }

    // =======================
    // EXPERIMENT CREATOR FUNCTIONS
    // =======================

function showExperimentCreator() {
    const modal = document.getElementById('experimentCreatorModal');
    modal.classList.add('show');
    document.body.style.overflow = 'hidden';

    // Carregar lista de datasets dispon√≠veis
    loadDatasetsForExperiment();
}

    function closeExperimentCreator() {
        const modal = document.getElementById('experimentCreatorModal');
        modal.classList.remove('show');
        document.body.style.overflow = 'auto';
    }

    async function loadDatasetsForExperiment() {
    const datasetSelect = document.getElementById('datasetPath');

    try {
        datasetSelect.innerHTML = '<option value="">Carregando...</option>';

        const response = await fetch('http://localhost:5000/api/datasets');

        if (!response.ok) {
            throw new Error('Erro ao carregar datasets');
        }

        const data = await response.json();

        if (data.status === 'success') {
            datasetSelect.innerHTML = '<option value="">Selecione um dataset...</option>';

            if (data.count === 0) {
                datasetSelect.innerHTML = '<option value="">Nenhum dataset dispon√≠vel</option>';
                showToast('Nenhum dataset encontrado. Fa√ßa upload de um dataset primeiro.', 'warning');
                return;
            }

            // Adicionar op√ß√£o para cada dataset
            data.datasets.forEach(dataset => {
                const option = document.createElement('option');
                option.value = dataset.filepath;

                // Texto descritivo com informa√ß√µes do dataset
                let text = dataset.filename;
                if (dataset.rows && dataset.columns) {
                    text += ` (${dataset.rows} linhas, ${dataset.columns} colunas, ${dataset.size_mb} MB)`;
                } else {
                    text += ` (${dataset.size_mb} MB)`;
                }

                option.textContent = text;
                option.dataset.filename = dataset.filename;
                option.dataset.size = dataset.size_mb;
                option.dataset.rows = dataset.rows || 'N/A';
                option.dataset.columns = dataset.columns || 'N/A';

                datasetSelect.appendChild(option);
            });

            // Adicionar evento de mudan√ßa para mostrar informa√ß√µes
            datasetSelect.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                if (selectedOption.value) {
                    const info = `
                        <div style="margin-top: 0.5rem; padding: 0.75rem; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 0.5rem; border-left: 4px solid var(--info);">
                            <div style="font-weight: 600; margin-bottom: 0.25rem; color: #0369a1;">
                                <i class="fas fa-info-circle"></i> Dataset Selecionado
                            </div>
                            <div style="font-size: 0.875rem; color: #075985;">
                                <strong>Arquivo:</strong> ${selectedOption.dataset.filename}<br>
                                <strong>Linhas:</strong> ${selectedOption.dataset.rows} |
                                <strong>Colunas:</strong> ${selectedOption.dataset.columns} |
                                <strong>Tamanho:</strong> ${selectedOption.dataset.size} MB
                            </div>
                        </div>
                    `;

                    // Remove info anterior se existir
                    const oldInfo = document.querySelector('.dataset-selected-info');
                    if (oldInfo) oldInfo.remove();

                    // Adiciona nova info
                    const infoDiv = document.createElement('div');
                    infoDiv.className = 'dataset-selected-info';
                    infoDiv.innerHTML = info;
                    datasetSelect.parentElement.appendChild(infoDiv);
                } else {
                    // Remove info se nenhum dataset selecionado
                    const oldInfo = document.querySelector('.dataset-selected-info');
                    if (oldInfo) oldInfo.remove();
                }
            });

            showToast(`${data.count} dataset(s) dispon√≠vel(is)`, 'success');
        }

    } catch (error) {
        console.error('Erro ao carregar datasets:', error);
        datasetSelect.innerHTML = '<option value="">Erro ao carregar datasets</option>';

        showToast(
            'Erro ao carregar datasets. Verifique se o servidor est√° rodando.',
            'error'
        );

        // Adicionar op√ß√£o de input manual como fallback
        const fallbackOption = document.createElement('option');
        fallbackOption.value = 'manual';
        fallbackOption.textContent = '‚ö†Ô∏è Digitar caminho manualmente';
        datasetSelect.appendChild(fallbackOption);

        // Adicionar evento para permitir input manual
        datasetSelect.addEventListener('change', function() {
            if (this.value === 'manual') {
                const manualPath = prompt('Digite o caminho completo do dataset:');
                if (manualPath) {
                    const option = document.createElement('option');
                    option.value = manualPath;
                    option.textContent = `üìù Manual: ${manualPath}`;
                    option.selected = true;
                    this.insertBefore(option, this.firstChild);
                }
            }
        });
    }
}

    function updateModelParameters() {
        const modelType = document.getElementById('modelType').value;
        const modelSpecificParams = document.getElementById('modelSpecificParams');
        const adversarialParams = document.getElementById('adversarialParams');
        const autoencoderParams = document.getElementById('autoencoderParams');
        const variationalParams = document.getElementById('variationalParams');
        const wassersteinParams = document.getElementById('wassersteinParams');
        const wassersteinGpParams = document.getElementById('wassersteinGpParams');
        const latentDiffusionParams = document.getElementById('latentDiffusionParams');
        const denoisingDiffusionParams = document.getElementById('denoisingDiffusionParams');

        // Hide all parameter sections first
        adversarialParams.style.display = 'none';
        autoencoderParams.style.display = 'none';
        variationalParams.style.display = 'none';
        wassersteinParams.style.display = 'none';
        wassersteinGpParams.style.display = 'none';
        latentDiffusionParams.style.display = 'none';
        denoisingDiffusionParams.style.display = 'none';

        // Show relevant parameter section
        if (modelType) {
            modelSpecificParams.style.display = 'block';

            switch(modelType) {
                case 'adversarial':
                    adversarialParams.style.display = 'block';
                    break;
                case 'autoencoder':
                    autoencoderParams.style.display = 'block';
                    break;
                case 'variational':
                    variationalParams.style.display = 'block';
                    break;
                case 'wasserstein':
                    wassersteinParams.style.display = 'block';
                    break;
                case 'wasserstein_gp':
                    wassersteinGpParams.style.display = 'block';
                    break;
                case 'latent_diffusion':
                    latentDiffusionParams.style.display = 'block';
                    break;
                case 'denoising_diffusion':
                    denoisingDiffusionParams.style.display = 'block';
                    break;
                case 'ctgan':
                case 'tvae':
                case 'copula':
                    // These models don't have specific parameters beyond the basics
                    modelSpecificParams.style.display = 'none';
                    break;
            }
        } else {
            modelSpecificParams.style.display = 'none';
        }
    }



    function getExperimentConfig() {
        const modelType = document.getElementById('modelType').value;

        const config = {
            experiment_name: document.getElementById('experimentName').value,
            model_type: modelType,
            dataset_path: document.getElementById('datasetPath').value,
            number_samples_per_class: document.getElementById('samplesPerClass').value,
            number_k_folds: document.getElementById('kFolds').value,
            classifier: document.getElementById('classifiers').value,
            save_data: 'True'
        };

        // Add model-specific parameters
        if (modelType === 'adversarial') {
            config.adversarial_number_epochs = document.getElementById('adversarialEpochs').value;
            config.adversarial_batch_size = document.getElementById('adversarialBatchSize').value;
            config.adversarial_latent_dimension = document.getElementById('adversarialLatentDim').value;
            config.adversarial_dense_layer_sizes_g = document.getElementById('adversarialLayersG').value;
            config.adversarial_dense_layer_sizes_d = document.getElementById('adversarialLayersD').value;
            config.adversarial_dropout_decay_rate_g = document.getElementById('adversarialDropoutG').value;
            config.adversarial_dropout_decay_rate_d = document.getElementById('adversarialDropoutD').value;
            config.adversarial_activation_function = document.getElementById('adversarialActivation').value;
            config.adversarial_training_algorithm = document.getElementById('adversarialOptimizer').value;
            config.adversarial_loss_generator = document.getElementById('adversarialLossG').value;
            config.adversarial_loss_discriminator = document.getElementById('adversarialLossD').value;
            config.adversarial_smoothing_rate = document.getElementById('adversarialSmoothing').value;
            config.adversarial_initializer_deviation = '0.5';
            config.adversarial_initializer_mean = '0';
            config.adversarial_latent_mean_distribution = '0.5';
            config.adversarial_latent_stander_deviation = '0.125';
        }
        else if (modelType === 'autoencoder') {
            config.autoencoder_number_epochs = document.getElementById('autoencoderEpochs').value;
            config.autoencoder_latent_dimension = document.getElementById('autoencoderLatentDim').value;
            config.autoencoder_batch_size = document.getElementById('autoencoderBatchSize').value;
            config.autoencoder_activation_function = document.getElementById('autoencoderActivation').value;
            config.autoencoder_dense_layer_sizes_encoder = document.getElementById('autoencoderLayersEnc').value;
            config.autoencoder_dense_layer_sizes_decoder = document.getElementById('autoencoderLayersDec').value;
            config.autoencoder_dropout_decay_rate_encoder = document.getElementById('autoencoderDropoutEnc').value;
            config.autoencoder_dropout_decay_rate_decoder = document.getElementById('autoencoderDropoutDec').value;
            config.autoencoder_number_classes = document.getElementById('autoencoderNumClasses').value;
            config.autoencoder_loss_function = document.getElementById('autoencoderLoss').value;
            config.autoencoder_momentum = document.getElementById('autoencoderMomentum').value;
            config.autoencoder_last_activation_layer = document.getElementById('autoencoderLastActivation').value;
            config.autoencoder_initializer_mean = document.getElementById('autoencoderInitMean').value;
            config.autoencoder_initializer_deviation = document.getElementById('autoencoderInitDev').value;
            config.autoencoder_latent_mean_distribution = document.getElementById('autoencoderLatentMean').value;
            config.autoencoder_latent_stander_deviation = document.getElementById('autoencoderLatentStd').value;
        }
        else if (modelType === 'variational') {
            config.variational_autoencoder_number_epochs = document.getElementById('variationalEpochs').value;
            config.variational_autoencoder_latent_dimension = document.getElementById('variationalLatentDim').value;
            config.variational_autoencoder_batch_size = document.getElementById('variationalBatchSize').value;
            config.variational_autoencoder_training_algorithm = document.getElementById('variationalOptimizer').value;
            config.variational_autoencoder_activation_function = document.getElementById('variationalActivation').value;
            config.variational_autoencoder_dense_layer_sizes_encoder = document.getElementById('variationalLayersEnc').value;
            config.variational_autoencoder_dense_layer_sizes_decoder = document.getElementById('variationalLayersDec').value;
            config.variational_autoencoder_dropout_decay_rate_encoder = document.getElementById('variationalDropoutEnc').value;
            config.variational_autoencoder_dropout_decay_rate_decoder = document.getElementById('variationalDropoutDec').value;
            config.variational_autoencoder_number_classes = document.getElementById('variationalNumClasses').value;
            config.variational_autoencoder_loss_function = document.getElementById('variationalLoss').value;
            config.variational_autoencoder_momentum = document.getElementById('variationalMomentum').value;
            config.variational_autoencoder_last_activation_layer = document.getElementById('variationalLastActivation').value;
            config.variational_autoencoder_initializer_mean = document.getElementById('variationalInitMean').value;
            config.variational_autoencoder_initializer_deviation = document.getElementById('variationalInitDev').value;
            config.variational_autoencoder_mean_distribution = document.getElementById('variationalMeanDist').value;
            config.variational_autoencoder_stander_deviation = document.getElementById('variationalStdDev').value;
        }
        else if (modelType === 'wasserstein') {
            config.wasserstein_number_epochs = document.getElementById('wassersteinEpochs').value;
            config.wasserstein_batch_size = document.getElementById('wassersteinBatchSize').value;
            config.wasserstein_latent_dimension = document.getElementById('wassersteinLatentDim').value;
            config.wasserstein_dense_layer_sizes_generator = document.getElementById('wassersteinLayersG').value;
            config.wasserstein_dense_layer_sizes_discriminator = document.getElementById('wassersteinLayersD').value;
            config.wasserstein_dropout_decay_rate_g = document.getElementById('wassersteinDropoutG').value;
            config.wasserstein_dropout_decay_rate_d = document.getElementById('wassersteinDropoutD').value;
            config.wasserstein_activation_function = document.getElementById('wassersteinActivation').value;
            config.wasserstein_training_algorithm = document.getElementById('wassersteinOptimizer').value;
            config.wasserstein_optimizer_generator_learning_rate = document.getElementById('wassersteinLrG').value;
            config.wasserstein_optimizer_discriminator_learning_rate = document.getElementById('wassersteinLrD').value;
            config.wasserstein_optimizer_generator_beta = document.getElementById('wassersteinBetaG').value;
            config.wasserstein_optimizer_discriminator_beta = document.getElementById('wassersteinBetaD').value;
            config.wasserstein_discriminator_steps = document.getElementById('wassersteinDiscSteps').value;
            config.wasserstein_smoothing_rate = document.getElementById('wassersteinSmoothing').value;
            config.wasserstein_number_classes = document.getElementById('wassersteinNumClasses').value;
            config.wasserstein_momentum = document.getElementById('wassersteinMomentum').value;
            config.wasserstein_last_activation_layer = document.getElementById('wassersteinLastActivation').value;
            config.wasserstein_initializer_mean = document.getElementById('wassersteinInitMean').value;
            config.wasserstein_initializer_deviation = document.getElementById('wassersteinInitDev').value;
            config.wasserstein_latent_mean_distribution = document.getElementById('wassersteinLatentMean').value;
            config.wasserstein_latent_stander_deviation = document.getElementById('wassersteinLatentStd').value;
        }
        else if (modelType === 'wasserstein_gp') {
            config.wasserstein_gp_number_epochs = document.getElementById('wassersteinGpEpochs').value;
            config.wasserstein_gp_batch_size = document.getElementById('wassersteinGpBatchSize').value;
            config.wasserstein_gp_latent_dimension = document.getElementById('wassersteinGpLatentDim').value;
            config.wasserstein_gp_gradient_penalty = document.getElementById('wassersteinGpGradientPenalty').value;
            config.wasserstein_gp_dense_layer_sizes_generator = document.getElementById('wassersteinGpLayersG').value;
            config.wasserstein_gp_dense_layer_sizes_discriminator = document.getElementById('wassersteinGpLayersD').value;
            config.wasserstein_gp_dropout_decay_rate_g = document.getElementById('wassersteinGpDropoutG').value;
            config.wasserstein_gp_dropout_decay_rate_d = document.getElementById('wassersteinGpDropoutD').value;
            config.wasserstein_gp_activation_function = document.getElementById('wassersteinGpActivation').value;
            config.wasserstein_gp_training_algorithm = document.getElementById('wassersteinGpOptimizer').value;
            config.wasserstein_gp_optimizer_generator_learning_rate = document.getElementById('wassersteinGpLrG').value;
            config.wasserstein_gp_optimizer_discriminator_learning_rate = document.getElementById('wassersteinGpLrD').value;
            config.wasserstein_gp_optimizer_generator_beta = document.getElementById('wassersteinGpBetaG').value;
            config.wasserstein_gp_optimizer_discriminator_beta = document.getElementById('wassersteinGpBetaD').value;
            config.wasserstein_gp_discriminator_steps = document.getElementById('wassersteinGpDiscSteps').value;
            config.wasserstein_gp_smoothing_rate = document.getElementById('wassersteinGpSmoothing').value;
            config.wasserstein_gp_number_classes = '2';
            config.wasserstein_gp_momentum = '0.8';
            config.wasserstein_gp_last_activation_layer = 'sigmoid';
            config.wasserstein_gp_initializer_mean = '0.0';
            config.wasserstein_gp_initializer_deviation = '0.125';
            config.wasserstein_gp_latent_mean_distribution = '0.5';
            config.wasserstein_gp_latent_stander_deviation = '0.125';
        }
        else if (modelType === 'latent_diffusion') {
            config.latent_diffusion_unet_epochs = document.getElementById('latentDiffusionUnetEpochs').value;
            config.latent_diffusion_autoencoder_epochs = document.getElementById('latentDiffusionAeEpochs').value;
            config.latent_diffusion_unet_last_layer_activation = document.getElementById('latentDiffusionUnetLastActivation').value;
            config.latent_diffusion_latent_dimension = document.getElementById('latentDiffusionLatentDim').value;
            config.latent_diffusion_unet_num_embedding_channels = document.getElementById('latentDiffusionUnetEmbedChannels').value;
            config.latent_diffusion_unet_channels_per_level = document.getElementById('latentDiffusionUnetChannels').value;
            config.latent_diffusion_unet_batch_size = document.getElementById('latentDiffusionUnetBatchSize').value;
            config.latent_diffusion_unet_attention_mode = document.getElementById('latentDiffusionUnetAttention').value;
            config.latent_diffusion_unet_num_residual_blocks = document.getElementById('latentDiffusionUnetResBlocks').value;
            config.latent_diffusion_unet_group_normalization = document.getElementById('latentDiffusionUnetGroupNorm').value;
            config.latent_diffusion_unet_intermediary_activation = document.getElementById('latentDiffusionUnetIntermActivation').value;
            config.latent_diffusion_unet_intermediary_activation_alpha = document.getElementById('latentDiffusionUnetActivationAlpha').value;
            config.latent_diffusion_gaussian_beta_start = document.getElementById('latentDiffusionGaussianBetaStart').value;
            config.latent_diffusion_gaussian_beta_end = document.getElementById('latentDiffusionGaussianBetaEnd').value;
            config.latent_diffusion_gaussian_time_steps = document.getElementById('latentDiffusionGaussianTimeSteps').value;
            config.latent_diffusion_gaussian_clip_min = document.getElementById('latentDiffusionGaussianClipMin').value;
            config.latent_diffusion_gaussian_clip_max = document.getElementById('latentDiffusionGaussianClipMax').value;
            config.latent_diffusion_autoencoder_loss = document.getElementById('latentDiffusionAeLoss').value;
            config.latent_diffusion_autoencoder_encoder_filters = document.getElementById('latentDiffusionAeEncFilters').value;
            config.latent_diffusion_autoencoder_decoder_filters = document.getElementById('latentDiffusionAeDecFilters').value;
            config.latent_diffusion_autoencoder_last_layer_activation = document.getElementById('latentDiffusionAeLastActivation').value;
            config.latent_diffusion_autoencoder_latent_dimension = document.getElementById('latentDiffusionAeLatentDim').value;
            config.latent_diffusion_autoencoder_batch_size_create_embedding = document.getElementById('latentDiffusionAeBatchEmbed').value;
            config.latent_diffusion_autoencoder_batch_size_training = document.getElementById('latentDiffusionAeBatchTrain').value;
            config.latent_diffusion_autoencoder_intermediary_activation_function = document.getElementById('latentDiffusionAeIntermActivation').value;
            config.latent_diffusion_autoencoder_intermediary_activation_alpha = document.getElementById('latentDiffusionAeActivationAlpha').value;
            config.latent_diffusion_autoencoder_activation_output_encoder = document.getElementById('latentDiffusionAeOutputEncActivation').value;
            config.latent_diffusion_margin = document.getElementById('latentDiffusionMargin').value;
            config.latent_diffusion_ema = document.getElementById('latentDiffusionEma').value;
            config.latent_diffusion_time_steps = document.getElementById('latentDiffusionTimeSteps').value;
        }
        else if (modelType === 'denoising_diffusion') {
            config.denoising_diffusion_unet_epochs = document.getElementById('denoisingDiffusionUnetEpochs').value;
            config.denoising_diffusion_unet_last_layer_activation = document.getElementById('denoisingDiffusionUnetLastActivation').value;
            config.denoising_diffusion_unet_num_embedding_channels = document.getElementById('denoisingDiffusionUnetEmbedChannels').value;
            config.denoising_diffusion_unet_channels_per_level = document.getElementById('denoisingDiffusionUnetChannels').value;
            config.denoising_diffusion_unet_batch_size = document.getElementById('denoisingDiffusionUnetBatchSize').value;
            config.denoising_diffusion_unet_attention_mode = document.getElementById('denoisingDiffusionUnetAttention').value;
            config.denoising_diffusion_unet_num_residual_blocks = document.getElementById('denoisingDiffusionUnetResBlocks').value;
            config.denoising_diffusion_unet_group_normalization = document.getElementById('denoisingDiffusionUnetGroupNorm').value;
            config.denoising_diffusion_unet_intermediary_activation = document.getElementById('denoisingDiffusionUnetIntermActivation').value;
            config.denoising_diffusion_unet_intermediary_activation_alpha = document.getElementById('denoisingDiffusionUnetActivationAlpha').value;
            config.denoising_diffusion_gaussian_beta_start = document.getElementById('denoisingDiffusionGaussianBetaStart').value;
            config.denoising_diffusion_gaussian_beta_end = document.getElementById('denoisingDiffusionGaussianBetaEnd').value;
            config.denoising_diffusion_gaussian_time_steps = document.getElementById('denoisingDiffusionGaussianTimeSteps').value;
            config.denoising_diffusion_gaussian_clip_min = document.getElementById('denoisingDiffusionGaussianClipMin').value;
            config.denoising_diffusion_gaussian_clip_max = document.getElementById('denoisingDiffusionGaussianClipMax').value;
            config.denoising_diffusion_margin = document.getElementById('denoisingDiffusionMargin').value;
            config.denoising_diffusion_ema = document.getElementById('denoisingDiffusionEma').value;
            config.denoising_diffusion_time_steps = document.getElementById('denoisingDiffusionTimeSteps').value;
        }

        return config;
    }

    function validateExperimentConfig(config) {
        const errors = [];

        if (!config.experiment_name || config.experiment_name.trim() === '') {
            errors.push('Nome do experimento √© obrigat√≥rio');
        }

        if (!config.model_type) {
            errors.push('Tipo de modelo √© obrigat√≥rio');
        }

        if (!config.dataset_path || config.dataset_path.trim() === '') {
            errors.push('Caminho do dataset √© obrigat√≥rio');
        }

        return errors;
    }

    function saveExperimentConfig() {
        const config = getExperimentConfig();
        const errors = validateExperimentConfig(config);

        if (errors.length > 0) {
            showToast('Erro: ' + errors.join(', '), 'error');
            return;
        }

        // Convert config to Python campaign format
        const pythonConfig = generatePythonCampaign(config);

        // Create a downloadable file
        const blob = new Blob([pythonConfig], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `campaign_${config.experiment_name}.py`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        showToast('Configura√ß√£o salva com sucesso!', 'success');
    }

    function generatePythonCampaign(config) {
        let pythonCode = `# Experiment Configuration: ${config.experiment_name}\n`;
        pythonCode += `# Generated on: ${new Date().toISOString()}\n\n`;
        pythonCode += `campaigns_available['${config.experiment_name}'] = {\n`;
        pythonCode += `    'classifier': ['${config.classifier}'],\n`;
        pythonCode += `    'model_type': ['${config.model_type}'],\n`;
        pythonCode += `    'number_samples_per_class': ['${config.number_samples_per_class}'],\n`;
        pythonCode += `    'number_k_folds': [${config.number_k_folds}],\n`;
        pythonCode += `    'save_data': ['${config.save_data}'],\n`;

        // Add model-specific parameters
        if (config.model_type === 'adversarial') {
            pythonCode += `    'adversarial_number_epochs': [${config.adversarial_number_epochs}],\n`;
            pythonCode += `    'adversarial_batch_size': [${config.adversarial_batch_size}],\n`;
            pythonCode += `    'adversarial_latent_dimension': [${config.adversarial_latent_dimension}],\n`;
            pythonCode += `    'adversarial_dense_layer_sizes_g': ['${config.adversarial_dense_layer_sizes_g}'],\n`;
            pythonCode += `    'adversarial_dense_layer_sizes_d': ['${config.adversarial_dense_layer_sizes_d}'],\n`;
            pythonCode += `    'adversarial_dropout_decay_rate_g': [${config.adversarial_dropout_decay_rate_g}],\n`;
            pythonCode += `    'adversarial_dropout_decay_rate_d': [${config.adversarial_dropout_decay_rate_d}],\n`;
            pythonCode += `    'adversarial_activation_function': ['${config.adversarial_activation_function}'],\n`;
            pythonCode += `    'adversarial_training_algorithm': ['${config.adversarial_training_algorithm}'],\n`;
            pythonCode += `    'adversarial_loss_generator': ['${config.adversarial_loss_generator}'],\n`;
            pythonCode += `    'adversarial_loss_discriminator': ['${config.adversarial_loss_discriminator}'],\n`;
            pythonCode += `    'adversarial_smoothing_rate': [${config.adversarial_smoothing_rate}],\n`;
            pythonCode += `    'adversarial_initializer_deviation': [${config.adversarial_initializer_deviation}],\n`;
            pythonCode += `    'adversarial_initializer_mean': [${config.adversarial_initializer_mean}],\n`;
            pythonCode += `    'adversarial_latent_mean_distribution': [${config.adversarial_latent_mean_distribution}],\n`;
            pythonCode += `    'adversarial_latent_stander_deviation': [${config.adversarial_latent_stander_deviation}],\n`;
        }
        else if (config.model_type === 'autoencoder') {
            pythonCode += `    'autoencoder_number_epochs': [${config.autoencoder_number_epochs}],\n`;
            pythonCode += `    'autoencoder_latent_dimension': [${config.autoencoder_latent_dimension}],\n`;
            pythonCode += `    'autoencoder_batch_size': [${config.autoencoder_batch_size}],\n`;
            pythonCode += `    'autoencoder_activation_function': ['${config.autoencoder_activation_function}'],\n`;
            pythonCode += `    'autoencoder_dense_layer_sizes_encoder': ['${config.autoencoder_dense_layer_sizes_encoder}'],\n`;
            pythonCode += `    'autoencoder_dense_layer_sizes_decoder': ['${config.autoencoder_dense_layer_sizes_decoder}'],\n`;
            pythonCode += `    'autoencoder_dropout_decay_rate_encoder': [${config.autoencoder_dropout_decay_rate_encoder}],\n`;
            pythonCode += `    'autoencoder_dropout_decay_rate_decoder': [${config.autoencoder_dropout_decay_rate_decoder}],\n`;
            pythonCode += `    'autoencoder_number_classes': [${config.autoencoder_number_classes}],\n`;
            pythonCode += `    'autoencoder_loss_function': ['${config.autoencoder_loss_function}'],\n`;
            pythonCode += `    'autoencoder_momentum': [${config.autoencoder_momentum}],\n`;
            pythonCode += `    'autoencoder_last_activation_layer': ['${config.autoencoder_last_activation_layer}'],\n`;
            pythonCode += `    'autoencoder_initializer_mean': [${config.autoencoder_initializer_mean}],\n`;
            pythonCode += `    'autoencoder_initializer_deviation': [${config.autoencoder_initializer_deviation}],\n`;
            pythonCode += `    'autoencoder_latent_mean_distribution': [${config.autoencoder_latent_mean_distribution}],\n`;
            pythonCode += `    'autoencoder_latent_stander_deviation': [${config.autoencoder_latent_stander_deviation}],\n`;
        }
        else if (config.model_type === 'variational') {
            pythonCode += `    'variational_autoencoder_number_epochs': [${config.variational_autoencoder_number_epochs}],\n`;
            pythonCode += `    'variational_autoencoder_latent_dimension': [${config.variational_autoencoder_latent_dimension}],\n`;
            pythonCode += `    'variational_autoencoder_batch_size': [${config.variational_autoencoder_batch_size}],\n`;
            pythonCode += `    'variational_autoencoder_training_algorithm': ['${config.variational_autoencoder_training_algorithm}'],\n`;
            pythonCode += `    'variational_autoencoder_activation_function': ['${config.variational_autoencoder_activation_function}'],\n`;
            pythonCode += `    'variational_autoencoder_dense_layer_sizes_encoder': ['${config.variational_autoencoder_dense_layer_sizes_encoder}'],\n`;
            pythonCode += `    'variational_autoencoder_dense_layer_sizes_decoder': ['${config.variational_autoencoder_dense_layer_sizes_decoder}'],\n`;
            pythonCode += `    'variational_autoencoder_dropout_decay_rate_encoder': [${config.variational_autoencoder_dropout_decay_rate_encoder}],\n`;
            pythonCode += `    'variational_autoencoder_dropout_decay_rate_decoder': [${config.variational_autoencoder_dropout_decay_rate_decoder}],\n`;
            pythonCode += `    'variational_autoencoder_number_classes': [${config.variational_autoencoder_number_classes}],\n`;
            pythonCode += `    'variational_autoencoder_loss_function': ['${config.variational_autoencoder_loss_function}'],\n`;
            pythonCode += `    'variational_autoencoder_momentum': [${config.variational_autoencoder_momentum}],\n`;
            pythonCode += `    'variational_autoencoder_last_activation_layer': ['${config.variational_autoencoder_last_activation_layer}'],\n`;
            pythonCode += `    'variational_autoencoder_initializer_mean': [${config.variational_autoencoder_initializer_mean}],\n`;
            pythonCode += `    'variational_autoencoder_initializer_deviation': [${config.variational_autoencoder_initializer_deviation}],\n`;
            pythonCode += `    'variational_autoencoder_mean_distribution': [${config.variational_autoencoder_mean_distribution}],\n`;
            pythonCode += `    'variational_autoencoder_stander_deviation': [${config.variational_autoencoder_stander_deviation}],\n`;
        }
        else if (config.model_type === 'wasserstein') {
            pythonCode += `    'wasserstein_number_epochs': [${config.wasserstein_number_epochs}],\n`;
            pythonCode += `    'wasserstein_batch_size': [${config.wasserstein_batch_size}],\n`;
            pythonCode += `    'wasserstein_latent_dimension': [${config.wasserstein_latent_dimension}],\n`;
            pythonCode += `    'wasserstein_dense_layer_sizes_generator': [${config.wasserstein_dense_layer_sizes_generator}],\n`;
            pythonCode += `    'wasserstein_dense_layer_sizes_discriminator': [${config.wasserstein_dense_layer_sizes_discriminator}],\n`;
            pythonCode += `    'wasserstein_dropout_decay_rate_g': [${config.wasserstein_dropout_decay_rate_g}],\n`;
            pythonCode += `    'wasserstein_dropout_decay_rate_d': [${config.wasserstein_dropout_decay_rate_d}],\n`;
            pythonCode += `    'wasserstein_activation_function': ['${config.wasserstein_activation_function}'],\n`;
            pythonCode += `    'wasserstein_training_algorithm': ['${config.wasserstein_training_algorithm}'],\n`;
            pythonCode += `    'wasserstein_optimizer_generator_learning_rate': [${config.wasserstein_optimizer_generator_learning_rate}],\n`;
            pythonCode += `    'wasserstein_optimizer_discriminator_learning_rate': [${config.wasserstein_optimizer_discriminator_learning_rate}],\n`;
            pythonCode += `    'wasserstein_optimizer_generator_beta': [${config.wasserstein_optimizer_generator_beta}],\n`;
            pythonCode += `    'wasserstein_optimizer_discriminator_beta': [${config.wasserstein_optimizer_discriminator_beta}],\n`;
            pythonCode += `    'wasserstein_discriminator_steps': [${config.wasserstein_discriminator_steps}],\n`;
            pythonCode += `    'wasserstein_smoothing_rate': [${config.wasserstein_smoothing_rate}],\n`;
            pythonCode += `    'wasserstein_number_classes': [${config.wasserstein_number_classes}],\n`;
            pythonCode += `    'wasserstein_momentum': [${config.wasserstein_momentum}],\n`;
            pythonCode += `    'wasserstein_last_activation_layer': ['${config.wasserstein_last_activation_layer}'],\n`;
            pythonCode += `    'wasserstein_initializer_mean': [${config.wasserstein_initializer_mean}],\n`;
            pythonCode += `    'wasserstein_initializer_deviation': [${config.wasserstein_initializer_deviation}],\n`;
            pythonCode += `    'wasserstein_latent_mean_distribution': [${config.wasserstein_latent_mean_distribution}],\n`;
            pythonCode += `    'wasserstein_latent_stander_deviation': [${config.wasserstein_latent_stander_deviation}],\n`;
        }
        else if (config.model_type === 'wasserstein_gp') {
            pythonCode += `    'wasserstein_gp_number_epochs': [${config.wasserstein_gp_number_epochs}],\n`;
            pythonCode += `    'wasserstein_gp_batch_size': [${config.wasserstein_gp_batch_size}],\n`;
            pythonCode += `    'wasserstein_gp_latent_dimension': [${config.wasserstein_gp_latent_dimension}],\n`;
            pythonCode += `    'wasserstein_gp_gradient_penalty': [${config.wasserstein_gp_gradient_penalty}],\n`;
            pythonCode += `    'wasserstein_gp_dense_layer_sizes_generator': [${config.wasserstein_gp_dense_layer_sizes_generator}],\n`;
            pythonCode += `    'wasserstein_gp_dense_layer_sizes_discriminator': [${config.wasserstein_gp_dense_layer_sizes_discriminator}],\n`;
            pythonCode += `    'wasserstein_gp_dropout_decay_rate_g': [${config.wasserstein_gp_dropout_decay_rate_g}],\n`;
            pythonCode += `    'wasserstein_gp_dropout_decay_rate_d': [${config.wasserstein_gp_dropout_decay_rate_d}],\n`;
            pythonCode += `    'wasserstein_gp_activation_function': ['${config.wasserstein_gp_activation_function}'],\n`;
            pythonCode += `    'wasserstein_gp_training_algorithm': ['${config.wasserstein_gp_training_algorithm}'],\n`;
            pythonCode += `    'wasserstein_gp_optimizer_generator_learning_rate': [${config.wasserstein_gp_optimizer_generator_learning_rate}],\n`;
            pythonCode += `    'wasserstein_gp_optimizer_discriminator_learning_rate': [${config.wasserstein_gp_optimizer_discriminator_learning_rate}],\n`;
            pythonCode += `    'wasserstein_gp_optimizer_generator_beta': [${config.wasserstein_gp_optimizer_generator_beta}],\n`;
            pythonCode += `    'wasserstein_gp_optimizer_discriminator_beta': [${config.wasserstein_gp_optimizer_discriminator_beta}],\n`;
            pythonCode += `    'wasserstein_gp_discriminator_steps': [${config.wasserstein_gp_discriminator_steps}],\n`;
            pythonCode += `    'wasserstein_gp_smoothing_rate': [${config.wasserstein_gp_smoothing_rate}],\n`;
            pythonCode += `    'wasserstein_gp_number_classes': [${config.wasserstein_gp_number_classes}],\n`;
            pythonCode += `    'wasserstein_gp_momentum': [${config.wasserstein_gp_momentum}],\n`;
            pythonCode += `    'wasserstein_gp_last_activation_layer': ['${config.wasserstein_gp_last_activation_layer}'],\n`;
            pythonCode += `    'wasserstein_gp_initializer_mean': [${config.wasserstein_gp_initializer_mean}],\n`;
            pythonCode += `    'wasserstein_gp_initializer_deviation': [${config.wasserstein_gp_initializer_deviation}],\n`;
            pythonCode += `    'wasserstein_gp_latent_mean_distribution': [${config.wasserstein_gp_latent_mean_distribution}],\n`;
            pythonCode += `    'wasserstein_gp_latent_stander_deviation': [${config.wasserstein_gp_latent_stander_deviation}],\n`;
        }
        else if (config.model_type === 'latent_diffusion') {
            pythonCode += `    'latent_diffusion_unet_epochs': [${config.latent_diffusion_unet_epochs}],\n`;
            pythonCode += `    'latent_diffusion_autoencoder_epochs': [${config.latent_diffusion_autoencoder_epochs}],\n`;
            pythonCode += `    'latent_diffusion_unet_last_layer_activation': ['${config.latent_diffusion_unet_last_layer_activation}'],\n`;
            pythonCode += `    'latent_diffusion_latent_dimension': [${config.latent_diffusion_latent_dimension}],\n`;
            pythonCode += `    'latent_diffusion_unet_num_embedding_channels': [${config.latent_diffusion_unet_num_embedding_channels}],\n`;
            pythonCode += `    'latent_diffusion_unet_channels_per_level': ['${config.latent_diffusion_unet_channels_per_level}'],\n`;
            pythonCode += `    'latent_diffusion_unet_batch_size': [${config.latent_diffusion_unet_batch_size}],\n`;
            pythonCode += `    'latent_diffusion_unet_attention_mode': ['${config.latent_diffusion_unet_attention_mode}'],\n`;
            pythonCode += `    'latent_diffusion_unet_num_residual_blocks': [${config.latent_diffusion_unet_num_residual_blocks}],\n`;
            pythonCode += `    'latent_diffusion_unet_group_normalization': [${config.latent_diffusion_unet_group_normalization}],\n`;
            pythonCode += `    'latent_diffusion_unet_intermediary_activation': ['${config.latent_diffusion_unet_intermediary_activation}'],\n`;
            pythonCode += `    'latent_diffusion_unet_intermediary_activation_alpha': [${config.latent_diffusion_unet_intermediary_activation_alpha}],\n`;
            pythonCode += `    'latent_diffusion_gaussian_beta_start': [${config.latent_diffusion_gaussian_beta_start}],\n`;
            pythonCode += `    'latent_diffusion_gaussian_beta_end': [${config.latent_diffusion_gaussian_beta_end}],\n`;
            pythonCode += `    'latent_diffusion_gaussian_time_steps': [${config.latent_diffusion_gaussian_time_steps}],\n`;
            pythonCode += `    'latent_diffusion_gaussian_clip_min': [${config.latent_diffusion_gaussian_clip_min}],\n`;
            pythonCode += `    'latent_diffusion_gaussian_clip_max': [${config.latent_diffusion_gaussian_clip_max}],\n`;
            pythonCode += `    'latent_diffusion_autoencoder_loss': ['${config.latent_diffusion_autoencoder_loss}'],\n`;
            pythonCode += `    'latent_diffusion_autoencoder_encoder_filters': ['${config.latent_diffusion_autoencoder_encoder_filters}'],\n`;
            pythonCode += `    'latent_diffusion_autoencoder_decoder_filters': ['${config.latent_diffusion_autoencoder_decoder_filters}'],\n`;
            pythonCode += `    'latent_diffusion_autoencoder_last_layer_activation': ['${config.latent_diffusion_autoencoder_last_layer_activation}'],\n`;
            pythonCode += `    'latent_diffusion_autoencoder_latent_dimension': [${config.latent_diffusion_autoencoder_latent_dimension}],\n`;
            pythonCode += `    'latent_diffusion_autoencoder_batch_size_create_embedding': [${config.latent_diffusion_autoencoder_batch_size_create_embedding}],\n`;
            pythonCode += `    'latent_diffusion_autoencoder_batch_size_training': [${config.latent_diffusion_autoencoder_batch_size_training}],\n`;
            pythonCode += `    'latent_diffusion_autoencoder_intermediary_activation_function': ['${config.latent_diffusion_autoencoder_intermediary_activation_function}'],\n`;
            pythonCode += `    'latent_diffusion_autoencoder_intermediary_activation_alpha': [${config.latent_diffusion_autoencoder_intermediary_activation_alpha}],\n`;
            pythonCode += `    'latent_diffusion_autoencoder_activation_output_encoder': ['${config.latent_diffusion_autoencoder_activation_output_encoder}'],\n`;
            pythonCode += `    'latent_diffusion_margin': [${config.latent_diffusion_margin}],\n`;
            pythonCode += `    'latent_diffusion_ema': [${config.latent_diffusion_ema}],\n`;
            pythonCode += `    'latent_diffusion_time_steps': [${config.latent_diffusion_time_steps}],\n`;
        }
        else if (config.model_type === 'denoising_diffusion') {
            pythonCode += `    'denoising_diffusion_unet_epochs': [${config.denoising_diffusion_unet_epochs}],\n`;
            pythonCode += `    'denoising_diffusion_unet_last_layer_activation': ['${config.denoising_diffusion_unet_last_layer_activation}'],\n`;
            pythonCode += `    'denoising_diffusion_unet_num_embedding_channels': [${config.denoising_diffusion_unet_num_embedding_channels}],\n`;
            pythonCode += `    'denoising_diffusion_unet_channels_per_level': ['${config.denoising_diffusion_unet_channels_per_level}'],\n`;
            pythonCode += `    'denoising_diffusion_unet_batch_size': [${config.denoising_diffusion_unet_batch_size}],\n`;
            pythonCode += `    'denoising_diffusion_unet_attention_mode': ['${config.denoising_diffusion_unet_attention_mode}'],\n`;
            pythonCode += `    'denoising_diffusion_unet_num_residual_blocks': [${config.denoising_diffusion_unet_num_residual_blocks}],\n`;
            pythonCode += `    'denoising_diffusion_unet_group_normalization': [${config.denoising_diffusion_unet_group_normalization}],\n`;
            pythonCode += `    'denoising_diffusion_unet_intermediary_activation': ['${config.denoising_diffusion_unet_intermediary_activation}'],\n`;
            pythonCode += `    'denoising_diffusion_unet_intermediary_activation_alpha': [${config.denoising_diffusion_unet_intermediary_activation_alpha}],\n`;
            pythonCode += `    'denoising_diffusion_gaussian_beta_start': [${config.denoising_diffusion_gaussian_beta_start}],\n`;
            pythonCode += `    'denoising_diffusion_gaussian_beta_end': [${config.denoising_diffusion_gaussian_beta_end}],\n`;
            pythonCode += `    'denoising_diffusion_gaussian_time_steps': [${config.denoising_diffusion_gaussian_time_steps}],\n`;
            pythonCode += `    'denoising_diffusion_gaussian_clip_min': [${config.denoising_diffusion_gaussian_clip_min}],\n`;
            pythonCode += `    'denoising_diffusion_gaussian_clip_max': [${config.denoising_diffusion_gaussian_clip_max}],\n`;
            pythonCode += `    'denoising_diffusion_margin': [${config.denoising_diffusion_margin}],\n`;
            pythonCode += `    'denoising_diffusion_ema': [${config.denoising_diffusion_ema}],\n`;
            pythonCode += `    'denoising_diffusion_time_steps': [${config.denoising_diffusion_time_steps}]\n`;
        }

        pythonCode += `}\n`;
        return pythonCode;
    }

    function runExperiment() {
        console.log('üöÄ Iniciando runExperiment...');

        const config = getExperimentConfig();
        const errors = validateExperimentConfig(config);

        if (errors.length > 0) {
            showToast('Erro: ' + errors.join(', '), 'error');
            return;
        }

        // Build command string
        let command = `python3 campaign.py --campaign ${config.experiment_name}`;

        // Generate shell script
        const pythonCampaign = generatePythonCampaign(config);
        const shellScript = `#!/bin/bash\n\n`;
        const fullScript = shellScript +
            `# Add this to your campaign.py file in the campaigns_available dictionary:\n` +
            `cat >> campaign_additions.txt << 'EOF'\n${pythonCampaign}\nEOF\n\n` +
            `# Then run:\n${command}\n`;

        // Download the script
        const blob = new Blob([fullScript], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `run_experiment_${config.experiment_name}.sh`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        // ========== NOVO: Salvar JSON do experimento ==========
        console.log('üíæ Preparando JSON do experimento...');

        // Criar objeto JSON com todas as configura√ß√µes
        const experimentJSON = {
            timestamp: new Date().toISOString(),
            experiment_name: config.experiment_name,
            command: command,
            configuration: config,
            python_campaign: pythonCampaign
        };

        console.log('üì¶ JSON criado:', experimentJSON);

        // Salvar JSON localmente
        const jsonBlob = new Blob([JSON.stringify(experimentJSON, null, 2)], { type: 'application/json' });
        const jsonUrl = URL.createObjectURL(jsonBlob);
        const jsonLink = document.createElement('a');
        jsonLink.href = jsonUrl;
        jsonLink.download = `experiment_${config.experiment_name}_${Date.now()}.json`;
        document.body.appendChild(jsonLink);
        jsonLink.click();
        document.body.removeChild(jsonLink);
        URL.revokeObjectURL(jsonUrl);

        console.log('‚úÖ JSON salvo localmente');

        // ========== NOVO: Enviar JSON para servidor Flask ==========
        console.log('üì° Iniciando envio para servidor Flask...');
        console.log('üìã Tamanho do JSON:', JSON.stringify(experimentJSON).length, 'bytes');

        // URL do servidor Flask (ajuste conforme necess√°rio)
        const flaskServerUrl = 'http://localhost:5000/api/experiments';
        console.log('üéØ URL destino:', flaskServerUrl);

        // Primeiro, testa se o servidor est√° acess√≠vel
        console.log('üîç Testando conex√£o com servidor...');

        fetch(flaskServerUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(experimentJSON)
        })
            .then(response => {
                console.log('üì® Resposta recebida do servidor!');
                console.log('   Status:', response.status);
                console.log('   Status Text:', response.statusText);
                console.log('   OK:', response.ok);
                console.log('   Headers:', [...response.headers.entries()]);

                // Verifica o Content-Type
                const contentType = response.headers.get('content-type');
                console.log('   Content-Type:', contentType);

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status} - ${response.statusText}`);
                }

                // Verifica se √© JSON
                if (!contentType || !contentType.includes('application/json')) {
                    console.warn('‚ö†Ô∏è Resposta n√£o √© JSON! Content-Type:', contentType);
                    return response.text().then(text => {
                        console.log('Resposta como texto:', text);
                        throw new Error('Servidor n√£o retornou JSON v√°lido');
                    });
                }

                return response.json();
            })
            .then(result => {
                console.log('‚úÖ SUCESSO! Response.json() parseado com sucesso!');
                console.log('üì¶ Resposta completa do servidor:', result);
                console.log('üÜî ID retornado:', result.id);
                console.log('üìã Status:', result.status);

                // Valida se temos um ID v√°lido
                if (!result.id) {
                    console.error('‚ùå Servidor n√£o retornou um ID v√°lido!');
                    throw new Error('Resposta do servidor sem ID v√°lido');
                }

                try {
                    // Cria o experimento na sidebar
                    console.log('üîÑ Iniciando cria√ß√£o do experimento na sidebar...');
                    console.log('üìù Config a ser usado:', config);
                    console.log('üÜî ID a ser usado:', result.id);

                    const experimentName = createNewExperimentInSidebar(config, result.id);
                    console.log('‚úÖ Experimento criado na sidebar com nome:', experimentName);

                } catch (error) {
                    console.error('‚ùå Erro ao processar resultado do servidor:', error);
                    console.error('   Nome do erro:', error.name);
                    console.error('   Mensagem:', error.message);
                    console.error('   Stack:', error.stack);
                    showToast('‚ö†Ô∏è Experimento enviado ao servidor, mas houve um erro ao criar na interface: ' + error.message, 'error');
                    return; // IMPORTANTE: Retorna aqui para n√£o fechar o modal
                }

                // MOVIDO: Fecha o modal SOMENTE se tudo deu certo (fora do try-catch)
                console.log('üö™ Fechando modal...');
                closeExperimentCreator();
                console.log('‚úÖ Modal fechado com sucesso');

                // Mostra mensagem de aguarde (com delay para garantir que o modal fechou)
                setTimeout(() => {
                    console.log('üí¨ Mostrando mensagem de aguarde...');
                    showToast('‚è≥ Experimento criado com sucesso! Aguarde a execu√ß√£o.', 'success');
                }, 300);

                console.log('üéâ Processo completo! Experimento criado e modal fechado.');
            })
            .catch(error => {
                console.error('‚ùå ERRO capturado no .catch!');
                console.error('‚ùå Tipo do erro:', error.name);
                console.error('‚ùå Mensagem:', error.message);
                console.error('‚ùå Stack completo:', error.stack);

                let errorMsg = 'Erro desconhecido ao processar experimento';

                if (error.message.includes('Failed to fetch')) {
                    errorMsg = 'N√£o foi poss√≠vel conectar ao servidor Flask. Verifique se est√° rodando em ' + flaskServerUrl;
                    console.log('üí° O servidor Flask n√£o est√° acess√≠vel');
                } else if (error.message.includes('NetworkError') || error.message.includes('Network request failed')) {
                    errorMsg = 'Erro de rede. Verifique sua conex√£o e se o servidor est√° rodando';
                    console.log('üí° Problema de rede detectado');
                } else if (error.message.includes('CORS')) {
                    errorMsg = 'Erro de CORS. Verifique as configura√ß√µes do servidor';
                    console.log('üí° Problema de CORS detectado');
                } else if (error.message.includes('JSON')) {
                    errorMsg = 'Servidor respondeu mas retornou dados inv√°lidos: ' + error.message;
                    console.log('üí° Problema ao parsear JSON');
                } else if (error.message.includes('HTTP')) {
                    errorMsg = error.message; // Usa a mensagem de erro HTTP diretamente
                    console.log('üí° Erro HTTP do servidor');
                } else {
                    errorMsg = 'Erro: ' + error.message;
                    console.log('üí° Erro n√£o categorizado');
                }

                showToast(`‚ö†Ô∏è ${errorMsg}`, 'error');
                console.log('üí° DICA: Verifique o console do servidor Flask para mais detalhes');
                console.log('üí° DICA: Inicie o servidor com: python flask_server.py');
                console.log('üí° DICA: Verifique se h√° erros no console do navegador');
            });
        // ========== FIM DAS MODIFICA√á√ïES ==========

        // Show command in console (apenas para debug)
        console.log('='.repeat(80));
        console.log('COMANDO GERADO:');
        console.log('='.repeat(80));
        console.log(command);
        console.log('='.repeat(80));
        console.log('\nConfigura√ß√£o Python gerada:');
        console.log('='.repeat(80));
        console.log(pythonCampaign);
        console.log('='.repeat(80));
    }

    // Close modal when clicking outside
    document.addEventListener('click', function(event) {
        const modal = document.getElementById('experimentCreatorModal');
        if (event.target === modal) {
            closeExperimentCreator();
        }
    });



    // =======================
// DATASET MANAGER FUNCTIONS
// =======================

function showDatasetManager() {
    const modal = document.createElement('div');
    modal.id = 'datasetManagerModal';
    modal.className = 'experiment-creator-modal show';
    modal.innerHTML = `
        <div class="experiment-creator-content">
            <div class="experiment-creator-header">
                <div class="experiment-creator-title">
                    <i class="fas fa-database"></i>
                    Gerenciamento de Datasets
                </div>
                <button class="experiment-creator-close" onclick="closeDatasetManager()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="experiment-creator-body">
                <!-- Upload Section -->
                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fas fa-upload"></i>
                        Upload de Novo Dataset
                    </div>
                    <div class="form-grid">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label class="form-label">
                                Selecionar Arquivo
                                <span class="param-badge">CSV</span>
                            </label>
                            <input type="file" class="form-input" id="datasetFileInput" accept=".csv" onchange="previewDataset(this)">
                            <span class="form-hint">Selecione um arquivo CSV para upload</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="overwriteDataset" style="margin-right: 0.5rem;">
                                Sobrescrever se existir
                            </label>
                        </div>

                        <div class="form-group" style="grid-column: 1 / -1;">
                            <button class="btn-primary" onclick="uploadDataset()" style="width: 100%;">
                                <i class="fas fa-cloud-upload-alt"></i> Fazer Upload
                            </button>
                        </div>
                    </div>

                    <!-- Preview Area -->
                    <div id="datasetPreview" style="display: none; margin-top: 1rem; padding: 1rem; background: #f9fafb; border-radius: 0.5rem; border: 1px solid #e5e7eb;">
                        <h4 style="font-weight: 600; margin-bottom: 0.5rem;">Preview:</h4>
                        <div id="previewContent"></div>
                    </div>
                </div>

                <!-- Datasets List -->
                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fas fa-list"></i>
                        Datasets Dispon√≠veis
                        <span id="datasetsCount" style="margin-left: auto; background: var(--success); color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.7rem;">0</span>
                    </div>

                    <div style="margin-bottom: 1rem;">
                        <input type="text" class="form-input" id="datasetSearchInput" placeholder="Buscar datasets..." onkeyup="filterDatasets(this.value)">
                    </div>

                    <div id="datasetsList" style="max-height: 400px; overflow-y: auto;">
                        <div style="text-align: center; padding: 2rem; color: #9ca3af;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 2rem;"></i>
                            <p style="margin-top: 1rem;">Carregando datasets...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="experiment-creator-footer">
                <button class="btn-secondary" onclick="closeDatasetManager()">
                    <i class="fas fa-times"></i> Fechar
                </button>
                <button class="btn-primary" onclick="refreshDatasetsList()">
                    <i class="fas fa-sync-alt"></i> Atualizar Lista
                </button>
            </div>
        </div>
    `;

    document.body.appendChild(modal);
    document.body.style.overflow = 'hidden';

    // Load datasets list
    loadDatasetsList();
}

function closeDatasetManager() {
    const modal = document.getElementById('datasetManagerModal');
    if (modal) {
        modal.remove();
        document.body.style.overflow = 'auto';
    }
}

async function loadDatasetsList() {
    const listContainer = document.getElementById('datasetsList');
    const countElement = document.getElementById('datasetsCount');

    try {
        const response = await fetch('http://localhost:5000/api/datasets');

        if (!response.ok) {
            throw new Error('Erro ao carregar datasets');
        }

        const data = await response.json();

        if (data.status === 'success') {
            countElement.textContent = data.count;

            if (data.count === 0) {
                listContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #9ca3af;">
                        <i class="fas fa-folder-open" style="font-size: 2rem;"></i>
                        <p style="margin-top: 1rem;">Nenhum dataset encontrado</p>
                    </div>
                `;
                return;
            }

            listContainer.innerHTML = '';

            data.datasets.forEach(dataset => {
                const item = createDatasetItem(dataset);
                listContainer.appendChild(item);
            });
        }

    } catch (error) {
        console.error('Erro ao carregar datasets:', error);
        listContainer.innerHTML = `
            <div style="text-align: center; padding: 2rem; color: var(--danger);">
                <i class="fas fa-exclamation-circle" style="font-size: 2rem;"></i>
                <p style="margin-top: 1rem;">Erro ao carregar datasets</p>
                <p style="font-size: 0.875rem; margin-top: 0.5rem;">${error.message}</p>
            </div>
        `;
    }
}

function createDatasetItem(dataset) {
    const item = document.createElement('div');
    item.className = 'dataset-item';
    item.style.cssText = `
        padding: 1rem;
        margin-bottom: 0.75rem;
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 0.75rem;
        transition: all 0.2s;
        cursor: pointer;
    `;

    const isDark = document.body.classList.contains('dark-mode');
    if (isDark) {
        item.style.background = '#0f172a';
        item.style.borderColor = '#334155';
    }

    item.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
            <div style="flex: 1;">
                <div style="font-weight: 700; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-file-csv" style="color: var(--success);"></i>
                    ${dataset.filename}
                </div>
                <div style="display: flex; gap: 1rem; font-size: 0.75rem; color: #6b7280;">
                    <span><i class="fas fa-hdd"></i> ${dataset.size_mb} MB</span>
                    ${dataset.rows ? `<span><i class="fas fa-table"></i> ${dataset.rows} linhas</span>` : ''}
                    ${dataset.columns ? `<span><i class="fas fa-columns"></i> ${dataset.columns} colunas</span>` : ''}
                </div>
                ${dataset.column_names ? `
                    <div style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.5rem;">
                        Colunas: ${dataset.column_names.slice(0, 5).join(', ')}${dataset.column_names.length > 5 ? '...' : ''}
                    </div>
                ` : ''}
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button class="experiment-action-btn" onclick="event.stopPropagation(); viewDatasetDetails('${dataset.filename}')" title="Ver detalhes">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="experiment-action-btn" onclick="event.stopPropagation(); downloadDataset('${dataset.filename}')" title="Baixar">
                    <i class="fas fa-download"></i>
                </button>
                <button class="experiment-action-btn cancel-btn" onclick="event.stopPropagation(); deleteDataset('${dataset.filename}')" title="Deletar">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    `;

    item.onmouseenter = () => {
        item.style.borderColor = 'var(--primary)';
        item.style.transform = 'translateX(4px)';
    };

    item.onmouseleave = () => {
        item.style.borderColor = isDark ? '#334155' : '#e5e7eb';
        item.style.transform = 'translateX(0)';
    };

    return item;
}

function previewDataset(input) {
    const file = input.files[0];
    if (!file) return;

    const previewDiv = document.getElementById('datasetPreview');
    const previewContent = document.getElementById('previewContent');

    previewDiv.style.display = 'block';
    previewContent.innerHTML = `
        <div style="display: flex; gap: 1rem; align-items: center;">
            <i class="fas fa-file-csv" style="font-size: 2rem; color: var(--success);"></i>
            <div>
                <div style="font-weight: 600;">${file.name}</div>
                <div style="font-size: 0.875rem; color: #6b7280;">${(file.size / (1024**2)).toFixed(2)} MB</div>
            </div>
        </div>
    `;
}

async function uploadDataset() {
    const fileInput = document.getElementById('datasetFileInput');
    const overwrite = document.getElementById('overwriteDataset').checked;

    if (!fileInput.files || fileInput.files.length === 0) {
        showToast('Selecione um arquivo para upload', 'warning');
        return;
    }

    const file = fileInput.files[0];

    if (!file.name.endsWith('.csv')) {
        showToast('Apenas arquivos CSV s√£o permitidos', 'error');
        return;
    }

    const formData = new FormData();
    formData.append('file', file);
    formData.append('overwrite', overwrite);

    showToast('Enviando dataset...', 'info');

    try {
        const response = await fetch('http://localhost:5000/api/datasets/upload', {
            method: 'POST',
            body: formData
        });

        if (!response.ok) {
            throw new Error('Erro ao fazer upload');
        }

        const result = await response.json();

        if (result.status === 'success') {
            showToast(`Dataset "${result.dataset.saved_filename}" enviado com sucesso!`, 'success');

            // Clear input
            fileInput.value = '';
            document.getElementById('datasetPreview').style.display = 'none';

            // Refresh list
            await loadDatasetsList();
        } else {
            throw new Error(result.message || 'Erro desconhecido');
        }

    } catch (error) {
        console.error('Erro ao fazer upload:', error);
        showToast('Erro ao fazer upload: ' + error.message, 'error');
    }
}

async function downloadDataset(filename) {
    try {
        showToast('Iniciando download...', 'info');

        const response = await fetch(`http://localhost:5000/api/datasets/download/${encodeURIComponent(filename)}`);

        if (!response.ok) {
            throw new Error('Erro ao baixar dataset');
        }

        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);

        showToast('Download conclu√≠do!', 'success');

    } catch (error) {
        console.error('Erro ao baixar dataset:', error);
        showToast('Erro ao baixar dataset: ' + error.message, 'error');
    }
}

async function deleteDataset(filename) {
    if (!confirm(`Deseja realmente deletar o dataset "${filename}"?`)) {
        return;
    }

    try {
        const response = await fetch(`http://localhost:5000/api/datasets/${encodeURIComponent(filename)}`, {
            method: 'DELETE'
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.message || 'Erro ao deletar dataset');
        }

        const result = await response.json();

        if (result.status === 'success') {
            showToast(`Dataset "${filename}" deletado com sucesso!`, 'success');
            await loadDatasetsList();
        }

    } catch (error) {
        console.error('Erro ao deletar dataset:', error);
        showToast('Erro ao deletar: ' + error.message, 'error');
    }
}

async function viewDatasetDetails(filename) {
    try {
        showToast('Carregando detalhes...', 'info');

        const response = await fetch(`http://localhost:5000/api/datasets/${encodeURIComponent(filename)}`);

        if (!response.ok) {
            throw new Error('Erro ao carregar detalhes');
        }

        const result = await response.json();

        if (result.status === 'success') {
            const dataset = result.dataset;

            const detailsModal = document.createElement('div');
            detailsModal.className = 'experiment-creator-modal show';
            detailsModal.innerHTML = `
                <div class="experiment-creator-content" style="max-width: 800px;">
                    <div class="experiment-creator-header">
                        <div class="experiment-creator-title">
                            <i class="fas fa-info-circle"></i>
                            Detalhes do Dataset
                        </div>
                        <button class="experiment-creator-close" onclick="this.closest('.experiment-creator-modal').remove(); document.body.style.overflow='hidden';">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="experiment-creator-body">
                        <div class="form-section">
                            <h3 style="font-weight: 700; margin-bottom: 1rem;">${dataset.filename}</h3>

                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                                <div style="padding: 1rem; background: #f0f9ff; border-radius: 0.5rem;">
                                    <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">Tamanho</div>
                                    <div style="font-size: 1.5rem; font-weight: 700;">${dataset.size_mb} MB</div>
                                </div>
                                ${dataset.rows ? `
                                <div style="padding: 1rem; background: #f0fdf4; border-radius: 0.5rem;">
                                    <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">Linhas</div>
                                    <div style="font-size: 1.5rem; font-weight: 700;">${dataset.rows}</div>
                                </div>
                                ` : ''}
                                ${dataset.columns ? `
                                <div style="padding: 1rem; background: #fef3c7; border-radius: 0.5rem;">
                                    <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">Colunas</div>
                                    <div style="font-size: 1.5rem; font-weight: 700;">${dataset.columns}</div>
                                </div>
                                ` : ''}
                                ${dataset.memory_usage_mb ? `
                                <div style="padding: 1rem; background: #fce7f3; border-radius: 0.5rem;">
                                    <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">Mem√≥ria</div>
                                    <div style="font-size: 1.5rem; font-weight: 700;">${dataset.memory_usage_mb} MB</div>
                                </div>
                                ` : ''}
                            </div>

                            ${dataset.column_names ? `
                            <div style="margin-bottom: 1.5rem;">
                                <h4 style="font-weight: 600; margin-bottom: 0.75rem;">Colunas (${dataset.column_names.length}):</h4>
                                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                    ${dataset.column_names.map(col => `
                                        <span style="padding: 0.375rem 0.75rem; background: #e5e7eb; border-radius: 0.375rem; font-size: 0.875rem; font-family: monospace;">
                                            ${col}
                                        </span>
                                    `).join('')}
                                </div>
                            </div>
                            ` : ''}

                            ${dataset.preview ? `
                            <div>
                                <h4 style="font-weight: 600; margin-bottom: 0.75rem;">Preview (primeiras 10 linhas):</h4>
                                <div style="overflow-x: auto; max-height: 400px;">
                                    <table style="width: 100%; font-size: 0.875rem; border-collapse: collapse;">
                                        <thead style="background: #f9fafb; position: sticky; top: 0;">
                                            <tr>
                                                ${dataset.column_names.map(col => `
                                                    <th style="padding: 0.75rem; text-align: left; border-bottom: 2px solid #e5e7eb; font-weight: 600;">
                                                        ${col}
                                                    </th>
                                                `).join('')}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${dataset.preview.map(row => `
                                                <tr>
                                                    ${dataset.column_names.map(col => `
                                                        <td style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb;">
                                                            ${row[col] !== null && row[col] !== undefined ? row[col] : 'N/A'}
                                                        </td>
                                                    `).join('')}
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            ` : ''}

                            <div style="margin-top: 1.5rem; padding: 1rem; background: #f9fafb; border-radius: 0.5rem; font-size: 0.875rem;">
                                <div><strong>Caminho:</strong> <code>${dataset.filepath}</code></div>
                                <div style="margin-top: 0.5rem;"><strong>Criado:</strong> ${new Date(dataset.created_at).toLocaleString('pt-BR')}</div>
                                <div style="margin-top: 0.5rem;"><strong>Modificado:</strong> ${new Date(dataset.modified_at).toLocaleString('pt-BR')}</div>
                            </div>
                        </div>
                    </div>

                    <div class="experiment-creator-footer">
                        <button class="btn-secondary" onclick="this.closest('.experiment-creator-modal').remove(); document.body.style.overflow='hidden';">
                            <i class="fas fa-times"></i> Fechar
                        </button>
                        <button class="btn-primary" onclick="downloadDataset('${dataset.filename}')">
                            <i class="fas fa-download"></i> Baixar
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(detailsModal);
        }

    } catch (error) {
        console.error('Erro ao carregar detalhes:', error);
        showToast('Erro ao carregar detalhes: ' + error.message, 'error');
    }
}

function filterDatasets(searchTerm) {
    const items = document.querySelectorAll('.dataset-item');
    searchTerm = searchTerm.toLowerCase();

    items.forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(searchTerm) ? 'block' : 'none';
    });
}

function refreshDatasetsList() {
    loadDatasetsList();
    showToast('Lista atualizada!', 'success');
}
















</script>
</body>

</html>
